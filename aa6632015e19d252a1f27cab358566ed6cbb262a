{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f81d70de_08d0cda8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 8893
      },
      "writtenOn": "2021-06-14T12:32:34Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nIn this patch, we added a speed feature to skip motion search w.r.t. zeromv in first pass. In first pass, when the reference mv is not (0,0), motion search was performed twice with seed mvs as (0,0) and ref MV. This patch adds a speed feature to skip motion search with seed mv as (0,0) mv for speed 6. The results are as follows:\n\n cpu-used   Resolution  Instruction Count       BD-Rate Loss (%)\n                          Reduction (%)    avg.psnr   ovr.psnr    ssim       \n    6       LOWRES          0.666            0.0352     0.0330    0.0620\n    6       MIDRES          0.884           -0.0037    -0.0591    0.0244\n    6       HDRES           1.696            0.0681     0.0290    0.1074\n    6       Average         0.981            0.0338     0.0048    0.0648 \n\nWe also tried extending the sf to speed 5. The results are tabulated below. We have not enabled the sf for speed\u003d5 as the lowres-SSIM BD-Rate loss is high.\n\n cpu-used   Resolution  Instruction Count       BD-Rate Loss (%)\n                          Reduction (%)    avg.psnr   ovr.psnr   ssim       \n    5       LOWRES          0.481            0.0087   0.0123     0.1261\n    5       MIDRES          0.727            0.0253  -0.0091    -0.0143\n    5       HDRES           1.440           -0.0642  -0.0566    -0.1686\n    5       Average         0.785           -0.0087  -0.0150    -0.0048 \n\nIn the BD-Rate Loss column:\n[+] sign is for BD-Rate loss\n[-] sign is for BD-Rate improvement\nThe instruction count reduction specified has been measured using command:\n$ perf stat -e instructions:u ./aomenc â€¦  \n\nWe have verified that the first pass unit test merged recently, passes as well. Please review the patch.\n\nThanks\n\n\n",
      "revId": "aa6632015e19d252a1f27cab358566ed6cbb262a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b408158_28a93a30",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-14T21:31:56Z",
      "side": 1,
      "message": "I think checking zeromv was added for a good reason. Did you see any clip got much worse after this change?",
      "parentUuid": "f81d70de_08d0cda8",
      "revId": "aa6632015e19d252a1f27cab358566ed6cbb262a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e8297053_ae0f5048",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 8893
      },
      "writtenOn": "2021-06-16T14:30:14Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nWe see that motion search w.r.t. zeromv in first pass was existing in the initial encoder version as well.\n\nThe maximum BD-Rate loss (snow_mnt_480p) is 1.08% (ovr.psnr) and 2.56% (ssim). Also, the maximum BD-Rate gain (crew_4cif_30fps) is 1.49% (ovr.psnr) and 0.94% (ssim).  \n\nWe also tested this patch with constant q mode of encoding for snow_mnt_480p content. We observed a  BD-Rate gain of 0.1% (ovr.psnr) and 0.2% (ssim). Thus, the BD-Rate fluctuation seems to be due to vbr mode of encoding for snow_mnt_480p content.",
      "parentUuid": "6b408158_28a93a30",
      "revId": "aa6632015e19d252a1f27cab358566ed6cbb262a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "73a913dc_40fcfc00",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-16T16:45:22Z",
      "side": 1,
      "message": "Yes, the result makes sense since first pass stats is mostly used for vbr. My concern is if we simplify 1st pass calculation too much, then the less precise stats could cause high coding loss for some videos. We can discuss it in the meeting.",
      "parentUuid": "e8297053_ae0f5048",
      "revId": "aa6632015e19d252a1f27cab358566ed6cbb262a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "897c01bf_5e48843d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-16T16:52:17Z",
      "side": 1,
      "message": "If 1st calculation is only for specific modes that we don\u0027t actually use, it is safe to skip it (f.g. previous 1st pass optimizations). Motion search is the critical part in 1st pass, we may want to be conservative. I feel reducing mv search range probably is still safer than totally skipping it?",
      "parentUuid": "73a913dc_40fcfc00",
      "revId": "aa6632015e19d252a1f27cab358566ed6cbb262a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "16b0bbe5_8b4d89e5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-30T18:51:50Z",
      "side": 1,
      "message": "Any update?",
      "revId": "aa6632015e19d252a1f27cab358566ed6cbb262a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "efbe3913_58563238",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 8893
      },
      "writtenOn": "2021-07-01T13:14:13Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nWe analysed the following contents which showed higher BD-Rate loss/gain. \n                              BD-Rate loss (%) \n   Content               avg.psnr   ovr.psnr    ssim \nRaceHorses_832x480_30     1.22      -0.12       1.49      \ntennis_1080p24            1.03       0.94       1.15    \nbus_cif                   0.76       0.72       1.17    \nchinaspeed_xga            0.54       0.68       1.10 \nstation2_480p25          -1.26      -1.28      -1.49\nsoccer_4cif_30fps        -1.09      -0.68      -0.85\ncrew_4cif_30fps          -0.85      -1.49      -0.94\nsnow_mnt_480p             1.04       1.08       2.57\n\nDuring our analysis, we found that the gf interval has changed in above cases. With the max-gf-interval and min-gf-interval fixed to 32, both the BD rate drop and gain have reduced and the overall average impact is seen as %0.05 (vs 0.03% earlier). The BD-Rate results are as below:   \n\n                                      BD-Rate loss (%) \n  Content                 avg.psnr    ovr.psnr    ssim \nRaceHorses_832x480_30      0.50        0.24       0.72      \ntennis_1080p24             0.42        0.46       0.41    \nbus_cif                    0.19        0.14       0.34    \nchinaspeed_xga             0.19        0.28       0.37 \nstation2_480p25            0.15        0.16       0.25\nsoccer_4cif_30fps          0.18        0.03       0.04\ncrew_4cif_30fps           -0.37       -0.42      -0.33\n\nWhen we analysed snow_mnt_480p content we found that recoding of the key frame/ARF was resulting in BD-Rate loss. With recode disabled, the BD-Rate results for this patch for snow_mnt_480p is as follows:\n\n                              BD-Rate loss (%) \n Content                avg.psnr   ovr.psnr    ssim \nsnow_mnt_480p             0.05      0.05       0.02\n\nOverall, we see that there is no evident issue with this change. Please let us know your thoughts on the same.",
      "parentUuid": "16b0bbe5_8b4d89e5",
      "revId": "aa6632015e19d252a1f27cab358566ed6cbb262a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}