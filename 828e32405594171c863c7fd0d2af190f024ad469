{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2d822670_33309557",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 14993
      },
      "writtenOn": "2022-03-17T14:53:13Z",
      "side": 1,
      "message": "Hi Wan-Teh, Frank,\n\nThe txb buffers are allocated in av1_alloc_txb_buf() based on the number of superblocks present in a frame. The number of superblocks were computed as follows:\n   int size \u003d ((cm-\u003emi_params.mi_rows \u003e\u003e cm-\u003eseq_params-\u003emib_size_log2) + 1) *\n            ((cm-\u003emi_params.mi_cols \u003e\u003e cm-\u003eseq_params-\u003emib_size_log2) + 1);\n\nThe extra 1’s are added in both dimensions to account for the rounding errors. However, this addition of 1 is not required when the dimension is a perfect multiple of the superblock size. This patch improves this memory allocation by using a logic similar to ceil() so that no additional memory is allocated when either of the two dimensions is a perfect multiple of the superblock size.\n\nFor 768 x 512 resolution, we are observing a higher heap memory reduction as both the dimensions are perfect multiples of the superblock size (128x128).\n\nFor libaom AV1 video encode, bit-match is verified (w.r.t. parent commit) for \u0027GOOD\u0027, \u0027RT\u0027 and \u0027ALLINTRA\u0027 encoding modes for a few contents with different encoding configurations. It was also verified that the output of AVIF encode is bit-exact w.r.t. parent version for a typical image dataset.\n\nHEAP memory reduction was measured using the command below. \n$valgrind --tool\u003dmassif ./aomenc …\n\nPlease review.\n\nRegards,\nJayasanker.\n",
      "revId": "828e32405594171c863c7fd0d2af190f024ad469",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}