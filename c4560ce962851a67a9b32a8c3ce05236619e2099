{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "799f4b61_a4cf4773",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 15298
      },
      "writtenOn": "2021-07-22T18:59:37Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nTo avoid thread race issue in FPMT integration, this patch moves the updates of AV1_PRIMARY members to postencode stage. The updates of max_mv_magnitude, loop filter_level and mv_stats are moved to new function - update_end_of_frame_stats(), in av1_post_encode_updates(). Since mv_stats collection requires frame_context and thread data details, which will not be available during postencode stage, we introduced frame level mv_stats in cpi which will get updated during encode stage. During post-encode, the frame level mv_stats is copied to ppi.\n\nThe changes are bitexact and verified locally with CONFIG_FRAME_PARALLEL_ENCODE enabled, num_fp_contexts 2 for few clips with cqp, preset 1 and 5. The bitmatch test is also done for few recipes with CONFIG_FRAME_PARALLEL_ENCODE disabled. It is verified with integer, address, undefined and thread sanitizer test. \n\nPlease review the patch.\nThanks\n",
      "revId": "c4560ce962851a67a9b32a8c3ce05236619e2099",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}