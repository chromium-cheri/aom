{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d4007c47_3f676af9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 6245
      },
      "writtenOn": "2022-06-08T17:59:37Z",
      "side": 1,
      "message": "Hi Wan-Teh, Chi-Yo,\n\nIn this CL, we have introduced a speed feature  ‘prune_intra_tx_depths_using_nn’ to prune the transform depth evaluation. Currently, the speed feature prunes either 8x8 or 4x4 transform at most and is applicable only for 8x8 blocks. \n\nThe speed feature introduces a neural network classifier which uses features obtained using 8x8 intra residual (similar to ml_predict_tx_split()), source variance and dc quant. The ML model is evaluated after preparing intra prediction data in block_rd_txfm() in order to facilitate the pruning of 8x8 transform size (depth\u003d0) as well. The CL is enabled for allintra, speed\u003e\u003d6 and does not have any impact for speed\u003d9.\n\nFor AVIF still-image encode with tune\u003dpsnr,\n                  Encode Time     BD-Rate Loss(%)      \n       speed      Reduction(%)    psnr      ssim\n        6           4.651         0.1673   -0.3944\n        7           9.158         0.1232   -0.5128\n        8          10.448         0.1885   -0.1937\n\nFor AVIF still image encode with tune\u003dssim,\n                  Encode Time     BD-Rate Loss(%)      \n       speed      Reduction(%)    psnr      ssim\n        6           3.890         0.1954    0.0228\n        7           8.782         0.1240   -0.2798\n        8           9.757         0.1861    0.0311\n\nFollowing are the instruction count reduction results when libaom allintra frame encoding (50 frames) was tested for a borg setup. \n               Instruction Count        BD-Rate Loss(%)      \n     cpu-used    Reduction(%)     avg.psnr  ovr.psnr      ssim\n         6          4.764\t  0.2607     0.2637\t-0.1266\n         7          8.919\t  0.3116     0.3132\t-0.2397\n         8         11.277\t  0.2701     0.2726\t-0.1978\n \n\nFor libaom AV1 video encode, bit-match is verified (w.r.t. parent commit) for \u0027GOOD\u0027 and \u0027RT\u0027 encoding modes for a few contents with different encoding configurations. It is verified that the CL is bit-exact for allintra encode, speed\u003d5,9 with no speed impact.\n\nThe instruction count reduction specified has been measured using the command:\n$ perf stat -e instructions:u ./aomenc …\n\nPlease review the CL. \n\nRegards,\nRanjit\n",
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "17eb9336_da59688c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 21182
      },
      "writtenOn": "2022-06-08T18:08:18Z",
      "side": 1,
      "message": "Could butteraugli_jxl scores be compute if possible? The cmd line tool `butteraugli_main` can be used to access this directly.\n\nThat would give a more perceptually accurate view of if the patch is a good tradeoff or not.\n\nThank you.",
      "parentUuid": "d4007c47_3f676af9",
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "946a2741_e278c767",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-06-10T18:12:54Z",
      "side": 1,
      "message": "Ranjit: Your comment contains some helpful info about this CL that could be moved to the commit message. Specifically, I think the following are useful:\n\n\"Currently, the speed feature prunes either 8x8 or 4x4 transform at most and is applicable only for 8x8 blocks.\"\n\n\"... (similar to ml_predict_tx_split()) ...\"\n\n\"The ML model is evaluated after preparing intra prediction data in block_rd_txfm() in order to facilitate the pruning of 8x8 transform size (depth\u003d0) as well.\"",
      "parentUuid": "17eb9336_da59688c",
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "825c23f7_98c23d6f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 6245
      },
      "writtenOn": "2022-06-15T03:35:28Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "946a2741_e278c767",
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e0d918d_92dcbf22",
        "filename": "av1/encoder/block.h",
        "patchSetId": 4
      },
      "lineNbr": 1248,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-06-09T17:46:29Z",
      "side": 1,
      "message": "Nit: Could you move the variables here to MACROBLOCK::txfm_search_params?",
      "range": {
        "startLine": 1233,
        "startChar": 0,
        "endLine": 1248,
        "endChar": 39
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2f0f1435_1bfd8a30",
        "filename": "av1/encoder/block.h",
        "patchSetId": 4
      },
      "lineNbr": 1248,
      "author": {
        "id": 6245
      },
      "writtenOn": "2022-06-10T15:22:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7e0d918d_92dcbf22",
      "range": {
        "startLine": 1233,
        "startChar": 0,
        "endLine": 1248,
        "endChar": 39
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc26784d_d9baaaa6",
        "filename": "av1/encoder/tx_prune_model_weights.h",
        "patchSetId": 4
      },
      "lineNbr": 3316,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-06-09T17:46:29Z",
      "side": 1,
      "message": "Looks like tx_prune_model_weights.h is included by realtime mode.\nIf these models are only used for allintra mode, we could put them under CONFIG_REALTIME_ONLY flag.",
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3991d322_f17558ca",
        "filename": "av1/encoder/tx_prune_model_weights.h",
        "patchSetId": 4
      },
      "lineNbr": 3316,
      "author": {
        "id": 6245
      },
      "writtenOn": "2022-06-10T15:22:11Z",
      "side": 1,
      "message": "Done. Kept the models related to allintra under - \u0027#if !CONFIG_REALTIME_ONLY\u0027.",
      "parentUuid": "fc26784d_d9baaaa6",
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fb42272_1760fe82",
        "filename": "av1/encoder/tx_prune_model_weights.h",
        "patchSetId": 4
      },
      "lineNbr": 3409,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-06-09T17:46:29Z",
      "side": 1,
      "message": "Since we only have a single model, let\u0027s keep these as pointers instead of array of pointers",
      "range": {
        "startLine": 3409,
        "startChar": 24,
        "endLine": 3409,
        "endChar": 55
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f35c3555_65737a31",
        "filename": "av1/encoder/tx_prune_model_weights.h",
        "patchSetId": 4
      },
      "lineNbr": 3409,
      "author": {
        "id": 6245
      },
      "writtenOn": "2022-06-10T15:22:11Z",
      "side": 1,
      "message": "Done. \nWe used av1_intra_tx_split_nnconfig_8x8 and av1_intra_tx_prune_nn_thresh_8x8[2] directly in ml_predict_intra_tx_depth_prune() and cleaned up the relevant declarations and initializations.",
      "parentUuid": "2fb42272_1760fe82",
      "range": {
        "startLine": 3409,
        "startChar": 24,
        "endLine": 3409,
        "endChar": 55
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7098dc16_262bd1e6",
        "filename": "av1/encoder/tx_search.c",
        "patchSetId": 4
      },
      "lineNbr": 51,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-06-09T17:46:29Z",
      "side": 1,
      "message": "Could you add a short comment on what these enums are?",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 51,
        "endChar": 0
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f8f84789_c62dc8c9",
        "filename": "av1/encoder/tx_search.c",
        "patchSetId": 4
      },
      "lineNbr": 51,
      "author": {
        "id": 6245
      },
      "writtenOn": "2022-06-10T15:22:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7098dc16_262bd1e6",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 51,
        "endChar": 0
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18e173c0_48fbc785",
        "filename": "av1/encoder/tx_search.c",
        "patchSetId": 4
      },
      "lineNbr": 1715,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-06-09T17:46:29Z",
      "side": 1,
      "message": "We don\u0027t need num_features here.",
      "range": {
        "startLine": 1714,
        "startChar": 2,
        "endLine": 1715,
        "endChar": 21
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3a89428f_54097a2f",
        "filename": "av1/encoder/tx_search.c",
        "patchSetId": 4
      },
      "lineNbr": 1715,
      "author": {
        "id": 6245
      },
      "writtenOn": "2022-06-10T15:22:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "18e173c0_48fbc785",
      "range": {
        "startLine": 1714,
        "startChar": 2,
        "endLine": 1715,
        "endChar": 21
      },
      "revId": "a964966f0cbb1ca837f1fc82794a5e9378d8d590",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}