{
  "comments": [
    {
      "key": {
        "uuid": "c62029b5_2306e432",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4587,
      "author": {
        "id": 9545
      },
      "writtenOn": "2019-08-30T23:04:48Z",
      "side": 0,
      "message": "REF_FRAMES is equal to 8. Here we set cm-\u003ecurrent_frame.refresh_frame_flags to 0xFF. The generate_next_ref_frame_map(pbi) call at line 4605 will set cm-\u003enext_ref_frame_map[ref_index] to cm-\u003ecur_frame (at line 4549) for all ref_index. Therefore, the statement at line 4608:\n\n  *cm-\u003efc \u003d cm-\u003enext_ref_frame_map[existing_frame_idx]-\u003eframe_context;\n\nis equivalent to:\n\n  *cm-\u003efc \u003d cm-\u003ecur_frame-\u003eframe_context;",
      "revId": "a793f2e4e2be1547cdf213ec93223f9126629b0a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0a2f8d0e_13ee7f5c",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4587,
      "author": {
        "id": 5185
      },
      "writtenOn": "2019-09-09T17:21:33Z",
      "side": 0,
      "message": "What you explained makes sense to me. Looks like show_existing_frame_reset() is called only for Key frame type, which wouldn\u0027t be tested by normal use cases. Are you able to test this?",
      "parentUuid": "c62029b5_2306e432",
      "revId": "a793f2e4e2be1547cdf213ec93223f9126629b0a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f66031f_3229b74d",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4587,
      "author": {
        "id": 9545
      },
      "writtenOn": "2019-09-09T19:41:03Z",
      "side": 0,
      "message": "Yes, show_existing_frame_reset() is called only for Key frame type.\n\nI didn\u0027t realize this wouldn\u0027t be tested by normal use cases. I verified that none of the aom-test-data test vectors exercise this code path. However, several commercial test vectors do. I just tested this code path using one commercial test vector.\n\nBut, while checking this code, I found that the setting of *cm-\u003efc at the end of this function can be simply removed. I verified this by both analyzing the code (please see my annotations below) and running the code in a debugger.",
      "parentUuid": "0a2f8d0e_13ee7f5c",
      "revId": "a793f2e4e2be1547cdf213ec93223f9126629b0a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1b0c253_cf47a16c",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4733,
      "author": {
        "id": 9545
      },
      "writtenOn": "2019-09-09T19:41:03Z",
      "side": 0,
      "message": "This is the only call to show_existing_frame_reset(). Note that read_uncompressed_header() returns immediately (from line 4738) after this call.",
      "revId": "a793f2e4e2be1547cdf213ec93223f9126629b0a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6c51168d_37fe003b",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 5316,
      "author": {
        "id": 9545
      },
      "writtenOn": "2019-09-09T19:41:03Z",
      "side": 0,
      "message": "This is the only call to read_uncompressed_header(). read_uncompressed_header() is the only caller of show_existing_frame_reset(), and read_uncompressed_header() returns immediately after calling show_existing_frame_reset().",
      "revId": "a793f2e4e2be1547cdf213ec93223f9126629b0a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "524b25e0_cc4eb9d6",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 5343,
      "author": {
        "id": 9545
      },
      "writtenOn": "2019-09-09T19:41:03Z",
      "side": 0,
      "message": "Note that if both cm-\u003eshow_existing_frame and pbi-\u003ereset_decoder_state are true, then we set *cm-\u003efc here. Therefore, the value we set *cm-\u003efc to at the end of show_existing_frame_reset() will be overwritten here. So show_existing_frame_reset() does not need to set *cm-\u003efc.",
      "revId": "a793f2e4e2be1547cdf213ec93223f9126629b0a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    }
  ]
}