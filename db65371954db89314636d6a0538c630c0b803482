{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "158037f1_14a05566",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-02-03T15:17:26Z",
      "side": 1,
      "message": "See https://build.aomedia.org/jenkins/job/libaom__per_commit-unit_test-sanitizers/24838/GTEST_SHARD_INDEX\u003d0,sanitizer\u003dthread/consoleFull for a recent example of this. Search for \"(mutexes:\" in that page. Those mutexes are all instances of `worker-\u003eimpl_-\u003emutex_` in the `thread_loop()` function in aom_util/aom_thread.c.",
      "revId": "db65371954db89314636d6a0538c630c0b803482",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bd498ede_4657b2fe",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-02-03T21:57:02Z",
      "side": 1,
      "message": "\u003e See https://build.aomedia.org/jenkins/job/libaom__per_commit-unit_test-sanitizers/24838/GTEST_SHARD_INDEX\u003d0,sanitizer\u003dthread/consoleFull for a recent example of this. Search for \"(mutexes:\" in that page. Those mutexes are all instances of `worker-\u003eimpl_-\u003emutex_` in the `thread_loop()` function in aom_util/aom_thread.c.\n\nIt\u0027s funny, until you pointed it out I think I\u0027ve just scanned past that part of the message.",
      "parentUuid": "158037f1_14a05566",
      "revId": "db65371954db89314636d6a0538c630c0b803482",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b9e66805_18367a30",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 7025
      },
      "writtenOn": "2023-02-03T22:03:51Z",
      "side": 1,
      "message": "looks good to me.\n\njust curious, is it just a debugging benefit for tsan errors? Or would there be a performance implication as well?",
      "revId": "db65371954db89314636d6a0538c630c0b803482",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2501c40a_ac2c1f6c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-02-03T22:33:59Z",
      "side": 1,
      "message": "Reducing noise in TSan error messages is just one reason for this change. I mentioned TSan error messages because that\u0027s what brought me to inspect this code.\n\nI think the main reason for this change is the general principle of holding a mutex only when accessing the shared data guarded by the mutex. The `worker-\u003ehook` function does not access the shared data guarded by the mutex, so we don\u0027t need to hold the mutex while executing the `worker-\u003ehook` function.\n\nThis general principle helps reduce lock contention and may avoid deadlocks in some cases. But I think the biggest benefit is to make it clearer that this mutex is only used to guard access to the shared data (`worker-\u003estatus_`).",
      "parentUuid": "b9e66805_18367a30",
      "revId": "db65371954db89314636d6a0538c630c0b803482",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3606c5cf_490324e0",
        "filename": "aom_util/aom_thread.c",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-02-03T21:57:02Z",
      "side": 1,
      "message": "reacquires",
      "range": {
        "startLine": 75,
        "startChar": 64,
        "endLine": 75,
        "endChar": 73
      },
      "revId": "db65371954db89314636d6a0538c630c0b803482",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "04d9543a_cb122397",
        "filename": "aom_util/aom_thread.c",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-02-03T22:02:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3606c5cf_490324e0",
      "range": {
        "startLine": 75,
        "startChar": 64,
        "endLine": 75,
        "endChar": 73
      },
      "revId": "db65371954db89314636d6a0538c630c0b803482",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}