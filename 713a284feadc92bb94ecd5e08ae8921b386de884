{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1dd30433_e5e8483c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9101
      },
      "writtenOn": "2023-05-05T18:09:41Z",
      "side": 1,
      "message": "As per our study, we observed that the transform search in `motion_mode_rd()` can be tuned further for speed-up based on skip rd cost through transform rd gating. This CL introduces a speed feature to tune aggressiveness of `txfm_rd_gate_level` in motion mode search at mode evaluation stage.\nThis speed feature is enabled for speed 5 and 6 of Good preset.\n\nBorg test results of Good preset.\n```\n                 Instruction Count        BD-Rate Loss(%)\ncpu      Testset   Reduction(%)    avg.psnr   ovr.psnr    ssim\n 5       LOWRES2      0.763         0.0350     0.0273    0.0277\n 5       MIDRES2      1.320         0.0301     0.0278    0.0430\n 5        HDRES2      1.893         0.0838     0.0885    0.0756\n 5       Average      1.325         0.0496     0.0479    0.0488\n\n 6       LOWRES2      0.771        -0.0086    -0.0082    0.0081\n 6       MIDRES2      1.489         0.0820     0.0913    0.1261\n 6        HDRES2      1.975         0.0487     0.0471    0.0420\n 6       Average      1.411         0.0404     0.0431    0.0583\n```\nIn the commit message:\n[-] sign indicates encode time increase\n[+] sign indicates encode time reduction\n\nThe instruction count reduction specified has been measured using command:\n`$ perf stat -e instructions:u ./aomenc`",
      "revId": "713a284feadc92bb94ecd5e08ae8921b386de884",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "becbabf6_e5443a94",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-05-08T16:10:07Z",
      "side": 1,
      "message": "Nice speedup and good tradeoff. Thanks.",
      "parentUuid": "1dd30433_e5e8483c",
      "revId": "713a284feadc92bb94ecd5e08ae8921b386de884",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f56c86c_66c5686e",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 1
      },
      "lineNbr": 1328,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-05-08T16:10:07Z",
      "side": 1,
      "message": "With these 2 conditions added, does this change affect speed \u003c 5? If they work well, maybe they should be added to lower speeds?",
      "range": {
        "startLine": 1328,
        "startChar": 6,
        "endLine": 1328,
        "endChar": 58
      },
      "revId": "713a284feadc92bb94ecd5e08ae8921b386de884",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "671432b8_15c96e45",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 1
      },
      "lineNbr": 1328,
      "author": {
        "id": 9101
      },
      "writtenOn": "2023-05-09T14:48:05Z",
      "side": 1,
      "message": "In the CL, the `motion_mode_txfm_rd_gating_offset` sf is disabled for speed \u003c 5, the condition will become false. Hence, there is no impact in lower speed levels.\n\nWe tested the sf for speed 3 and 4. Please check the results.\nExperiment 1: `motion_mode_txfm_rd_gating_offset \u003d 1` for non-boosted frames\n```\n                 Instruction Count        BD-Rate Loss(%)\ncpu   Resolution   Reduction(%)    avg.psnr   ovr.psnr    ssim\n 3       LOWRES2      0.506        -0.0229    -0.0140   -0.0076\n 3       MIDRES2      0.369         0.0179     0.0198    0.0423\n 3        HDRES2      0.268        -0.0344    -0.0279   -0.0133\n 3       Average      0.381        -0.0131    -0.0074    0.0071\n\n 4       LOWRES2      0.018         0.0041     0.0063    0.0043\n 4       MIDRES2      0.022         0.0032     0.0005   -0.0021\n 4        HDRES2      0.018        -0.0073    -0.0209   -0.0184\n 4       Average      0.020        -0.0000    -0.0047   -0.0054\n```\nExperiment 2: `motion_mode_txfm_rd_gating_offset \u003d 2` for non-boosted frames\n```\n 4       LOWRES2      0.649         0.0331     0.0389    0.1133\n 4       MIDRES2      1.051         0.0292     0.0201    0.0306\n 4        HDRES2      1.273         0.0636     0.0635    0.1063\n 4       Average      0.991         0.0420     0.0408    0.0834\n```\n`txfm_rd_gate_level` corresponds to the above experiments is tabulated below.\n```\n             |         Frame type\ncpu Expt. id | Boosted arf2+bwd Non-boosted\n 3   Expt 1  |    0        2        3\n 4   Expt 1  |    0        4        4\n 4   Expt 2  |    0        5        5\n```\nAs per the results,\n- For Experiment 1 scope seems to be small\n- For Experiment 2 the average result is within trade-off. However, the trade-off of LOWRES2 testset is slightly away.\n\nWe shall extend the sf for MID/HDRES2 testsets for speed 4 with Experiment 2. Please let us know your thoughts.",
      "parentUuid": "3f56c86c_66c5686e",
      "range": {
        "startLine": 1328,
        "startChar": 6,
        "endLine": 1328,
        "endChar": 58
      },
      "revId": "713a284feadc92bb94ecd5e08ae8921b386de884",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0c53b02_348c23ab",
        "filename": "av1/encoder/speed_features.h",
        "patchSetId": 1
      },
      "lineNbr": 849,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-05-08T16:10:07Z",
      "side": 1,
      "message": "What is the difference between this sf and txfm_rd_gate_level? It doesn\u0027t look like this sf is related to motion mode search?",
      "range": {
        "startLine": 849,
        "startChar": 6,
        "endLine": 849,
        "endChar": 36
      },
      "revId": "713a284feadc92bb94ecd5e08ae8921b386de884",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7626a581_47529309",
        "filename": "av1/encoder/speed_features.h",
        "patchSetId": 1
      },
      "lineNbr": 849,
      "author": {
        "id": 9101
      },
      "writtenOn": "2023-05-09T14:48:05Z",
      "side": 1,
      "message": "The `txfm_rd_gate_level` sf skips the transform search based on skip rd cost. This sf is used in following modules where transform search is performed.\n- (a). Compound type mode search\n- (b). Motion mode search (mode evaluation and winner motion mode stage)\n- (c). Best inter candidates `tx_search_best_inter_candidates()`\n\nIn the parent version, for the speed feature, same skip level is being used across all the modules. The newly introduced `motion_mode_txfm_rd_gating_offset` sf increases the skip level of transform search for mode evaluation stage of module (b).\nAs part of this CL, a new skip level (level 5) is introduced in `txfm_rd_gate_level` sf.\nAlso, We have plans to study optimization scope in modules (a) and (c) once the patch gets merged.",
      "parentUuid": "d0c53b02_348c23ab",
      "range": {
        "startLine": 849,
        "startChar": 6,
        "endLine": 849,
        "endChar": 36
      },
      "revId": "713a284feadc92bb94ecd5e08ae8921b386de884",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}