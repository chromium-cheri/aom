{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2c49c966_9cb52983",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 21727
      },
      "writtenOn": "2021-11-29T13:48:49Z",
      "side": 1,
      "message": "Hi Yunqing,\nAs per your suggestion, we have explored the segmentation option and found that only zeromv is considered in assigning segmentation index, whereas our intra mode pruning logic uses mv range \u003c 8. Hence, with the segmentation option the optimization scope seems to be less.\nHowever, we have modified the pruning logic based on mv range of best mode so far and block source variance. Along with the speed feature ‘prune_intra_mode_based_on_mv_range’, introduced a threshold for motion vector range based on the resolution. We could achieve a similar speed up similar to our earlier logic. Please review the patch and let us know your thoughts.\n\nPlease check the resolution-wise speed and quality results as mentioned below.\n                     Instruction Count     BD-Rate Loss(%)\ncpu-used  Resolution   Reduction(%)     avg.psnr  ovr.psnr   ssim   \n   5         rtc          1.438         -0.0153   -0.0310    0.0103\n   5       rtc_derf       1.148          0.0475    0.0431    0.1098\n   5       Average        1.297          0.0108   -0.0001    0.0518\n   6         rtc          0.912         -0.0085   -0.0260    0.0018\n   6       rtc_derf       0.784         -0.0233    0.0007   -0.0294\n   6       Average        0.842         -0.0147   -0.0148   -0.0112\n    \nIn the commit message: \n[-] sign indicates encode time increase\n[+] sign indicates encode time reduction\n\nThe instruction count reduction specified has been measured using command: \n$ perf stat -e instructions:u ./aomenc …\n\nThank you.",
      "revId": "421c5d718c3f903957618770644292dc7acd0a46",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6970c56_25cb0fc7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-11-29T18:42:26Z",
      "side": 1,
      "message": "Thanks for further investigation. Looks like you used a different approach in this patch set. The result looks good. The only question is:\nmax_intra_bsize is used in another place. How does \"max_intra_bsize \u003d BLOCK_16X16\" alone affect the performance?",
      "parentUuid": "2c49c966_9cb52983",
      "revId": "421c5d718c3f903957618770644292dc7acd0a46",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a6aaaeb7_1d66fac0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 21727
      },
      "writtenOn": "2021-11-30T03:52:41Z",
      "side": 1,
      "message": "Following are the results when \u0027max_intra_bsize\u003dBLOCK_16X16\u0027.\n\nPlease check the resolution-wise speed and quality results as mentioned below.\n                     Instruction Count     BD-Rate Loss(%)\ncpu-used  Resolution   Reduction(%)     avg.psnr  ovr.psnr   ssim   \n   5         rtc          2.985          0.1852    0.1719    0.4914\n   5       rtc_derf       1.942          0.4495    0.4309    0.6440\n   5       Average        2.518          0.2954    0.2798    0.5550\n   6         rtc          2.215          0.2947    0.3124    0.5762\n   6       rtc_derf       1.312          0.2624    0.2911    0.4581\n   6       Average        1.774          0.2812    0.3035    0.5270\n    \nIn the commit message: \n[-] sign indicates encode time increase\n[+] sign indicates encode time reduction\n\nThe instruction count reduction specified has been measured using command: \n$ perf stat -e instructions:u ./aomenc …\n\nThank you.",
      "parentUuid": "f6970c56_25cb0fc7",
      "revId": "421c5d718c3f903957618770644292dc7acd0a46",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "519ad76d_7d54eaa4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-11-30T04:21:17Z",
      "side": 1,
      "message": "Thanks for testing that. So, the above is the result while pruning all intra modes for bsize \u003e BLOCK_16x16?\n\nBy the way, I saw we have:\n  if (bsize \u003e sf-\u003epart_sf.max_intra_bsize) {\n    disable_reference(INTRA_FRAME, mask-\u003eref_combo);\n  }\nThis is in the inter mode eval loop. This probably is not used?",
      "parentUuid": "a6aaaeb7_1d66fac0",
      "revId": "421c5d718c3f903957618770644292dc7acd0a46",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9c90e9cc_12c44e0d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 21727
      },
      "writtenOn": "2021-12-03T16:10:37Z",
      "side": 1,
      "message": "1. Yes, the result is for pruning all intra modes when bsize \u003e BLOCK_16x16.\n2. Secondly, the highlighted condition has no impact in the RT preset. We did a detailed study and observed that mask set for intra mode is not used for pruning.\n\nFYI, The speed feature \u0027sf-\u003epart_sf.max_intra_bsize\u0027 was not utilized in rd-path(i.e., for speed 5 and 6 of RT preset) before this patch.",
      "parentUuid": "519ad76d_7d54eaa4",
      "revId": "421c5d718c3f903957618770644292dc7acd0a46",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3bbcff3_fb01857a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-12-03T17:11:19Z",
      "side": 1,
      "message": "Ack. Thanks.",
      "parentUuid": "9c90e9cc_12c44e0d",
      "revId": "421c5d718c3f903957618770644292dc7acd0a46",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}