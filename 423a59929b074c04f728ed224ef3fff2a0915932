{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3b11c38b_8a9938e2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 31322
      },
      "writtenOn": "2022-12-27T15:25:07Z",
      "side": 1,
      "message": "Hi Wan-Teh, Frank, \n\nThe buffer frame_bufs of type RefCntBuffer is a member of the structure BufferPool. This buffer is used to hold information regarding the reference frames, and in the parent version, 16(FRAME_BUFFERS) instances of this buffer are allocated. During allintra video encode, since only a maximum of two reference frames are required at any given time, the allocation of remaining frame buffers can be avoided. This CL addresses the same and it is a bit-exact change.\n\nIn this CL, a new macro FRAME_BUFFERS_ALLINTRA is defined as 2. A variable \u0027num_ref_frame_bufs\u0027 is introduced in BufferPool, which determines the number of \u0027frame_bufs\u0027 buffers to be allocated. At the encoder side, in the function av1_create_context_and_bufferpool(), if oxcf-\u003ekf_cfg.key_freq_max \u003d 0, num_ref_frame_bufs is initialized to FRAME_BUFFERS_ALLINTRA(2), otherwise FRAME_BUFFERS(16). At the decoder side, num_ref_frame_bufs is always initialized to FRAME_BUFFERS (hence no change at the decoder side). This CL also cleans up two deprecated macros.\n\nFor AVIF still-image encode, an average encode time reduction of ~0.76%(since calloc/memset is avoided) and an average heap memory reduction of ~2% is observed on average across different resolutions with speed\u003d9 and threads\u003d4.\n\nHEAP memory reduction was measured using the following command:\n$valgrind --tool\u003dmassif ./avifenc ...\n\nFor libaom AV1 video encode, bit-match is verified (w.r.t. parent commit) for \u0027GOOD\u0027, \u0027RT\u0027 and \u0027ALLINTRA\u0027 encoding modes for a few contents with different encoding configurations. \n\nPlease review.\n\nRegards,\nApurve",
      "revId": "423a59929b074c04f728ed224ef3fff2a0915932",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}