{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c727820d_7b7b8e23",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 14993
      },
      "writtenOn": "2021-10-14T16:29:00Z",
      "side": 1,
      "message": "Hi Wan-Teh,\n\nThis patch improves/corrects the conditions for memory allocation and computation of SB level gradient cache so that the allocations and computations are performed only when gradient caching is actually required.\n\nIn the parent version, SB level gradient caching is not done for partition_search_type !\u003d SEARCH_PARTITION whereas the memory was being allocated regardless of partition_search_type. In this CL we have avoided the memory allocation for these cases. Hence, a heap memory reduction is observed for AVIF image encode with speed \u003e\u003d 7 (where the sf partition_search_type \u003d VAR_BASED_PARTITION).\n\nFor AVIF image encode with speed \u003d 9,\n\n             HEAP Memory reduction(%)\nResolution   threads\u003d1    threads\u003d4\n640x360        1.08         2.51\n768x512        0.62         1.76\n832x480        0.70         1.88\n1280x720       0.34         1.06\n\nAn additional check is introduced to disallow the allocation and computation of SB level gradient cache based on the sf ‘use_nonrd_pick_mode’. Currently this check has no impact because the sf ‘use_nonrd_pick_mode’ is enabled from speed \u003e\u003d 8 so that the allocation/computation is taken care of in case of any future changes.\n\nFor libaom AV1 video encode, bit-match is verified (w.r.t. parent commit) for \u0027GOOD\u0027, \u0027RT\u0027 and \u0027ALLINTRA\u0027 encoding modes for a few contents with different encoding configurations. It was also verified that the output of AVIF encode is bit-exact w.r.t. parent version for a typical image dataset.\n\nPlease review this patch.\n\nRegards,\nJayasanker.\n",
      "revId": "c5edd806f9c6438a19b1cc27e18b589f14799402",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cccbcac4_a6a3ae02",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-14T23:48:50Z",
      "side": 1,
      "message": "Chi Yo: Please review. Thanks!",
      "revId": "c5edd806f9c6438a19b1cc27e18b589f14799402",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31bb5156_e2cf7a2e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T04:24:23Z",
      "side": 1,
      "message": "I suggest a few small changes.",
      "revId": "c5edd806f9c6438a19b1cc27e18b589f14799402",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d5904d83_78817bda",
        "filename": "av1/encoder/encodeframe.c",
        "patchSetId": 1
      },
      "lineNbr": 845,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T04:24:23Z",
      "side": 1,
      "message": "Could you update or delete this comment? The \"when intra mode pruning based on hog is enabled\" part is no longer accurate.",
      "revId": "c5edd806f9c6438a19b1cc27e18b589f14799402",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7154abcf_9c94b45a",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 1
      },
      "lineNbr": 2306,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T04:24:23Z",
      "side": 1,
      "message": "Nit: I suggest moving the declaration of \u0027sf\u0027 here.",
      "revId": "c5edd806f9c6438a19b1cc27e18b589f14799402",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cfc39439_f7abdb71",
        "filename": "av1/encoder/intra_mode_search_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 325,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T04:24:23Z",
      "side": 1,
      "message": "Nit: Omit the outermost parentheses:\n\n  return frame_is_intra_only(\u0026cpi-\u003ecommon) \u0026\u0026 !sf-\u003ert_sf.use_nonrd_pick_mode \u0026\u0026          \n         (sf-\u003epart_sf.partition_search_type \u003d\u003d SEARCH_PARTITION) \u0026\u0026\n         (sf-\u003eintra_sf.intra_pruning_with_hog ||\n          sf-\u003eintra_sf.chroma_intra_pruning_with_hog);",
      "revId": "c5edd806f9c6438a19b1cc27e18b589f14799402",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}