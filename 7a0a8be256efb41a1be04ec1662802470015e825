{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9a31b043_262e9404",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-19T11:27:33Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThe function ‘aom_mse_wxh_16bit() computes mse of 8x8/4x4 blocks in CDEF search. In order to utilize the AVX2 instructions in this patch, support is added to perform mse of two continuous 8x8 blocks and four continuous 4x4 blocks.\n\nWe also noticed that the existing AVX2 Intrinsic implementation is done at 32/64 bit level. But for the given input range, the precision at which computations happen can be reduced (verified with the maximum value possible for src buffer i.e., CDEF_VERY_LARGE). This patch has SIMD improvements of the above changes.\n\nFor this patch, module level scaling achieved is ~10X.\nPlease check the encoder speed-up measured using timer and instruction count as below.\n``` \n                                 Encode_time\n   cpu          Testset          Reduction(%)\n    7            rtc                0.765\n    8            rtc                0.803\n\n                              Instruction Count\n   cpu          Testset         Reduction(%)\n    7            rtc                0.957\n    8            rtc                1.137\n```\nPlease note timer based results are based on a limited set of test contents and instruction count is measured using Borg test.\nFor ‘Good’ encoding mode, speed-up observed is negligible (around ~0.15%)\n\nThis patch also adds relevant unit-test changes to test for the same. This optimization is applicable for rtc testset of speed 7, 8 only, since rtc-derf and speed 9, 10 uses ‘CDEF_PICK_FROM_Q’ method.\n\nPlease review the patch.\n\nThanks \u0026 Regards\nDiksha\n",
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4ef8cd7d_8513f0f9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5190
      },
      "writtenOn": "2022-09-19T16:37:17Z",
      "side": 1,
      "message": "jzer",
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5cb390e_f987c7b8",
        "filename": "aom_dsp/aom_dsp_rtcd_defs.pl",
        "patchSetId": 3
      },
      "lineNbr": 1323,
      "author": {
        "id": 5185
      },
      "writtenOn": "2022-09-19T23:17:04Z",
      "side": 1,
      "message": "Just a reminder: add another simd version lower than avx2",
      "range": {
        "startLine": 1323,
        "startChar": 16,
        "endLine": 1323,
        "endChar": 34
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "254253af_6bd9341c",
        "filename": "aom_dsp/aom_dsp_rtcd_defs.pl",
        "patchSetId": 3
      },
      "lineNbr": 1323,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-20T12:08:43Z",
      "side": 1,
      "message": "Sure, we will take up the sse2 optimization in a follow up patch.",
      "parentUuid": "c5cb390e_f987c7b8",
      "range": {
        "startLine": 1323,
        "startChar": 16,
        "endLine": 1323,
        "endChar": 34
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4556b65_5e32f20e",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 587,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-09-19T23:14:51Z",
      "side": 1,
      "message": "Right now dstride and sstride have different meaning. dstride is the stride for each row, but sstride is the stride for each block we are operating on.\nMaybe rename sstride to something like src_blk_stride for more clarity?\n\nWe might also want to explicitly statement that src has shape 4 x h x 4 here.",
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "091293de_ee97f7c9",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 587,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-20T12:08:43Z",
      "side": 1,
      "message": "We have added appropriate comments regarding src and dst buffer. Please review.",
      "parentUuid": "e4556b65_5e32f20e",
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4889eca7_e07bd50d",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 723,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-09-19T23:14:51Z",
      "side": 1,
      "message": "Same comment as above.",
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0f58636e_3461e68b",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 723,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-20T12:08:43Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "4889eca7_e07bd50d",
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "761edba4_6f6ec245",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 794,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-09-19T23:14:51Z",
      "side": 1,
      "message": "Could you add a comment on the structure of src?\nSomething simple like src is a multi-dimensional array of shape num_blks x h x w?",
      "range": {
        "startLine": 794,
        "startChar": 70,
        "endLine": 794,
        "endChar": 73
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "66ce7a84_1a8d8673",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 794,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-20T12:08:43Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "761edba4_6f6ec245",
      "range": {
        "startLine": 794,
        "startChar": 70,
        "endLine": 794,
        "endChar": 73
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6fdcb42_c28f7e18",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 795,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-09-19T23:14:51Z",
      "side": 1,
      "message": "We could remove sstride if it\u0027s not used.",
      "range": {
        "startLine": 795,
        "startChar": 33,
        "endLine": 795,
        "endChar": 45
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9429011a_9fa53b85",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 795,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-20T12:08:43Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "a6fdcb42_c28f7e18",
      "range": {
        "startLine": 795,
        "startChar": 33,
        "endLine": 795,
        "endChar": 45
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9b0fefb_bda02b2c",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 798,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-09-19T23:14:51Z",
      "side": 1,
      "message": "must be satisfied.",
      "range": {
        "startLine": 798,
        "startChar": 26,
        "endLine": 798,
        "endChar": 38
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "30479b70_a3e5ed68",
        "filename": "aom_dsp/x86/variance_avx2.c",
        "patchSetId": 3
      },
      "lineNbr": 798,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-20T12:08:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c9b0fefb_bda02b2c",
      "range": {
        "startLine": 798,
        "startChar": 26,
        "endLine": 798,
        "endChar": 38
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd486853_a26dd1a5",
        "filename": "av1/encoder/pickcdef.c",
        "patchSetId": 3
      },
      "lineNbr": 311,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-09-19T23:14:51Z",
      "side": 1,
      "message": "This function needs a better name.\nAs it is, the name makes it look like a more optimized version of aom_mse_wxh_16bit with width \u003d\u003d 16, but it actually assumes a specific structure in src.\n\nMaybe something like aom_cdef_mse_16xh_16bit to make it explicit?",
      "range": {
        "startLine": 311,
        "startChar": 13,
        "endLine": 311,
        "endChar": 31
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6441e55_e3574ed4",
        "filename": "av1/encoder/pickcdef.c",
        "patchSetId": 3
      },
      "lineNbr": 311,
      "author": {
        "id": 31012
      },
      "writtenOn": "2022-09-20T12:08:43Z",
      "side": 1,
      "message": "As per our understanding, in src buffer all 64 blocks are arranged sequentially irrespective of the value of cdef_count. For this optimization the structure of the block in the buffer is not modified and the optimization is applicable only when two consecutive 8x8 blocks (or four consecutive 4x4 blocks) are not skipped from filtering. This criteria is verified by is_dual_or_quad_applicable() function.\nHence we feel that the existing function name would be appropriate as the functionality is not specific to CDEF module. Please let us know your thoughts.",
      "parentUuid": "bd486853_a26dd1a5",
      "range": {
        "startLine": 311,
        "startChar": 13,
        "endLine": 311,
        "endChar": 31
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ef863868_6658593c",
        "filename": "av1/encoder/pickcdef.c",
        "patchSetId": 3
      },
      "lineNbr": 311,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-09-23T22:16:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a6441e55_e3574ed4",
      "range": {
        "startLine": 311,
        "startChar": 13,
        "endLine": 311,
        "endChar": 31
      },
      "revId": "7a0a8be256efb41a1be04ec1662802470015e825",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}