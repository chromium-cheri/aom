{
  "comments": [
    {
      "key": {
        "uuid": "4f89d925_d0931804",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 7
      },
      "lineNbr": 1321,
      "author": {
        "id": 5185
      },
      "writtenOn": "2020-06-04T16:32:14Z",
      "side": 1,
      "message": "Does this one have to be added with row-mt\u003d1? Is there a reason for it?",
      "range": {
        "startLine": 1321,
        "startChar": 6,
        "endLine": 1321,
        "endChar": 49
      },
      "revId": "e8c03d7c0fbc738c9e2125dce9ecd11a7adbaa23",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "80f9715b_a6752d74",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 7
      },
      "lineNbr": 1321,
      "author": {
        "id": 5185
      },
      "writtenOn": "2020-06-04T16:45:51Z",
      "side": 1,
      "message": "Saw you mentioned \"is unmodified for row-mt\u003d0 to ensure MT bit-match with threads \u003d 1.\" So could you explain what causes the unmatched result? Thanks.",
      "parentUuid": "4f89d925_d0931804",
      "range": {
        "startLine": 1321,
        "startChar": 6,
        "endLine": 1321,
        "endChar": 49
      },
      "revId": "e8c03d7c0fbc738c9e2125dce9ecd11a7adbaa23",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51f7e96a_7e5c5906",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 7
      },
      "lineNbr": 1321,
      "author": {
        "id": 9616
      },
      "writtenOn": "2020-06-05T06:55:56Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nWith tile parallel multi-threading of encoder (--row_mt\u003d\u003d0), the single thread and multi-thread encoder outputs should bit match.\nWhereas, in case of row parallel multi-threading of encoder (--row_mt\u003d\u003d1), multi-thread output is expected to bit match while using different number of threads, but this output does not bit-match with threads\u003d1.\n\nIf the speed feature ‘prune_ref_frame_for_gm_search’ is disabled only in the multi-threading path, there will be a encoding mismatch for row_mt\u003d\u003d0 (single-thread vs multi-thread). Thus unit-test failures (AVxEncoderThreadTest and AVxEncoderThreadTestLarge tests) were seen as expected. \nTo respect the above scenario, we disabled this speed feature for row parallel multi-threading of encoder (row_mt\u003d\u003d1).",
      "parentUuid": "80f9715b_a6752d74",
      "range": {
        "startLine": 1321,
        "startChar": 6,
        "endLine": 1321,
        "endChar": 49
      },
      "revId": "e8c03d7c0fbc738c9e2125dce9ecd11a7adbaa23",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "266e2dc4_52a22526",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 7
      },
      "lineNbr": 1321,
      "author": {
        "id": 9616
      },
      "writtenOn": "2020-06-05T14:53:01Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nWe realized an issue with --row-mt\u003d1.\n\nAs the sf is disabled for threads \u003e\u003d 4, MT output will not match between threads\u003d2 and threads\u003d4 which is not as expected.\nAlternatively, if we disable the speed feature for all threads (for row-mt\u003d1), performance may not be optimal for threads \u003c 4.\n\nHence, we feel that it is recommended to revert this patch.\nPlease let us know your opinion.",
      "parentUuid": "51f7e96a_7e5c5906",
      "range": {
        "startLine": 1321,
        "startChar": 6,
        "endLine": 1321,
        "endChar": 49
      },
      "revId": "e8c03d7c0fbc738c9e2125dce9ecd11a7adbaa23",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89eee459_f3e75db4",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 7
      },
      "lineNbr": 1321,
      "author": {
        "id": 5185
      },
      "writtenOn": "2020-06-05T20:29:38Z",
      "side": 1,
      "message": "Thanks for the explanation! I understand the mt unit test is not written accurate for testing this. If the speed feature ‘prune_ref_frame_for_gm_search’ is disabled for both single thread ans multi-thread, the result would match.\n\nRegarding the mismatch between t\u003d2 and t\u003d4, looks like more work needs to be done to make it work. What do you want to do? I agree to revert this CL for now.",
      "parentUuid": "266e2dc4_52a22526",
      "range": {
        "startLine": 1321,
        "startChar": 6,
        "endLine": 1321,
        "endChar": 49
      },
      "revId": "e8c03d7c0fbc738c9e2125dce9ecd11a7adbaa23",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    }
  ]
}