{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d8e1bf57_7f4d0684",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-11-21T19:54:13Z",
      "side": 1,
      "message": "It would be good if this line said what was being fixed (maybe something like \u0027...only use rec_sse in CBR mode\u0027? The bug references are already in the message body and just naming them aren\u0027t that helpful since they aren\u0027t public.",
      "revId": "5a4f06774c5271e2991a81f7e0dfa55dcbb4ec03",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "47b9d4a5_8cf5e353",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-21T20:00:04Z",
      "side": 1,
      "message": "Yes, that\u0027s a good idea.\n\nNote: For future reference, replace \"issue:310457427\" with \"b:310457427\" or \"b/310457427\".",
      "parentUuid": "d8e1bf57_7f4d0684",
      "revId": "5a4f06774c5271e2991a81f7e0dfa55dcbb4ec03",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf19b7c6_7c2d05c5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 13,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-21T19:03:22Z",
      "side": 1,
      "message": "Thank you for the quick fix. Please add a unit test (or two). See this CL as an example:\nhttps://aomedia-review.googlesource.com/c/aom/+/183761",
      "revId": "5a4f06774c5271e2991a81f7e0dfa55dcbb4ec03",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3974a41b_6452efae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 31132
      },
      "writtenOn": "2023-11-21T14:42:19Z",
      "side": 1,
      "message": "Hi Wan-Teh,\nPlease review the changes. \n\nHi, Yunqing,\nPlease help confirm that the fix looks good to you that cpi-\u003erec_sse should only be used in CBR mode.\n\nThank you.",
      "revId": "5a4f06774c5271e2991a81f7e0dfa55dcbb4ec03",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bb67d271_16843d82",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-21T19:15:46Z",
      "side": 1,
      "message": "Lin: The fix looks correct to me. But please wait for Yunqing\u0027s review.",
      "revId": "5a4f06774c5271e2991a81f7e0dfa55dcbb4ec03",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "048722e3_7a8a62c4",
        "filename": "av1/encoder/ratectrl.c",
        "patchSetId": 3
      },
      "lineNbr": 191,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-21T19:15:46Z",
      "side": 1,
      "message": "The code inside the if statement uses `cpi-\u003erec_sse`. `cpi-\u003erec_sse` is computed only in one function, `rc_compute_variance_onepass_rt()`. And that function is called under this condition:\n\n```\n    if (cpi-\u003eoxcf.rc_cfg.mode \u003d\u003d AOM_CBR) {\n      // TODO(yunqing): the results could be used for encoder optimization.\n      cpi-\u003erec_sse \u003d UINT64_MAX;\n      if (cpi-\u003esf.hl_sf.accurate_bit_estimate \u0026\u0026\n          cpi-\u003ecommon.current_frame.frame_type !\u003d KEY_FRAME)\n        rc_compute_variance_onepass_rt(cpi);\n```\n\nSo by adding `cpi-\u003eoxcf.rc_cfg.mode \u003d\u003d AOM_CBR` here and at line 2251, we match the condition under which `cpi-\u003erec_sse` is valid.\n\nNote: here we are testing the `accurate_estimate` parameter instead of `cpi-\u003esf.hl_sf.accurate_bit_estimate`. The `accurate_estimate` parameter is usually `cpi-\u003esf.hl_sf.accurate_bit_estimate`, but it may also be equal to 0. If 0 is passed as the `accurate_estimate` parameter, then this function won\u0027t use `cpi-\u003erec_sse`. So we are also safe. (It would be potentially bad if 1 were passed as the `accurate_estimate` parameter.)",
      "revId": "5a4f06774c5271e2991a81f7e0dfa55dcbb4ec03",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}