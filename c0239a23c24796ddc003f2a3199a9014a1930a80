{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5ee592cb_fd284b8e",
        "filename": "av1/common/resize.c",
        "patchSetId": 5
      },
      "lineNbr": 1224,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-12-02T00:40:18Z",
      "side": 0,
      "message": "Yuan: I still don\u0027t understand the `av1_resize_and_extend_frame_c()` function. But if I were to extend it to support 4:4:4 and 4:2:2, I would naively do something like this:\n\n- split `factor` into `factor_x` and `factor_y`.\n- when setting the values of `factor_x` and `factor_y`, consider not only `i` (the plane) but also `subsampling_x` and `subsampling_y`.\n\nDid you consider this approach?",
      "revId": "c0239a23c24796ddc003f2a3199a9014a1930a80",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5a5bb3a6_7f7834ff",
        "filename": "av1/common/resize.c",
        "patchSetId": 5
      },
      "lineNbr": 1224,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-12-02T04:59:10Z",
      "side": 0,
      "message": "Yuan: This CL shows concretely what I meant: https://aomedia-review.googlesource.com/c/aom/+/167482",
      "parentUuid": "5ee592cb_fd284b8e",
      "revId": "c0239a23c24796ddc003f2a3199a9014a1930a80",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aff18323_cc8d11df",
        "filename": "av1/common/resize.c",
        "patchSetId": 5
      },
      "lineNbr": 1224,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-12-02T05:19:16Z",
      "side": 0,
      "message": "The original code, and your CL, scales a 16x16 area of dst image of a plane, for each call of `aom_scaled_2d`. This means for UV plane it\u0027s doing 8x8 per call for 4:2:0 and 8x16 for 4:2:2.\nMy CL always do 16x16 block for each plane instead. This halves call to `aom_scaled_2d` for 4:2:0, and should have better performance.",
      "parentUuid": "5a5bb3a6_7f7834ff",
      "revId": "c0239a23c24796ddc003f2a3199a9014a1930a80",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8f343979_79b4c61e",
        "filename": "av1/common/resize.c",
        "patchSetId": 5
      },
      "lineNbr": 1224,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-12-03T03:10:02Z",
      "side": 0,
      "message": "Thanks for the reply.\n\nYour version has ASan errors. My naive version doesn\u0027t. Here are the steps to reproduce:\n\n```\ncmake ../aom -G Ninja -DSANITIZE\u003daddress\nninja\n./test_libaom --gtest_filter\u003dAV1/DatarateTestSVC.BasicRateTargetingSVC1TL2SL/8\n```\n\nPerhaps your version requires sufficient borders around the frame?",
      "parentUuid": "aff18323_cc8d11df",
      "revId": "c0239a23c24796ddc003f2a3199a9014a1930a80",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c70f7284_a8870d5d",
        "filename": "av1/common/resize.c",
        "patchSetId": 5
      },
      "lineNbr": 1224,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-12-03T04:04:17Z",
      "side": 0,
      "message": "The code wrongly picked `av1_resize_and_extend_frame_c` instead of optimized 2:1 version. Still investigating why there\u0027s asan error in `av1_resize_and_extend_frame_c`.",
      "parentUuid": "8f343979_79b4c61e",
      "revId": "c0239a23c24796ddc003f2a3199a9014a1930a80",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cfd0720f_c35d63f1",
        "filename": "av1/common/resize.c",
        "patchSetId": 5
      },
      "lineNbr": 1224,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-12-03T04:57:22Z",
      "side": 0,
      "message": "The `src` frame\u0027s `border` is 32, so UV plane only has a border of 16. For 2:1 scale down, 8x8 output block needs 16 pixel border so it fits coincidentally.\nYou can see that your CL fails `AV1/DatarateTestSVC.BasicRateTargetingSVC1TL3SL/4` as well, as 4:1 scale down needs 32 pixel border.\nStill finding ways to fix this.",
      "parentUuid": "c70f7284_a8870d5d",
      "revId": "c0239a23c24796ddc003f2a3199a9014a1930a80",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6b778efd_e5a4f076",
        "filename": "av1/common/resize.c",
        "patchSetId": 5
      },
      "lineNbr": 1224,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-12-03T09:14:23Z",
      "side": 0,
      "message": "Done. `av1_resize_and_extend_frame_c` now calls `aom_scaled_2d` with actual working areas, instead of blindly passing 16. SIMD version has some weirdness handling non-standard sizes, so fallback to C version to handle borders.",
      "parentUuid": "cfd0720f_c35d63f1",
      "revId": "c0239a23c24796ddc003f2a3199a9014a1930a80",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}