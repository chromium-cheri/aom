{
  "comments": [
    {
      "key": {
        "uuid": "bd422cd9_d811455f",
        "filename": "av1/av1_dx_iface.c",
        "patchSetId": 2
      },
      "lineNbr": 671,
      "author": {
        "id": 9545
      },
      "writtenOn": "2018-07-10T00:17:30Z",
      "side": 1,
      "message": "Should we also increment *index before returning NULL here?\n\nIt would be more robust to save the current index in a local variable and increment *index at line 667, and then use that local variable at line 724. Specifically:\n\ndiff --git a/av1/av1_dx_iface.c b/av1/av1_dx_iface.c\nindex aa2987d41..f9e4f8047 100644\n--- a/av1/av1_dx_iface.c\n+++ b/av1/av1_dx_iface.c\n@@ -664,6 +664,7 @@ static aom_image_t *decoder_get_frame(aom_codec_alg_priv_t *ctx,\n         aom_film_grain_t *grain_params;\n         if (av1_get_raw_frame(frame_worker_data-\u003epbi, *index, \u0026sd,\n                               \u0026grain_params) \u003d\u003d 0) {\n+          uintptr_t current_index \u003d *index++;  // Advance the iterator to point to the next image \n           AV1Decoder *const pbi \u003d frame_worker_data-\u003epbi;\n           AV1_COMMON *const cm \u003d \u0026pbi-\u003ecommon;\n           RefCntBuffer *const frame_bufs \u003d cm-\u003ebuffer_pool-\u003eframe_bufs;\n@@ -719,10 +720,8 @@ static aom_image_t *decoder_get_frame(aom_codec_alg_priv_t *ctx,\n           img \u003d \u0026ctx-\u003eimg;\n           img-\u003etemporal_id \u003d cm-\u003etemporal_layer_id;\n           img-\u003espatial_id \u003d cm-\u003espatial_layer_id;\n-          aom_image_t *res \u003d add_grain_if_needed(\n-              img, \u0026ctx-\u003eimage_with_grain[*index], grain_params);\n-          *index +\u003d 1;  // Advance the iterator to point to the next image\n-          return res;\n+          return add_grain_if_needed(\n+              img, \u0026ctx-\u003eimage_with_grain[current_index], grain_params);\n         }\n       } else {\n         // Decoding failed. Release the worker thread.",
      "range": {
        "startLine": 671,
        "startChar": 10,
        "endLine": 671,
        "endChar": 44
      },
      "revId": "6ce96f05d8efcd4f877a458f15249c49fa828a92",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    }
  ]
}