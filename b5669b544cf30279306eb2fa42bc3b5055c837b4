{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "30e03aae_1522f0c8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 15298
      },
      "writtenOn": "2021-05-25T18:20:54Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThis patch abstracts mv_stats, which stores the previous frame\u0027s motion vector stats, in AV1_PRIMARY. Since the last frame\u0027s MV stats are used in deciding the MV precision for the current frame, in order to ensure that all the frames in a parallel encode set start with the same mv_stats, this patch disables the end-of-frame collection of mv_stats for the frames, except for the last frame in a parallel encode set.\n\nThis change is tested with integer, undefined, address and thread sanitizer tests locally. The cumulative quality impact of all the CLs in this dependent chain are given below.\n\nPlease find the detailed borg result(on patchset-1) with CONFIG_FRAME_PARALLEL_ENCODE 1 (test) vs 0 (ref) below.\n\nWith frame level contexts\u003d2:\n CPU-Used | Resolution | Instruction Count|    BD-Rate Impact %          |\n          |            |   Reduction %    | avg.psnr ovr.psnr   ssim     |\n          |            |                  |  8 - bit  8 - bit  8 - bit   |\n--------- |----------- |------------------|--------  --------  --------  |\n  0       |  AVERAGE   |        2.918     |  0.7269   0.7281   0.8626    |\n  1       |  AVERAGE   |        1.500     |  0.6770   0.6586   0.8072    |\n  2       |  AVERAGE   |        0.901     |  0.8044   0.8029   0.9453    |\n  3       |  AVERAGE   |        0.758     |  0.8420   0.8515   0.9260    |\n  4       |  AVERAGE   |        0.473     |  0.9123   0.9257   0.9898    |\n  5       |  AVERAGE   |        0.401     |  1.0183   1.0340   1.1817    |\n  6       |  AVERAGE   |        0.219     |  1.2381   1.2503   1.3089    |\n--------------------------------------------------------------------------\n\nWith frame level contexts\u003d3:\n CPU-Used | Resolution | Instruction Count|    BD-Rate Impact %          |\n          |            |   Reduction %    | avg.psnr ovr.psnr   ssim     |\n          |            |                  |  8 - bit  8 - bit  8 - bit   |\n--------- |----------- |------------------|--------  --------  --------  |\n  2       |  AVERAGE   |        0.906     |  0.8063   0.7955   0.9553    |\n  3       |  AVERAGE   |        0.760     |  0.8727   0.8699   0.9633    |\n  4       |  AVERAGE   |        0.455     |  0.9127   0.9277   0.9966    |\n  5       |  AVERAGE   |        0.403     |  1.0014   1.0132   1.1562    |\n  6       |  AVERAGE   |        0.200     |  1.2431   1.2548   1.3096    |\n--------------------------------------------------------------------------\n\nWith frame level contexts\u003d4:\n CPU-Used | Resolution | Instruction Count|    BD-Rate Impact %          |\n          |            |   Reduction %    | avg.psnr ovr.psnr   ssim     |\n          |            |                  |  8 - bit  8 - bit  8 - bit   |\n--------- |----------- |------------------|--------  --------  --------  |\n  2       | AVERAGE    |       0.883      |  0.8113   0.8040   0.9734    |\n  3       | AVERAGE    |       0.758      |  0.8572   0.8608   0.9535    |\n  4       | AVERAGE    |       0.466      |  0.9106   0.9204   0.9953    |\n  5       | AVERAGE    |       0.389      |  1.0099   1.0200   1.1640    |\n  6       | AVERAGE    |       0.197      |  1.2406   1.2512   1.3107    |\n--------------------------------------------------------------------------\n\nPlease find the CQP results with CONFIG_FRAME_PARALLEL_ENCODE 1 (test) vs 0 (ref) on a subset of hdres (10 contents) below.\n\nWith frame level contexts\u003d2:\n CPU-Used | Resolution | Instruction Count|    BD-Rate Impact %          |\n          |            |   Reduction %    | avg.psnr ovr.psnr   ssim     |\n          |            |                  |  8 - bit  8 - bit  8 - bit   |\n--------- |----------- |------------------|--------  --------  --------  |\n  0       |  AVERAGE   |      3.979       |  0.6406   0.6382   0.7178    |\n  1       |  AVERAGE   |      1.633       |  0.6612   0.6705   0.6901    |\n  2       |  AVERAGE   |      0.193       |  0.8142   0.8125   0.8253    |\n  3       |  AVERAGE   |      0.262       |  0.6119   0.6328   0.6927    |\n  4       |  AVERAGE   |      0.441       |  0.6598   0.6799   0.5622    |\n  5       |  AVERAGE   |     -0.098       |  0.7863   0.7722   0.9387    |\n  6       |  AVERAGE   |     -0.057       |  1.2076   1.1947   1.2101    |\n--------------------------------------------------------------------------\n\nWith frame level contexts\u003d3:\n CPU-Used | Resolution | Instruction Count|    BD-Rate Impact %          |\n          |            |   Reduction %    | avg.psnr ovr.psnr   ssim     |\n          |            |                  |  8 - bit  8 - bit  8 - bit   |\n--------- |----------- |------------------|--------  --------  --------  |\n  2       |  AVERAGE   |       0.260      |  0.8252   0.8179   0.8808    |\n  3       |  AVERAGE   |       0.314      |  0.5777   0.5987   0.6214    |\n  4       |  AVERAGE   |       0.368      |  0.7055   0.7169   0.6456    |\n  5       |  AVERAGE   |      -0.166      |  0.7698   0.7578   0.9165    |\n  6       |  AVERAGE   |      -0.107      |  1.2411   1.2254   1.2349    |\n--------------------------------------------------------------------------\n\nWith frame level contexts\u003d4:\n CPU-Used | Resolution | Instruction Count|    BD-Rate Impact %          |\n          |            |   Reduction %    | avg.psnr ovr.psnr   ssim     |\n          |            |                  |  8 - bit  8 - bit  8 - bit   |\n--------- |----------- |------------------|--------  --------  --------  |\n  2       |  AVERAGE   |       0.282      |  0.8199   0.8169   0.8645    |\n  3       |  AVERAGE   |       0.301      |  0.5785   0.6005   0.6245    |\n  4       |  AVERAGE   |       0.346      |  0.6912   0.7141   0.6472    |\n  5       |  AVERAGE   |      -0.150      |  0.7871   0.7743   0.9287    |\n  6       |  AVERAGE   |      -0.121      |  1.2403   1.2228   1.2440    |\n--------------------------------------------------------------------------\nIn the commit message, BD rate impact column:\n[+] sign is for BD-Rate drop\n[-] sign is for BD-Rate improvement\nThe instruction count reduction specified has been measured using command:\n$ perf stat -e instructions:u ./aomenc â€¦\n\nBit-match is locally verified (for CONFIG_FRAME_PARALLEL_ENCODE \u003d 0) for speed 2 to 6 on a few test cases.\n\nPlease review this patch.\nThanks",
      "revId": "b5669b544cf30279306eb2fa42bc3b5055c837b4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7787d9d3_f4758bf6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-05-25T22:44:11Z",
      "side": 1,
      "message": "looks good.",
      "revId": "b5669b544cf30279306eb2fa42bc3b5055c837b4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}