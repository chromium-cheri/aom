{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b2bb2ba9_9fa350c2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 14993
      },
      "writtenOn": "2021-10-14T16:19:23Z",
      "side": 1,
      "message": "Please review.",
      "revId": "232cb14bf8eb34e4c148bc172c75df13f2425cc9",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5ee6dede_78b80c08",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T00:31:08Z",
      "side": 1,
      "message": "Hi Jayasanker,\n\nThank you for the new patchset. I still think there is a change of behavior when for_psnr is true. Please see my comment marked with \"IMPORTANT\".",
      "revId": "232cb14bf8eb34e4c148bc172c75df13f2425cc9",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c084bf11_7eb261d9",
        "filename": "av1/common/resize.c",
        "patchSetId": 3
      },
      "lineNbr": 1349,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T00:31:08Z",
      "side": 1,
      "message": "Let\u0027s change the variable names back to \"scaled_width\" and \"scaled_height\". I now see the original names make sense because these variables are the width and height of the \u0027scaled\u0027 variable. Sorry about making you do extra work.",
      "revId": "232cb14bf8eb34e4c148bc172c75df13f2425cc9",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4e6fcec_d799ce9d",
        "filename": "av1/common/resize.c",
        "patchSetId": 3
      },
      "lineNbr": 1351,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T00:31:08Z",
      "side": 1,
      "message": "IMPORTANT: I still believe the behavior is changed when for_psnr is true.\n\nThe original code allocates cpi-\u003escaled_source with the dimensions cm-\u003ewidth and cm-\u003eheight at line 377 in av1/encoder/encoder_alloc.h, whether for_psnr is true or not. The new code will allocate cpi-\u003escaled_source with the dimensions cm-\u003esuperres_upscaled_width and cm-\u003esuperres_upscaled_height when for_psnr is true. Isn\u0027t the behavior changed?\n\nIn addition, if encode_show_existing_frame(cm) is true, the following code is called before we arrive here:\n\n    if (is_psnr_calc_enabled(cpi)) {\n      cpi-\u003esource \u003d\n          realloc_and_scale_source(cpi, cm-\u003ecur_frame-\u003ebuf.y_crop_width,\n                                   cm-\u003ecur_frame-\u003ebuf.y_crop_height);\n    }\n   \nIn this case cpi-\u003escaled_source has been allocated with the dimensions cm-\u003ecur_frame-\u003ebuf.y_crop_width and cm-\u003ecur_frame-\u003ebuf.y_crop_height. Are cm-\u003esuperres_upscaled_width and cm-\u003esuperres_upscaled_height equal to cm-\u003ecur_frame-\u003ebuf.y_crop_width and cm-\u003ecur_frame-\u003ebuf.y_crop_height? If they are different, then this CL also changes the behavior in this case.\n\nI analyzed the code carefully but I am not familiar with this part of libaom. Is there an error in my analysis?\n\nNote: I noticed that realloc_and_scale_source() passes AOM_BORDER_IN_PIXELS to aom_realloc_frame_buffer(). If cpi-\u003eoxcf.border_in_pixels is not equal to AOM_BORDER_IN_PIXELS, then this is another change of behavior. Please see my comment at line 1064 below.",
      "revId": "232cb14bf8eb34e4c148bc172c75df13f2425cc9",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec4f2698_34027f11",
        "filename": "av1/encoder/encode_strategy.c",
        "patchSetId": 3
      },
      "lineNbr": 1064,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T00:31:08Z",
      "side": 1,
      "message": "Should we pass AOM_BORDER_IN_PIXELS instead of cpi-\u003eoxcf.border_in_pixels here to match the value used in realloc_and_scale_source()?",
      "revId": "232cb14bf8eb34e4c148bc172c75df13f2425cc9",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1c0c0893_ccd8be4f",
        "filename": "av1/encoder/encoder_alloc.h",
        "patchSetId": 3
      },
      "lineNbr": 356,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-15T00:31:08Z",
      "side": 1,
      "message": "Optional/later: This function only allocates the cpi-\u003etrial_frame_rst buffer now, so we can rename the function to be more exact. We can do this in a follow-up CL.",
      "range": {
        "startLine": 356,
        "startChar": 23,
        "endLine": 356,
        "endChar": 47
      },
      "revId": "232cb14bf8eb34e4c148bc172c75df13f2425cc9",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}