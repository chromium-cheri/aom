{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "68b34739_3af23d66",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 8893
      },
      "writtenOn": "2023-08-03T16:58:23Z",
      "side": 1,
      "message": "This CL adds a speed feature to reduce the number of frames considered in TPL by skipping TPL processing for LF_UPDATE frames.  The results are as follows:\n```\n                  Instruction Count        BD-Rate Loss(%)\ncpu   Resolution   Reduction(%)    avg.psnr   ovr.psnr     ssim   \n 6       LOWRES2     -0.000         0.0000      0.0000     0.0000    \n 6       MIDRES2      1.053        -0.6726     -0.5757    -0.1711    \n 6        HDRES2      2.009        -0.3081     -0.2670    -0.0548    \n 6       Average      1.014        -0.3270     -0.2810    -0.0754   \n\nThe instruction count reduction specified has been measured using command:\n$ perf stat -e instructions:u ./aomenc\n```\nThe BD-Rate gain observed is because of the following:\n- As TPL statistics of LF_UPDATE frames are not present, the sf `inter_sf.prune_inter_modes_based_on_tpl` is turned off for those frames. \n- The ML model which prunes intra search in inter frames (i.e., sf `skip_intra_in_interframe`) is turned off for LF_UPDATE frames as TPL statistics are not present.\n- The highest layer INTNL_ARF_UPDATE frames (specifically frame number 2, 6, 10, 14 for gf group size\u003d16)  are used as reference by LF_UPDATE frames. Now, during TPL processing as LF_UPDATE frames are skipped, most of the highest layer INTNL_ARF_UPDATE frames are not referenced. This results in setting of `delta_q_present_flag` (function `allow_deltaq_mode()`) to 0 for the  highest layer INTNL_ARF_UPDATE frames (NOTE : In the current codebase, `delta_q_present_flag` is set to 0 for LF_UPDATE frames only). \n\nThe speed feature is disabled for lowres as there is no instruction count reduction but BD-Rate loss for ssim as follows:\n```\n                  Instruction Count      BD-Rate Loss(%)\ncpu   Resolution   Reduction(%)      avg.psnr   ovr.psnr    ssim   \n 6      LOWRES2      -0.025          -0.4578    -0.4199    0.1693   \n```\nIn this CL, the speed feature is enabled only for speed 6. The results of extending this sf to speed 5 are as follows:\n```\n                   Instruction Count        BD-Rate Loss(%)\ncpu   Resolution   Reduction(%)       avg.psnr   ovr.psnr    ssim   \n 5       LOWRES2     -0.000            0.0000      0.0000     0.0000\n 5       MIDRES2      0.519           -0.5526     -0.5091    -0.0432\n 5        HDRES2      0.967           -0.2306     -0.1972     0.0063\n 5       Average      0.482           -0.2619     -0.2365    -0.0128\n```\nPlease let us know your opinion.",
      "revId": "422ec1b9765b42e4c838a72a9dbb1d1bf59897dd",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4ed55e16_c544c542",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-08-04T16:56:09Z",
      "side": 1,
      "message": "Really good coding gain! From what you mentioned above, does it \n mean inter_sf.prune_inter_modes_based_on_tpl and skip_intra_in_interframe give bad speed/quality tradeoff at least for speed 6?\n\nRegarding delta_q_present_flag change, so the coding gain is due to delta_q signaling saving? Does the coding gain mostly come from this change or the above 2 sf disabling?\n\nAny clips show quality loss?\n\nThis looks good for speed 5 as well. Thanks.",
      "parentUuid": "68b34739_3af23d66",
      "revId": "422ec1b9765b42e4c838a72a9dbb1d1bf59897dd",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6d5938c_532e754b",
        "filename": "av1/encoder/tpl_model.c",
        "patchSetId": 2
      },
      "lineNbr": 1884,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-08-04T16:56:09Z",
      "side": 1,
      "message": "How does a fixed factor work here? Besides # of leaf frames, would this factor be affected by other factors?",
      "range": {
        "startLine": 1884,
        "startChar": 27,
        "endLine": 1884,
        "endChar": 70
      },
      "revId": "422ec1b9765b42e4c838a72a9dbb1d1bf59897dd",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}