{
  "comments": [
    {
      "key": {
        "uuid": "5f63ebc7_7326c552",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 4
      },
      "lineNbr": 3534,
      "author": {
        "id": 5185
      },
      "writtenOn": "2019-05-31T16:39:00Z",
      "side": 0,
      "message": "The coding gain from this CL is nice. But could you explain more about the change?\n\nrd_stats-\u003eskip seems obtained from txfm_rd_in_plane(). If rd_stats-\u003eskip \u003d 1, all tx blocks\u0027 eobs are 0. So, it makes sense to me to use the above way to calculate rdcost, right?\nIs rd_stats-\u003edist equal to rd_stats-\u003esse in this situation?",
      "range": {
        "startLine": 3534,
        "startChar": 6,
        "endLine": 3534,
        "endChar": 72
      },
      "revId": "04ca87db8093d46349af1dff2a2b4dd855869535",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08b6b426_0b7b5262",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 4
      },
      "lineNbr": 3534,
      "author": {
        "id": 12554
      },
      "writtenOn": "2019-05-31T18:14:25Z",
      "side": 0,
      "message": "We do feel the same for inter blocks. However for intra blocks, we see that intra mode decision (finding best of angular modes etc) does not consider skip case. This could be because of the following:\n1.\tChroma evaluation may make the block as non-skip (though so far block is implicit skip)\n2.\tMaking intra blocks as skip may be good in rd-sense (for that frame), however subsequent frames (referring intra frames) may not be coded with good quality as skip distortion can be high\nDue to above, we felt that doing all the evaluations considering non-skip cost may be recommended for consistency (in case of intra).\n\nIn this case rdcost-\u003erate corresponds to zero_blk_rate of all TU blocks and rdcost-\u003edist corresponds to SSE (if the block turns out to be implicit skip after quantization).",
      "parentUuid": "5f63ebc7_7326c552",
      "range": {
        "startLine": 3534,
        "startChar": 6,
        "endLine": 3534,
        "endChar": 72
      },
      "revId": "04ca87db8093d46349af1dff2a2b4dd855869535",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8d0c39d_b8321c65",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 4
      },
      "lineNbr": 3534,
      "author": {
        "id": 12554
      },
      "writtenOn": "2019-06-10T11:59:24Z",
      "side": 0,
      "message": "To add further,\n\nCode snippets 1,2 and 3 correspond to intra mode decision where rate and distortion are used for rd cost calculation. This implies that decisions are as if block is non-skip. Hence the transform size decision is modified to be consistent with mode decision.  \n\nDuring transform size decision (for luma), \nIf the block is implicit skip, rate is non_skip_rate + zero_sub_block_rate and distortion would be same as SSE.\nIf the block is not skip, rate is non_skip_rate + coeff_rate.\n\nFor the final winner mode, \nBlock will be signaled as skip if it is implicit skip (after luma and chroma are evaluated) and blk skip cost is lower\nIf the blk skip cost is not lower and it is implicit skip, still the block would be signaled as non-skip, but with a zero sub-block signaling. This is quite possible as skip rate for intra blocks can be higher.\n\nWe are planning to submit some more changes (in this context), once the current patch is merged.",
      "parentUuid": "08b6b426_0b7b5262",
      "range": {
        "startLine": 3534,
        "startChar": 6,
        "endLine": 3534,
        "endChar": 72
      },
      "revId": "04ca87db8093d46349af1dff2a2b4dd855869535",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "273f0540_91f3e524",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 4
      },
      "lineNbr": 3534,
      "author": {
        "id": 5022
      },
      "writtenOn": "2019-06-12T23:05:32Z",
      "side": 0,
      "message": "It seems that the change might give lower rate cost to intra + skip mode?\n\nIf that\u0027s the case, we would want to avoid it, since that would make perceptual quality worse. It probably will slightly improve the objective quality though.",
      "parentUuid": "a8d0c39d_b8321c65",
      "range": {
        "startLine": 3534,
        "startChar": 6,
        "endLine": 3534,
        "endChar": 72
      },
      "revId": "04ca87db8093d46349af1dff2a2b4dd855869535",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "475f9aeb_3233a8b1",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 4
      },
      "lineNbr": 3534,
      "author": {
        "id": 12554
      },
      "writtenOn": "2019-06-13T07:02:48Z",
      "side": 0,
      "message": "With respect to the rate cost signaled, it is not necessarily true that intra+skip mode takes lower cost.\n1. s0 would be mostly lower than s1 for intra blocks, however \"rd_stats-\u003erate + s0\" may or may not be lower than s1 (rd_stats-\u003erate would be sum of all zero sub block rates)\n2. The distortion is same as that of SSE. \nHence, with the changes made, we feel that there is no bias given to any specific type of signaling. It should only remove the inconsistency with mode decision.",
      "parentUuid": "273f0540_91f3e524",
      "range": {
        "startLine": 3534,
        "startChar": 6,
        "endLine": 3534,
        "endChar": 72
      },
      "revId": "04ca87db8093d46349af1dff2a2b4dd855869535",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    }
  ]
}