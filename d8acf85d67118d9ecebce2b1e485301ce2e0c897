{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "92ddabe2_8dc23153",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-03-30T17:40:13Z",
      "side": 1,
      "message": "Hi Wan-Teh, Frank,\n\nThe buffer winner_mode_stats is used to store the details of the winner modes from mode decision. Transform search is performed conservatively on these winner modes.\nThis buffer is not required in the following cases:\n1) When use_nonrd_pick_mode sf is set to 1 and hybrid_intra_pickmode sf is set to 0.\n2) When multi_winner_mode_type sf is set to MULTI_WINNER_MODE_OFF.\n3) During the stats generation stage.\nIn this CL we have avoided the allocation of winner_mode_stats for these cases.\n\nIn the parent commit, memory was being allocated for winner_mode_stats based on winner_mode_count, whose value was set to 3 for intra frames and 1 for inter frames. In this CL, we have introduced a lookup table “winner_mode_count_allowed”  to derive the winner_mode_count based on speed feature multi_winner_mode_type. This facilitates dynamic memory allocation for winner_mode_stats only for the required number of candidates as dictated by multi_winner_mode_type.\n\nWe have also abstracted the piece of code related to winner_mode_stats buffer allocation into a new function allocate_winner_mode_stats() and have cleaned up the interface of av1_alloc_mb_data() function by passing cpi structure and deriving the required parameters inside the function using it.\n\nFor libaom AV1 video encode, bit-match is verified (w.r.t. parent commit) for \u0027GOOD\u0027, \u0027RT\u0027 and \u0027ALLINTRA\u0027 encoding modes for a few contents with different encoding configurations. It was also verified that the output of AVIF encode is bit-exact w.r.t. parent version for a typical image dataset.\n\nHEAP memory reduction was measured using the command below. \n$valgrind --tool\u003dmassif ./aomenc …\n\nPlease review.\n\nRegards,\nMudassir.",
      "revId": "d8acf85d67118d9ecebce2b1e485301ce2e0c897",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "258db5c1_34662c8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-04-01T01:59:37Z",
      "side": 1,
      "message": "Hi Mudassir,\n\nI am sorry I could not finish the review today. I am publishing the review comments I have so far. I will try to finish the review tomorrow. Thanks.",
      "revId": "d8acf85d67118d9ecebce2b1e485301ce2e0c897",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0ce81c3_263148e9",
        "filename": "av1/encoder/block.h",
        "patchSetId": 1
      },
      "lineNbr": 1241,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-04-01T01:59:37Z",
      "side": 1,
      "message": "It is often an error to pass a null pointer to a function. Please document what it means when this function receives a null \u0027stats\u0027 parameter.",
      "revId": "d8acf85d67118d9ecebce2b1e485301ce2e0c897",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f585e158_18c315b0",
        "filename": "av1/encoder/rdopt.c",
        "patchSetId": 1
      },
      "lineNbr": 5838,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-04-01T01:59:37Z",
      "side": 1,
      "message": "Nit: Move this comment before the variable declaration:\n\n```\n  // Initialize best mode stats for winner mode processing\n  const int max_winner_mode_count \u003d\n      winner_mode_count_allowed[cpi-\u003esf.winner_mode_sf.multi_winner_mode_type];\n```",
      "revId": "d8acf85d67118d9ecebce2b1e485301ce2e0c897",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3206f283_85549844",
        "filename": "av1/encoder/rdopt_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 238,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-04-01T01:59:37Z",
      "side": 1,
      "message": "Nit: The elements of this array happen to be equal to multi_winner_mode_type + 1. Is this just a coincidence?\n\nIf this is not a coincidence, then we can get rid of this table.",
      "revId": "d8acf85d67118d9ecebce2b1e485301ce2e0c897",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54009f55_a2b9e3cd",
        "filename": "av1/encoder/speed_features.h",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-04-01T01:59:37Z",
      "side": 1,
      "message": "If this enum value means the number of other enum values, it is conventionally named \u003cenum-name\u003e_COUNT and the initializer is omitted, as follows:\n\n  MULTI_WINNER_MODE_COUNT,",
      "revId": "d8acf85d67118d9ecebce2b1e485301ce2e0c897",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}