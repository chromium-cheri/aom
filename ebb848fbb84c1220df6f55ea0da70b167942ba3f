{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ca584524_40ba8c03",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 25661
      },
      "writtenOn": "2021-03-09T15:03:25Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nIn this CL, we have optimized memory usage in YV12_BUFFER_CONFIG by\nallocating memory for y_buffer_8bit conditionally for \nglobal motion configuration.\n\nThis CL is verified to be bit-exact with no impact on encode-time.\n\nPFB the memory reduction results for this patch for encoder, \nmeasured using the command\n$valgrind --tool\u003dmassif ./aomenc ... for cpu-used 5, 60 frames:\n\nResolution    Tile    Avg Memory reduction\n                      Single   Multi\n                      thread   thread\n640x360       2x1     5.46%    5.31% (2 threads)\n832x480       2x1     5.97%    5.88% (2 threads)\n1280x720      2x2     6.84%    6.63% (4 threads)\n1920x1080     4x2     5.12%    7.10% (8 threads)\n\nPFB the memory reduction results for this patch for decoder,\nmeasured using the command\n$valgrind --tool\u003dmassif ./aomdec ... :\n\nResolution    Tile    Memory reduction\n\n                      Single   Multi\n                      thread   thread\n640x360       2x1     18.17%   17.40% (2 threads)\n832x480       2x1     18.20%   17.70% (2 threads)\n1280x720      2x2     18.39%   17.66% (4 threads)\n1920x1080     4x2     18.29%   17.46% (8 threads)\n\nMemory profiling results generated using the valgrind-massif tool seems\nto be consistent.\n\nPlease review.\n\nRegards,\nChethan.",
      "revId": "ebb848fbb84c1220df6f55ea0da70b167942ba3f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e4b2afcb_924020e8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-03-09T18:38:14Z",
      "side": 1,
      "message": "Nice memory reduction for both encoder \u0026 decoder!\n\nQuestions: The results shown above are for multi-tile \u0026 multi-thread cases. This should also help single-tile/single thread situation, right? Also, above encoder test used cpu-used \u003d 5. Global motion (GM) is disabled at speed 5, right? Do we still allocate GM related memory at speed 5? Should you test speed 1 or 2 where GM is enabled?",
      "parentUuid": "ca584524_40ba8c03",
      "revId": "ebb848fbb84c1220df6f55ea0da70b167942ba3f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "198f6b0c_ca926f3c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-03-09T19:55:52Z",
      "side": 1,
      "message": "I will check in this CL.",
      "revId": "ebb848fbb84c1220df6f55ea0da70b167942ba3f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2a35ed90_025782b6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 25661
      },
      "writtenOn": "2021-03-10T16:44:56Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThank you for the code review.\n\nThe 8-bit buffer of Global motion (y_buffer_8bit) is allocated irrespective of speed feature gm_sf.gm_search_type. Because y_buffer_8bit buffer is being allocated before speed feature initialization. Hence the speed feature is not considered in allocating memory for y_buffer_8bit buffer. Also, encoder needs y_buffer_8bit buffer, if application changes the cpu preset at runtime (i.e, changing from speed level 3 to lower speed levels).\n\nHowever, if application disables the global motion tool (oxcf.tool_cfg.enable_global_motion \u003d 0), y_buffer_8bit buffer is not allocated.\nWe have triggered the memory tests for single-tile/single thread configuration and speed 1, 2. We shall update you as soon as the data is available.",
      "parentUuid": "e4b2afcb_924020e8",
      "revId": "ebb848fbb84c1220df6f55ea0da70b167942ba3f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}