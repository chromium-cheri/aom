{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "669f0edb_dcf5de75",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "Sai: We need to first decide whether we want to use a third-party color conversion library like libyuv or write our own color conversion functions. I still post some review comments on the code below, but it would be better to use libyuv.",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0242b391_4fff7616",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-19T19:59:44Z",
      "side": 1,
      "message": "Thank you Wan-Teh for the careful review!  Let me try to use libyuv first.",
      "parentUuid": "669f0edb_dcf5de75",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "abb710a2_6b75edb6",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 12,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "Should we remove the TODO comment now?",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4aedac5f_5e98d425",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 12,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "abb710a2_6b75edb6",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e6c24509_a688d745",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 18,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "I suggest we use a third-party library such as libyuv for color conversion. I found third_party/libyuv in the libaom source tree. Can we use that?",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0cbfeeea_7e2ce239",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 18,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e6c24509_a688d745",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "557dc655_a6ced41e",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 19,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "The 16 in RGBtoYUVMatrixAdd[] means this is limited range, not full range. We should get the range from the image. Here are the relevant fields in the aom_image struct:\n\n  typedef struct aom_image {\n    aom_img_fmt_t fmt;                 /**\u003c Image Format */\n    aom_color_primaries_t cp;          /**\u003c CICP Color Primaries */\n    aom_transfer_characteristics_t tc; /**\u003c CICP Transfer Characteristics */\n    aom_matrix_coefficients_t mc;      /**\u003c CICP Matrix Coefficients */\n    int monochrome;                    /**\u003c Whether image is monochrome */\n    aom_chroma_sample_position_t csp;  /**\u003c chroma sample position */\n    aom_color_range_t range;           /**\u003c Color Range */\n\nThe \u0027range\u0027 field tells us whether the image is limited range or full range. The \u0027mc\u0027 field tells us which matrix coefficients to use. It is not always BT.709. BT.601 matrix coefficients are very common and are the default in AVIF if matrix coefficients are unspecified.\n\nWe should ask Jyrki and Luca which matrix coefficients should be the default.",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f7db6a04_8910bdb3",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 19,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "I think by default it is the sRGB color space.\nI cannot find yuv-\u003esrgb conversion function in the lib.\nI added a TODO and I think we are good for now since they are very close.",
      "parentUuid": "557dc655_a6ced41e",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05d00d8c_4028d7ab",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 19,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T19:27:33Z",
      "side": 1,
      "message": "I tested these fields. In my test files (.y4m), all of them are 0:\nmatrix_coefficients, transfer_characteristics, color_range, transfer_characteristics\nI added checks in av1_cx_iface.c. Please take a look",
      "parentUuid": "f7db6a04_8910bdb3",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a0c42cb_69f751da",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 19,
      "author": {
        "id": 21182
      },
      "writtenOn": "2021-02-24T00:44:07Z",
      "side": 1,
      "message": "So, I\u0027ve found an issue in this commit.\nIt seems to remove the pkgconfig setup and hardcodes static library names for some reason, making it extremely hard to include tune\u003dbutteraugli support even with both static and dynamic libraries of the latest JXL 0.3.2 build installed on my system.\n\nRemoving the cmakelists.txt hardcoded library names fixes the issue, so this would probably be the way to go. The libyuv stuff is fine however. Everything else in the commit is fine.",
      "parentUuid": "05d00d8c_4028d7ab",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c32d1b3c_631af209",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 19,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-24T03:31:21Z",
      "side": 1,
      "message": "Hi Zak, can you send me your cmakelists.txt? I tried to use pkgconfig, but cannot build it with static jpeg-xl libs.",
      "parentUuid": "3a0c42cb_69f751da",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fdc78dba_6061f1ec",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 19,
      "author": {
        "id": 21182
      },
      "writtenOn": "2021-02-24T04:16:03Z",
      "side": 1,
      "message": "Here it is: https://drive.google.com/file/d/1K-ebm22ZzS2YjMe1wQJ7ebe2PsaAtDS5/view?usp\u003dsharing\n\nThis managed to get it working fine. I just reverted the changes using the diff inside of the Cmakelist, which made it work normally.",
      "parentUuid": "c32d1b3c_631af209",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8c1d8e83_e23fc86f",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 19,
      "author": {
        "id": 21182
      },
      "writtenOn": "2021-02-24T05:13:23Z",
      "side": 1,
      "message": "However, I did this job rather quickly, so I\u0027d personally check if there are any mistakes, just in case I did something really bad without noticing.",
      "parentUuid": "fdc78dba_6061f1ec",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6321ec7_711a757b",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 21,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "IMPORTANT: The denominator should be 255., not 256., right?",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5ab0b101_3502351b",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 21,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "I copied the code from our img eval.  I think we should make modifications there.",
      "parentUuid": "d6321ec7_711a757b",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "59f2e7fe_56054d6f",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 23,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "Nit/optional: I don\u0027t know if libaom follows the naming convention for constants in the Google C++ Style Guide. If it does, then these constants should be named with a leading \"k\": kRGBtoYUVMatrixAdd and kYUVtoRGBMatrix",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "11e3a5ef_13cea7cf",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 23,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "ack",
      "parentUuid": "59f2e7fe_56054d6f",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4fe59fa1_9f79c519",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 28,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "This may not really matter, but in standards we usually round first and then clamp. I suggest we perform these two operations in that order.",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f90d981b_36a56c48",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 28,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "ack",
      "parentUuid": "4fe59fa1_9f79c519",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b434a550_5e38e611",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 87,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "Nit: It is safer to use \u0027j\u0027 instead of \u0027y_index\u0027 here, in the unlikely case that row_stride_y is an odd number.",
      "range": {
        "startLine": 87,
        "startChar": 10,
        "endLine": 87,
        "endChar": 17
      },
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "446f1f16_95fc73e2",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 87,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "ack",
      "parentUuid": "b434a550_5e38e611",
      "range": {
        "startLine": 87,
        "startChar": 10,
        "endLine": 87,
        "endChar": 17
      },
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a60551f4_1ebe8b5c",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 141,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-19T19:49:05Z",
      "side": 1,
      "message": "Nit: Please move this to the beginning of the function.",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d42f2b7b_1ec765b0",
        "filename": "aom_dsp/butteraugli.c",
        "patchSetId": 11
      },
      "lineNbr": 141,
      "author": {
        "id": 13184
      },
      "writtenOn": "2021-02-20T04:09:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a60551f4_1ebe8b5c",
      "revId": "1025301c0dde6e2c8c9985d782b22d46654a5764",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}