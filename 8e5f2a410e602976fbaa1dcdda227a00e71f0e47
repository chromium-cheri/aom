{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "60ea0ccd_53a27f0f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-19T15:03:02Z",
      "side": 1,
      "message": "Hi Wan-Teh,\n\nWe have pushed the latest patch-set after taking care of your comments. \n\nPlease review.\n\nRegards,\nMudassir",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31a4b9eb_1c2958c8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "LGTM. I suggest some changes to the comments and have some questions to verify my understanding.",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "87db697e_d1ecb4bc",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 22,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "Nit: This sentence is a little hard to parse. I suggest two possible rewrites:\n\n    Even though there are 7 delta angles, this macro is set to 9 to facilitate\n    the rd threshold check to prune the -3 and 3 delta angles.\n    \nor\n\n    To facilitate the rd threshold check to prune the -3 and 3 delta angles,\n    this macro is set to 9 even though there are 7 delta angles.",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cd756a2e_4c28f765",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 22,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "87db697e_d1ecb4bc",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fe999390_654bd7ac",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 29,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "Optional: It would be good to add a comment to explain why this order is chosen. I am curious. I guess this order evaluates the even angles (-2, 2) first, before the odd angles (-3, -1, 1, 3), right?",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "10292495_99095aa8",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 29,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fe999390_654bd7ac",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "43aad452_cf0447c8",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 386,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "[This is just a question. No change requested.] I am just wondering why you renamed this variable. Is it because this variable is used as the index for the luma_delta_angles_order array?",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f01d7010_21d02a24",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 386,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "\u003e Is it because this variable is used as the index for the luma_delta_angles_order array?\nYes, with the current implementation this variable is used as an index for luma_delta_angles_order array.",
      "parentUuid": "43aad452_cf0447c8",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc55c8ee_3a2f787d",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 394,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "[This is also just a question. It\u0027s related to my question above.]\n\nIs mbmi-\u003eangle_delta[PLANE_TYPE_Y] a delta angle or an index?  Here we assign it a value of (delta_angle_eval_idx - 3) or (delta_angle_eval_idx - 2), so it looks like an index.",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "74c569b3_db5fc689",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 394,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "mbmi-\u003eangle_delta is a syntax element from which the actual delta angle is derived during the prediction. Here delta_angle_eval_idx can be treated as an index  to derive the syntax element.",
      "parentUuid": "fc55c8ee_3a2f787d",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef03fd40_06fdc3c6",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1335,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "Just wanted to check my understanding: the \"center\" delta angle is 0, and the even delta angles are -2 and 2, right?\n\nOptional: Since 0 is also an even number, maybe we can omit \"center and\" in the comment?",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fd9539eb_d534aecf",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1335,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ef03fd40_06fdc3c6",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e36338c6_66d6c5e7",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1345,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "Can this addition overflow int64_t?\n\nIf we clamp this value, we may need to clamp it to INT64_MAX - 1. See my next comment.",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50014567_f3761243",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1345,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "As per our understanding, rd_thresh is not supposed to overflow. Also the condition at line 1340 ensures that rd_thresh will never be INT64_MAX. We also observed a similar implementation in rd_pick_intra_angle_sbuv().",
      "parentUuid": "e36338c6_66d6c5e7",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7709096f_119d69d6",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1357,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "The table in the comment is very clear. Thanks.\n\nHowever, it is not clear to me why luma_delta_angle + MAX_ANGLE_DELTA and luma_delta_angle + MAX_ANGLE_DELTA + 2 are the neighbors of luma_delta_angle.\n\nAlso, if luma_delta_angle is -3 or 3, it has only one neighbor (-2 or 2). How does this conditional handle the one-neighbor case?\n\nUPDATE: I think I understand it now. The intra_modes_rd_cost array has entries for the fictitious delta angles -4 and 4, and they are assigned the \"sentinel\" value of INT64_MAX, which satisfy the intra_modes_rd_cost[...] \u003e rd_thresh test here (assuming rd_thresh is less than INT64_MAX).\n\n0 is also a fictitious delta angle, right?",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6de6eddd_cf901a5f",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1357,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "\u003e UPDATE: I think I understand it now. The intra_modes_rd_cost array has entries for the fictitious delta angles -4 and 4, and they are assigned the \"sentinel\" value of INT64_MAX, which satisfy the intra_modes_rd_cost[...] \u003e rd_thresh test here (assuming rd_thresh is less than INT64_MAX).\nAck.\n\n\u003e 0 is also a fictitious delta angle, right?\nAs intra_modes_rd_cost array stores the rd cost corresponding to the base angle (i.e. angle delta\u003d0) of all modes at index 4, 0 is not a fictitious delta angle. This is done at line 1528.",
      "parentUuid": "7709096f_119d69d6",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9cff039e_3acca1a1",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1423,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "It would be good to document two things about this array.\n\n1. It stores values for delta angles -4, -3, ..., 3, 4.\n2. The value for luma_delta_angle is stored at index luma_delta_angle + MAX_ANGLE_DELTA + 1.\n3. The values for fictitious/nonexistent luma_delta_angle -4, 0, and 4 (array indexes 0, 4, and 8) are INT64_MAX (the initial value).",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b4e91a47_a80d5d05",
        "filename": "av1/encoder/intra_mode_search.c",
        "patchSetId": 9
      },
      "lineNbr": 1423,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "Ack. We have removed 0 from point number 3, as 0 is not a fictitious delta angle.",
      "parentUuid": "9cff039e_3acca1a1",
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "90c365d4_e019e6e0",
        "filename": "av1/encoder/intra_mode_search.h",
        "patchSetId": 9
      },
      "lineNbr": 307,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-19T18:41:34Z",
      "side": 1,
      "message": "Nit/optional: Can change \"processing\" to \"evaluation\" now.",
      "range": {
        "startLine": 307,
        "startChar": 43,
        "endLine": 307,
        "endChar": 53
      },
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0044f9a4_2ebf8da7",
        "filename": "av1/encoder/intra_mode_search.h",
        "patchSetId": 9
      },
      "lineNbr": 307,
      "author": {
        "id": 25857
      },
      "writtenOn": "2022-05-21T12:12:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "90c365d4_e019e6e0",
      "range": {
        "startLine": 307,
        "startChar": 43,
        "endLine": 307,
        "endChar": 53
      },
      "revId": "8e5f2a410e602976fbaa1dcdda227a00e71f0e47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}