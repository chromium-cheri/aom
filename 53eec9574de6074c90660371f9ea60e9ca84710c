{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ae227329_69bb2a07",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 9616
      },
      "writtenOn": "2023-08-18T18:45:50Z",
      "side": 1,
      "message": "In the parent version, `fp_prepare_enc_workers()` allocated `mv_costs` and invoked `av1_alloc_mb_data()` for each worker. Except for the `src_diff `  buffer allocated by `av1_alloc_mb_data()`, the other buffers are not required during firstpass processing. In this CL, these redundant memory allocations and deallocations within the MT path of firstpass processing are cleaned up.\n\nThe allocation and deallocation of `src_diff` buffer has been abstracted to separate functions namely, `av1_alloc_src_diff_buf()` and `av1_dealloc_src_diff_buf()`. In order to prevent potential memory leaks due to early termination from firstpass processing, `av1_dealloc_src_diff_buf()` and `av1_free_firstpass_data()` are invoked from `encoder_destroy()`.\n\nThis change is bit-exact and has been verified using bitstream-match tests for a combination of various configuration values for --threads, --tile-rows, --tile-columns, --cpu-used, --end-usage, --row-mt, --fp-mt, etc. Validated all unit-tests with sanitizers (address and thread) and valgrind.",
      "revId": "53eec9574de6074c90660371f9ea60e9ca84710c",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5924cc83_3546a2eb",
        "filename": "av1/encoder/encodeframe_utils.h",
        "patchSetId": 5
      },
      "lineNbr": 433,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-08-19T02:34:21Z",
      "side": 1,
      "message": "Just an observation for this function, `av1_dealloc_mb_data()` and maybe others. Given these are deallocation calls, it seems unlikely they need to be inline. No change is necessary in this patch, but some clean up here might help with library size if they\u0027re not in a hot path. The same could be said for the allocation functions.",
      "revId": "53eec9574de6074c90660371f9ea60e9ca84710c",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e940c66f_e650af35",
        "filename": "av1/encoder/encodeframe_utils.h",
        "patchSetId": 5
      },
      "lineNbr": 435,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-08-19T02:34:21Z",
      "side": 1,
      "message": "prefer preincrement (`++plane`) here and at line 478.",
      "range": {
        "startLine": 435,
        "startChar": 42,
        "endLine": 435,
        "endChar": 49
      },
      "revId": "53eec9574de6074c90660371f9ea60e9ca84710c",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4477b48b_1ec69f5a",
        "filename": "av1/encoder/encodeframe_utils.h",
        "patchSetId": 5
      },
      "lineNbr": 435,
      "author": {
        "id": 9616
      },
      "writtenOn": "2023-08-21T17:11:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e940c66f_e650af35",
      "range": {
        "startLine": 435,
        "startChar": 42,
        "endLine": 435,
        "endChar": 49
      },
      "revId": "53eec9574de6074c90660371f9ea60e9ca84710c",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ff3345c_fbc0dbb3",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 5
      },
      "lineNbr": 1852,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-08-19T02:34:21Z",
      "side": 1,
      "message": "prefer `--i`",
      "range": {
        "startLine": 1852,
        "startChar": 40,
        "endLine": 1852,
        "endChar": 43
      },
      "revId": "53eec9574de6074c90660371f9ea60e9ca84710c",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6cbbb99a_8e933f03",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 5
      },
      "lineNbr": 1852,
      "author": {
        "id": 9616
      },
      "writtenOn": "2023-08-21T17:11:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1ff3345c_fbc0dbb3",
      "range": {
        "startLine": 1852,
        "startChar": 40,
        "endLine": 1852,
        "endChar": 43
      },
      "revId": "53eec9574de6074c90660371f9ea60e9ca84710c",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}