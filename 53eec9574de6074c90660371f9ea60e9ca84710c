{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ae227329_69bb2a07",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 9616
      },
      "writtenOn": "2023-08-18T18:45:50Z",
      "side": 1,
      "message": "In the parent version, `fp_prepare_enc_workers()` allocated `mv_costs` and invoked `av1_alloc_mb_data()` for each worker. Except for the `src_diff `  buffer allocated by `av1_alloc_mb_data()`, the other buffers are not required during firstpass processing. In this CL, these redundant memory allocations and deallocations within the MT path of firstpass processing are cleaned up.\n\nThe allocation and deallocation of `src_diff` buffer has been abstracted to separate functions namely, `av1_alloc_src_diff_buf()` and `av1_dealloc_src_diff_buf()`. In order to prevent potential memory leaks due to early termination from firstpass processing, `av1_dealloc_src_diff_buf()` and `av1_free_firstpass_data()` are invoked from `encoder_destroy()`.\n\nThis change is bit-exact and has been verified using bitstream-match tests for a combination of various configuration values for --threads, --tile-rows, --tile-columns, --cpu-used, --end-usage, --row-mt, --fp-mt, etc. Validated all unit-tests with sanitizers (address and thread) and valgrind.",
      "revId": "53eec9574de6074c90660371f9ea60e9ca84710c",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}