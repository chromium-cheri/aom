{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "aa52c01c_5f595021",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 21727
      },
      "writtenOn": "2021-07-29T03:27:34Z",
      "side": 1,
      "message": "Hi Lester, Yunqing,\nWe have submitted a CL to add SSE4.1 intrinsic optimization for optical flow\nbased mv refinement with interpolated gradient function. To validate the intrinsic a unit test is also added.\nFor this patch, with configuration OPFL_BICUBIC_GRAD\u003d1 \u0026 OPFL_COMBINE_INTERP_GRAD_LS\u003d1, we observed ~3% encode \u0026 ~5% decode time reduction for fourpeople_720p60.y4m, speed 1.\n\nPlease review the patch. \nThank you.",
      "revId": "107529b3bf4a47725874d9a7b203e032ecfabf5a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "52afc580_dde5cf02",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 7230
      },
      "writtenOn": "2021-07-29T22:12:49Z",
      "side": 1,
      "message": "Looks like this CL supports highbd but not lowbd. Are you planning on implementing lowbd version as well?",
      "revId": "107529b3bf4a47725874d9a7b203e032ecfabf5a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "149c25e0_cf827f8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 21727
      },
      "writtenOn": "2021-07-30T14:47:18Z",
      "side": 1,
      "message": "Hi Lester,\nInternal precision used by both low-bd and high-bd implementations are same. So we preferred to have a common function for both.\nHere maximum range of pdiff, gx and gy is 9-bit for low-bd and 13-bit for high-bd. For both bitdepths, operations like (u*u),(u*w)..etc needs 32-bit signed integer to maintain intermediate precision.\nThank you.",
      "parentUuid": "52afc580_dde5cf02",
      "revId": "107529b3bf4a47725874d9a7b203e032ecfabf5a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0cca3951_c4ce0521",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 7230
      },
      "writtenOn": "2021-07-31T02:52:40Z",
      "side": 1,
      "message": "Thanks for the clarification. However, I am still seeing a drop of gain in lowbd. Please check if you get bit exact results with and without --use-16bit-internal when OPFL_BICUBIC_GRAD and OPFL_COMBINE_INTERP_GRAD_LS are both on. Thanks!",
      "parentUuid": "149c25e0_cf827f8f",
      "revId": "107529b3bf4a47725874d9a7b203e032ecfabf5a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "29e7fb55_d6c60b86",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 7230
      },
      "writtenOn": "2021-07-31T03:05:13Z",
      "side": 1,
      "message": "Please test with the following patch. \nhttps://aomedia-review.googlesource.com/c/aom/+/142922\n\nThe following two runs are suppose to give bit exact results.\n\n(better)\n./aomenc -o output.webm city_cif.y4m --codec\u003dav1 --cpu-used\u003d0 --threads\u003d0 --profile\u003d0 --lag-in-frames\u003d19 --min-qp\u003d0 --max-qp\u003d63 --auto-alt-ref\u003d1 --passes\u003d1 --kf-max-dist\u003d160 --kf-min-dist\u003d0 --drop-frame\u003d0 --static-thresh\u003d0 --arnr-maxframes\u003d7 --arnr-strength\u003d5 --sharpness\u003d0 --undershoot-pct\u003d100 --overshoot-pct\u003d100 --tile-columns\u003d0 --frame-parallel\u003d0 --test-decode\u003dwarn -v --psnr --end-usage\u003dq --cq-level\u003d54 --limit\u003d5 --use-16bit-internal\n\n(worse)\n./aomenc -o output.webm city_cif.y4m --codec\u003dav1 --cpu-used\u003d0 --threads\u003d0 --profile\u003d0 --lag-in-frames\u003d19 --min-qp\u003d0 --max-qp\u003d63 --auto-alt-ref\u003d1 --passes\u003d1 --kf-max-dist\u003d160 --kf-min-dist\u003d0 --drop-frame\u003d0 --static-thresh\u003d0 --arnr-maxframes\u003d7 --arnr-strength\u003d5 --sharpness\u003d0 --undershoot-pct\u003d100 --overshoot-pct\u003d100 --tile-columns\u003d0 --frame-parallel\u003d0 --test-decode\u003dwarn -v --psnr --end-usage\u003dq --cq-level\u003d54 --limit\u003d5",
      "parentUuid": "0cca3951_c4ce0521",
      "revId": "107529b3bf4a47725874d9a7b203e032ecfabf5a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "042f74c0_b2624868",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 21727
      },
      "writtenOn": "2021-08-02T14:14:28Z",
      "side": 1,
      "message": "Hi Lester,\nPrior to the patch (https://aomedia-review.googlesource.com/c/aom/+/142922), there was a difference in calculation of \u0027tmp1\u0027 between lowbd and highbd paths.\n\nComputation in low-bd:\ntmp1[i * bw + j] \u003d d0 * ((int16_t)dst0[i * bw + j] - (int16_t)dst1[i * bw + j]);\n\nComputation in high-bd:\ntmp_dst \u003d (int32_t)dst0[i * bw + j] - (int32_t)dst1[i * bw + j];\ntmp1[i * bw + j] \u003d clamp(tmp_dst, INT16_MIN, INT16_MAX);\n\nSo the intrinsic (please refer the following patch: https://aomedia-review.googlesource.com/c/aom/+/142821) was implemented accordingly.\n\nWith your recent patch, the \u0027C\u0027 code is giving bit-exact output for both the runs. So, the intrinsic has to be modified accordingly.",
      "parentUuid": "29e7fb55_d6c60b86",
      "revId": "107529b3bf4a47725874d9a7b203e032ecfabf5a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}