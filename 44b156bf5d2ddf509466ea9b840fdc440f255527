{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4b862508_2c2edd71",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 15031
      },
      "writtenOn": "2021-12-10T18:59:18Z",
      "side": 1,
      "message": "Hi Yunqing,\nThis patch adds support for computation of stats (used in estimating wiener filter coefficients) on down sampled restoration unit. This change is aimed at speed-up and is enabled through a sf. We have modified the C , AVX2 and SSE implementations accordingly. The refinement of filter coefficients in finer_tile_search_wiener() still happens on the restoration unit at full resolution.\n\nPlease find the results for speed 3 and speed 4 below ( Loop restoration is currently disabled for speed 5 and above) :\n                Instruction Count      BD-Rate Loss(%)\ncpu  Resolution   Reduction(%)     avg.psnr   ovr.psnr    ssim   \n 3    LOWRES2      1.869          0.0174     0.0163      0.0610    \n 3    MIDRES2      2.270          0.0498     0.0565      0.0594    \n 3    HDRES2       2.220          0.0829     0.1000      0.0623    \n 3    Average      2.120          0.0500     0.0576      0.0609    \n\n 4    LOWRES2      1.953          0.0061    -0.0001     -0.0172\n 4    MIDRES2      2.461          0.0363    -0.0027      0.0425\n 4    HDRES2       2.494          0.0505     0.0437     -0.0188\n 4    Average      2.303          0.0310     0.0136      0.0021\n\nDue to known issues in C vs SIMD match (in issue 2932), we tried getting quality impact of CL with in C function (wrt parent version) :\n                        BD-Rate Loss(%)\ncpu Resolution    avg.psnr ovr.psnr  ssim  \n 3   LOWRES2      0.0233    0.0227   0.0467 \n 3   MIDRES2      0.0496    0.0582   0.0712 \n 3   HDRES2       0.0906    0.1084   -0.0100 \n 3   Average      0.0545    0.0631   0.0360\n\nIn the commit message : \n[-] sign indicates encode time increase\n[+] sign indicates encode time reduction \n\nThe instruction count reduction specified has been measured using command: \n$ perf stat -e instructions:u ./aomenc â€¦ \n\nPlease note that HDRES2  is slightly out of trade off in speed 3. Also, the clip soccer_4cif_30fps has the worst quality drop of 1.8% in speed 4. We found that, this is due to the change in the GOP length decision method based on TPL stats.\n\nWe have verified that the patch is bit exact for other speed levels. \nPlease review the patch.\nThanks,\nAkshata",
      "revId": "44b156bf5d2ddf509466ea9b840fdc440f255527",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0b00775f_faaa0d34",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-12-10T20:14:14Z",
      "side": 1,
      "message": "Great optimization idea and good speedup! Thanks.",
      "revId": "44b156bf5d2ddf509466ea9b840fdc440f255527",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aaefea7d_5e88cc52",
        "filename": "av1/encoder/pickrst.c",
        "patchSetId": 3
      },
      "lineNbr": 988,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-12-10T20:14:14Z",
      "side": 1,
      "message": "So, the stats is calculated once every 4 rows? I am a little worried that we would miss some information by skipping 3 rows out of 4. But, your result looks good. Surprisingly, lowres even gave better tradeoff than hdres.",
      "range": {
        "startLine": 988,
        "startChar": 1,
        "endLine": 988,
        "endChar": 57
      },
      "revId": "44b156bf5d2ddf509466ea9b840fdc440f255527",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "26e83bbe_782b3f29",
        "filename": "av1/encoder/pickrst.c",
        "patchSetId": 3
      },
      "lineNbr": 988,
      "author": {
        "id": 15031
      },
      "writtenOn": "2021-12-13T15:14:34Z",
      "side": 1,
      "message": "Yes, the stats are calculated once every 4 rows. The down sampling is done only in the first stage. This ensures that the information of the other 3 rows will be used in the refinement stage. The refinement stage seems to mitigate any quality lost due to down sampling in the first stage.",
      "parentUuid": "aaefea7d_5e88cc52",
      "range": {
        "startLine": 988,
        "startChar": 1,
        "endLine": 988,
        "endChar": 57
      },
      "revId": "44b156bf5d2ddf509466ea9b840fdc440f255527",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c4c5ba7e_ca0a796d",
        "filename": "av1/encoder/pickrst.c",
        "patchSetId": 3
      },
      "lineNbr": 1546,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-12-10T20:14:14Z",
      "side": 1,
      "message": "So this is not supported in HBD. Maybe the support can be added later? Can you add a TODO comment here for now?",
      "range": {
        "startLine": 1546,
        "startChar": 4,
        "endLine": 1546,
        "endChar": 28
      },
      "revId": "44b156bf5d2ddf509466ea9b840fdc440f255527",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6175443_10c83ae9",
        "filename": "av1/encoder/pickrst.c",
        "patchSetId": 3
      },
      "lineNbr": 1546,
      "author": {
        "id": 15031
      },
      "writtenOn": "2021-12-13T15:14:34Z",
      "side": 1,
      "message": "Yes, we will submit another patch to add a TODO in HBD. As the unit test in wiener_test.cc is currently disabled , we will add a TODO to include this test case in the unit test as well.",
      "parentUuid": "c4c5ba7e_ca0a796d",
      "range": {
        "startLine": 1546,
        "startChar": 4,
        "endLine": 1546,
        "endChar": 28
      },
      "revId": "44b156bf5d2ddf509466ea9b840fdc440f255527",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c1c82b9e_5bc1249e",
        "filename": "av1/encoder/pickrst.c",
        "patchSetId": 3
      },
      "lineNbr": 1546,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-12-13T17:59:23Z",
      "side": 1,
      "message": "Thanks! So wiener unit test with use_downsampled_wiener_stats needs to be added, right? It would be good to add those tests to test the SIMD changes in this CL. Could we add 8-bit test now, and leave 10-bit test till 10-bit support is added?",
      "parentUuid": "e6175443_10c83ae9",
      "range": {
        "startLine": 1546,
        "startChar": 4,
        "endLine": 1546,
        "endChar": 28
      },
      "revId": "44b156bf5d2ddf509466ea9b840fdc440f255527",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}