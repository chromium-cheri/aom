{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "357e68f8_4a841d85",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 31567
      },
      "writtenOn": "2023-11-24T13:01:14Z",
      "side": 1,
      "message": "The function av1_cnn_activate_c() is used to get the output through mapping of the input using one of the activation functions as per the enum \u0027ACTIVATION\u0027. In the parent commit, these activation functions were invoked through \u0027get_activation()\u0027, using function pointers which resulted in a function call in every iteration. This CL optimizes this function by declaring these activation functions as INLINE and refactoring \u0027av1_cnn_activate_c()\u0027 accordingly. In this process of refactoring we have cleaned up the function \u0027get_activation()\u0027. The CL is verified to produce bit-exact results.\n\nFor AVIF still-image encode with tune\u003dssim,\n```\n                         Encode Time\ncpu-used                 Reduction(%)\n    6                      0.988\n```\nInstruction count reduction seen (for AVIF encode) is quoted below.\n```\t\n                       Instruction Count\ncpu-used                 Reduction(%)\n    6                      0.768\n    3                      0.111\n```\nFollowing are the instruction count reduction results when libaom allintra frame encoding (50 frames) was tested for a borg setup:\n```\n                       Instruction Count\ncpu-used                 Reduction(%)\n    6                      0.873\n    3                      0.094\n```\nLibavif commit used for testing: babcfca04c6164008055cfcb54941fdcb46213c3",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "49293ebd_984e294d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-24T16:14:37Z",
      "side": 1,
      "message": "Neha: Thanks for the CL. I suggest some further simplifications.",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3471f101_f43e7e06",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-24T16:14:37Z",
      "side": 1,
      "message": "Delete this typedef.",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fdde84ee_d2d161b3",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 31567
      },
      "writtenOn": "2023-11-27T15:21:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3471f101_f43e7e06",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a1f9a4ba_c5d12d85",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 36,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-24T16:14:37Z",
      "side": 1,
      "message": "Since `fabsf()` returns a float, we can delete the float cast. Also use float constant 1.0f:\n\n```\nstatic INLINE float softsign(float x) { return x / (fabsf(x) + 1.0f); }\n```",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dbd6602d_1bb50c19",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 36,
      "author": {
        "id": 31567
      },
      "writtenOn": "2023-11-27T15:21:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a1f9a4ba_c5d12d85",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04777746_274ad4f8",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-24T16:14:37Z",
      "side": 1,
      "message": "Nit: Delete this function.",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2ae2b458_887ac5f4",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 31567
      },
      "writtenOn": "2023-11-27T15:21:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "04777746_274ad4f8",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0e37311_4fcdf02b",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 313,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-24T16:14:37Z",
      "side": 1,
      "message": "Nit/optional: This can also be written as a switch statement. Do you think that\u0027s a good idea?",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5db9912_0edd0eaa",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 313,
      "author": {
        "id": 31567
      },
      "writtenOn": "2023-11-27T15:21:08Z",
      "side": 1,
      "message": "Yes Wan-Teh, this code can be refactored using switch statement too. However, given the type of refactoring we pursued, we feel that the if-else statement looks more suitable than switch statement. Please suggest, if we need to write using switch.",
      "parentUuid": "e0e37311_4fcdf02b",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "64597793_036b8c24",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 313,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-28T01:22:41Z",
      "side": 1,
      "message": "A switch statement could be implemented using a jump table. However, I guess modern compilers can recognize that this if-else-if-else statement is equivalent to a switch statement. So this kind of manual optimization may no longer be necessary, we can go for what you think is clearer.",
      "parentUuid": "a5db9912_0edd0eaa",
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "830ab195_ec8c759c",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 324,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-24T16:14:37Z",
      "side": 1,
      "message": "Delete this. This is a no-op.",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 324,
        "endChar": 5
      },
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a5b0a27_59201f09",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 324,
      "author": {
        "id": 31567
      },
      "writtenOn": "2023-11-27T15:21:08Z",
      "side": 1,
      "message": "Done. As per the suggestion, we deleted the code corresponding to NONE and restructured the code accordingly.",
      "parentUuid": "830ab195_ec8c759c",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 324,
        "endChar": 5
      },
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bdf0265c_ddc3ff6b",
        "filename": "av1/encoder/cnn.c",
        "patchSetId": 3
      },
      "lineNbr": 324,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-28T01:22:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8a5b0a27_59201f09",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 324,
        "endChar": 5
      },
      "revId": "56f938f9f74dac5f75bd0a6b033ab3ee46041414",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}