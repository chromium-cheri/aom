{
  "comments": [
    {
      "key": {
        "uuid": "1b532ff1_399cf4c4",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 282,
      "author": {
        "id": 5020
      },
      "writtenOn": "2019-03-22T01:29:05Z",
      "side": 1,
      "message": "this should be INLINE",
      "range": {
        "startLine": 282,
        "startChar": 7,
        "endLine": 282,
        "endChar": 13
      },
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c7e885e_a39137ad",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 282,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T20:55:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1b532ff1_399cf4c4",
      "range": {
        "startLine": 282,
        "startChar": 7,
        "endLine": 282,
        "endChar": 13
      },
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5415fcc5_7ed65f17",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 283,
      "author": {
        "id": 5020
      },
      "writtenOn": "2019-03-22T01:29:05Z",
      "side": 1,
      "message": "just call the variable remainder",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "40b96866_f1ddd7b7",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 283,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T20:55:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5415fcc5_7ed65f17",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2887226f_47f2e7b0",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 293,
      "author": {
        "id": 5020
      },
      "writtenOn": "2019-03-22T01:29:05Z",
      "side": 1,
      "message": "INLINE",
      "range": {
        "startLine": 293,
        "startChar": 7,
        "endLine": 293,
        "endChar": 13
      },
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0586f01_a90fd530",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 293,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T20:55:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2887226f_47f2e7b0",
      "range": {
        "startLine": 293,
        "startChar": 7,
        "endLine": 293,
        "endChar": 13
      },
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ea5f8bbe_966cb87a",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 294,
      "author": {
        "id": 5020
      },
      "writtenOn": "2019-03-22T01:29:05Z",
      "side": 1,
      "message": "this can be const",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a868790_2e5924d1",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 294,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T20:55:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ea5f8bbe_966cb87a",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7d81d72_f8813907",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 1609,
      "author": {
        "id": 5020
      },
      "writtenOn": "2019-03-22T01:29:05Z",
      "side": 1,
      "message": "it\u0027s possible this could still overflow depending on the scale of num. you could check for that and fail if it\u0027s impossible or upgrade to int64 and wait until after reduce_ratio()",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "873cad43_e52ac94a",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 1609,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T20:55:40Z",
      "side": 1,
      "message": "Good catch. Just made num int64_t type.",
      "parentUuid": "f7d81d72_f8813907",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d154b103_343fc711",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 1609,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T21:54:47Z",
      "side": 1,
      "message": "Looks like it will be written into ivf file header, so specifically I cannot change num to int64.",
      "parentUuid": "873cad43_e52ac94a",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a94ff6f_81145b45",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 1609,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T21:58:53Z",
      "side": 1,
      "message": "Or if it is garanteed in the end num won\u0027t be more than int32, just do a conversion to write it to the header",
      "parentUuid": "d154b103_343fc711",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d7a6a867_fef39fd2",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 1609,
      "author": {
        "id": 5188
      },
      "writtenOn": "2019-03-22T22:21:54Z",
      "side": 1,
      "message": "@Andrey, may I ask why we need to multiply by TICKS_PER_SEC here? We are not doing it when g_timebase is used directly.",
      "parentUuid": "0a94ff6f_81145b45",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8cfa8ed3_d6a52507",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 1609,
      "author": {
        "id": 12014
      },
      "writtenOn": "2019-03-23T01:50:42Z",
      "side": 1,
      "message": "timestamp_ratio is used to convert between user\u0027s timestamp units and libaom\u0027s, which are 1/TICKS_PER_SEC. This multiplication is basically g_timebase/(1/TICKS_PER_SEC). Below we reduce the resulting ratio to avoid overflows during the conversion, which is the point of my patch.\n\nFor example, if g_timebase is 1/1e9, multiplication by TICKS_PER_SEC (which is 1e7 currently) and reduction gives 1/1e2. So, the conversion from user\u0027s units to libaom\u0027s now is (pts * 1 / 1e2) instead of (pts * 1e7 * 1 / 1e9). Similarly, in the reverse direction. See timebase_units_to_ticks and ticks_to_timebase_units.\n\nTypically, g_timebase is either 1/1eN (1/1e9 in my case) or a ratio derived from the frame rate (e.g. 24000/1001). Multiplying g_timebase.num by TICKS_PER_SEC wouldn\u0027t overflow 32-bit integer if g_timebase.num is 1, but it would if it\u0027s e.g. 24000.\n\nIdeally, I would prefer libaom to not touch user\u0027s timestamps at all and pass them through as is, without any conversion. I don\u0027t know why libaom needs the timestamps in its internal units, I\u0027m assuming there must be some temporal analysis that requires information about frame timing. If there isn\u0027t a requirement on exact timestamp conversion, you might use floating point operations to perform the conversion to libaom\u0027s internal timestamps and keep user\u0027s timestamps intact. That would reasonably avoid overflows.",
      "parentUuid": "d7a6a867_fef39fd2",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b5db3fd7_8d21922f",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 7
      },
      "lineNbr": 1609,
      "author": {
        "id": 12014
      },
      "writtenOn": "2019-03-23T02:10:02Z",
      "side": 1,
      "message": "Also, if \"ivf file header\" means some external media file then I would assume it\u0027s user\u0027s timestamps that should be written. In other words, the original g_timebase specified by user and the original pts (or losslessly converted back from libaom\u0027s timestamp using timestamp_ratio) should be written to the file. If my understanding is correct, you can promote timestamp_ratio to 64-bit integers since it should not be written to the file; g_timebase should.",
      "parentUuid": "8cfa8ed3_d6a52507",
      "revId": "f651a308372f3bd66ddc84b81941d048c58cb394",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    }
  ]
}