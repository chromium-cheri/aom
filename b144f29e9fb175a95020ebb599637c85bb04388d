{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "943afd31_ab35c778",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 31012
      },
      "writtenOn": "2023-04-11T09:28:36Z",
      "side": 1,
      "message": "The function `av1_compute_stats_avx2()` computes H and M matrices, which are required for the derivation of horizontal and vertical filter coefficients of wiener filter processing. In the parent version, much of the computations in AVX2 function were present in C which led to less scaling w.r.t. C. This CL improves the SIMD version of `av1_compute_stats()`\n1. By computing the intermediate data (i.e., `src-avg` and `dgd-avg` buffers) beforehand and utilize the same for H and M calculations in a better way.\n2. By replacing C operations with better SIMD friendly design.\n\nNote: The buffers introduced to keep the intermediate data `src-avg` and `dgd-avg` are consuming around 0.3% heap memory. We shall plan to move the same from LR unit level to frame level in the follow up CL.\n\nThe below shows timer based module level speed up observed due to the improvements.\n```\n     Wiener window         AVX2 Scaling w.r.t. C\n        Size         Parent version\t  Current CL\n         7  \t\t 4.5x\t\t         12.8x\n         5\t       5.0x\t\t         15.8x\n```\n\nCurrently, the change will not have any impact for speeds \u003e\u003d 5, as the Loop restoration is disabled for these presets.Bitmatch is verified w.r.t parent version for speeds \u003c\u003d 4 for Borg test output.\n\nWe shall plan to enable the wiener filter for speeds 5 and 6, once this CL gets merged. \n\nPlease check the Borg test results for speed 3 and 4.\n```\n                       Instruction Count\ncpu      Resolution      Reduction(%)\n 3        LOWRES2           0.561\n 3        MIDRES2           0.723\n 3        HDRES2            0.730\n 4        LOWRES2           0.610\n 4        MIDRES2           0.771\n 4        HDRES2            0.784\n ```\n\nThe instruction count reduction specified has been measured using command:\n$ perf stat -e instructions:u ./aomenc â€¦\n\nPlease review the CL.",
      "revId": "b144f29e9fb175a95020ebb599637c85bb04388d",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5685d727_b88d4cdd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-04-11T18:10:57Z",
      "side": 1,
      "message": "Nice improvement!",
      "revId": "b144f29e9fb175a95020ebb599637c85bb04388d",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6751ce94_3b1a5323",
        "filename": "av1/encoder/x86/pickrst_avx2.c",
        "patchSetId": 1
      },
      "lineNbr": 378,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-04-11T18:10:57Z",
      "side": 1,
      "message": "Pass in the pointers, especially for 3rd/4th parameters?",
      "range": {
        "startLine": 377,
        "startChar": 46,
        "endLine": 378,
        "endChar": 72
      },
      "revId": "b144f29e9fb175a95020ebb599637c85bb04388d",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}