{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "55d5b62d_94cefb51",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-16T23:19:31Z",
      "side": 1,
      "message": "Please add\nBUG\u003daomedia:2963",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5064509b_b27a0d02",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 9611
      },
      "writtenOn": "2021-02-18T14:29:03Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "55d5b62d_94cefb51",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a42f8c3c_ab8965d6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 9611
      },
      "writtenOn": "2021-02-12T16:39:19Z",
      "side": 1,
      "message": "Hi Wan-Teh,\n\nIn the parent version, the buffers required for loop restoration are allocated unconditionally (i.e., even though loop restoration filter is disabled). In this patch, we modified the code such that the buffers are allocated conditionally, based on \u0027seq_params.enable_restoration\u0027 flag. Please note that \u0027seq_params.enable_restoration\u0027 accounts for speed feature (\u0027disable_lr_filter\u0027) settings as well.\n\nAs the function \u0027av1_alloc_restoration_buffers()\u0027 is common to both encoder and decoder, we called the function \u0027av1_alloc_restoration_buffers()\u0027 under the relevant condition in the encoder. We have not modified the decoder code as \u0027av1_alloc_restoration_buffers()\u0027 is already invoked based on frame header information (read from bit-stream) in the decoder.\n\nFor libaom AV1 video encode, bit match is verified (w.r.t parent commit) for few videos with different video encoding configurations.\nIt was verified that output of AVIF encode is bit-exact with parent version for a typical image dataset.\n\nFollowing are memory reduction results when AVIF encode was tested for ‘building.jpg’ (4032x3024) image at cq_level\u003d18. This change is applicable for speed \u003e\u003d 5.\n\n   Speed                 HEAP Memory\n   preset                Reduction(%)\n     6           ~4.15 (from 568.6 MB to 545 MB)\n\nAs this change is also applicable to both ‘good’ (with –lag-in-frames\u003d35, speed \u003e\u003d 5) and ‘real-time’ (with –lag-in-frames\u003d0) configurations, we have measured the memory reduction for a 1280x720 content.\n\n   Encoding           Speed                 HEAP Memory\n   Configuration     preset                Reduction(%)\n     GOOD              6           ~1.10 (from 244.90 MB to 242.20 MB)\n     RT                7           ~4.52 (from 63.66 MB to 60.78 MB)\n\t \nHEAP memory reduction was measured using the command below.\n$valgrind --tool\u003dmassif ./avifenc ...\n\nThanks \u0026 Regards,\nVenkata.",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ed82fe6a_9ec30f7f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 9611
      },
      "writtenOn": "2021-02-15T15:03:26Z",
      "side": 1,
      "message": "Hi Wan-teh,\n\nThis patch gives heap memory reduction as loop restoration filter is disabled for speed presets \u003e\u003d 5 through the speed feature ‘disable_lr_filter’.\nHence, this optimization is applicable for both image coding (AVIF) and video coding (‘good’ encoding mode) for speed \u003e\u003d 5. Also, this optimization should be applicable for all presets in case of ‘real-time’ encoding mode as loop restoration is disabled for all presets in this case.\n\nRegards,\nVenkata",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "13bb77c2_d8a560ef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-16T23:19:31Z",
      "side": 1,
      "message": "Venkata: Good heap usage reduction! I suggest some changes to the comments.",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7a609ae7_5bc78514",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 2065,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-16T23:19:31Z",
      "side": 1,
      "message": "Nit: Please omit this comment. (This comment simply paraphrases the code.)",
      "range": {
        "startLine": 2064,
        "startChar": 0,
        "endLine": 2065,
        "endChar": 28
      },
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1b3028e2_c7af9c5d",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 2065,
      "author": {
        "id": 9611
      },
      "writtenOn": "2021-02-18T14:29:03Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "7a609ae7_5bc78514",
      "range": {
        "startLine": 2064,
        "startChar": 0,
        "endLine": 2065,
        "endChar": 28
      },
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5dcc754b_d9984c52",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 2067,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-16T23:19:31Z",
      "side": 1,
      "message": "Optional: It seems that we can put all the loop restoration related code (lines 2055-2067) inside an \"if (cm-\u003eseq_params.enable_restoration)\" statement. We can try this in a separate CL.",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f20eaa67_1f33f8ba",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 2067,
      "author": {
        "id": 9611
      },
      "writtenOn": "2021-02-18T14:29:03Z",
      "side": 1,
      "message": "In order to move the highlighted code inside the condition, the function definition was kept under the macro \"CONFIG_REALTIME_ONLY\" to avoid build failure.",
      "parentUuid": "5dcc754b_d9984c52",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a972c5f_d8480e9a",
        "filename": "av1/encoder/encoder_alloc.h",
        "patchSetId": 2
      },
      "lineNbr": 388,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-16T23:19:31Z",
      "side": 1,
      "message": "Nit: I suggest the following version of this comment:\n\n  // The frame buffer trial_frame_rst is used during loop restoration filter\n  // search. Hence it is allocated only when loop restoration is enabled.",
      "range": {
        "startLine": 386,
        "startChar": 0,
        "endLine": 388,
        "endChar": 28
      },
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3848f40_c0903d8f",
        "filename": "av1/encoder/encoder_alloc.h",
        "patchSetId": 2
      },
      "lineNbr": 388,
      "author": {
        "id": 9611
      },
      "writtenOn": "2021-02-18T14:29:03Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "3a972c5f_d8480e9a",
      "range": {
        "startLine": 386,
        "startChar": 0,
        "endLine": 388,
        "endChar": 28
      },
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a02aaad_8c111936",
        "filename": "av1/encoder/encoder_alloc.h",
        "patchSetId": 2
      },
      "lineNbr": 389,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-16T23:19:31Z",
      "side": 1,
      "message": "Optional: The exact condition under which cpi-\u003etrial_frame_rst is used is\n\n  const int use_restoration \u003d cm-\u003eseq_params.enable_restoration \u0026\u0026\n                              !cm-\u003efeatures.all_lossless \u0026\u0026\n                              !cm-\u003etiles.large_scale;\n\nShould we use that condition instead?",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7974cf7e_4bdb292c",
        "filename": "av1/encoder/encoder_alloc.h",
        "patchSetId": 2
      },
      "lineNbr": 389,
      "author": {
        "id": 9611
      },
      "writtenOn": "2021-02-18T14:29:03Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "6a02aaad_8c111936",
      "revId": "3952bf513b3a8b67997f59720bd300e2caf161da",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}