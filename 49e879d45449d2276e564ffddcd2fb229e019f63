{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c2ab9d89_5a9551f9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 25857
      },
      "writtenOn": "2021-06-02T16:03:53Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThis patch adds a unit test CpuUsedFirstpassTest, that validates the two pass encoding mode, when the first pass stats are generated with a different speed preset. In this test, the PSNR achieved  when using first pass stats of a different speed preset, is compared with, the PSNR achieved when the first pass stats of the same speed preset is used. A PSNR difference of greater than or equal to 0.1db , causes the test to fail.\n\nTo limit the duration of the test, we have restricted the resolution to 640x480 , the rate control mode to AOM_VBR and the different combinations of speed presets(2 ,4 , 6) as listed in table below. The lower speed presets (2, 4) have been added as part of Large tests (CpuUsedFirstpassTestLarge).\n\n\t      |    Reference encode     |     Test encode         |\nTest case No. | First pass  Second pass | First pass  Second pass |\n\t      |  cpu_used    cpu_used\t|  cpu_used    cpu_used   |\n------------- | ----------  ----------  | ----------  ----------  |\n       1      |     2\t   \t 2\t|     4\t\t  2       |\n       2      |     2\t   \t 2\t|     6\t\t  2       |\n       3      |     4\t   \t 4\t|     2\t\t  4       |\n       4      |     4\t   \t 4\t|     6\t\t  4       |\n       5      |     6\t   \t 6\t|     2\t\t  6       |\n       6      |     6\t   \t 6\t|     4\t\t  6       |\n\t \nPlease review the patch and let us know your opinion.\n\nThanks",
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "29606204_7963c29c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-02T16:41:53Z",
      "side": 1,
      "message": "Thanks for adding this unit test.",
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "56901bf5_dc008654",
        "filename": "test/cpu_used_firstpass_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-02T16:41:53Z",
      "side": 1,
      "message": "If 1st pass cpu_used \u003c 2nd pass cpu_used, we should not see much psnr loss, right? Did you see that in your testing? \nMaybe at least have 2 psnr thresholds here for different cases?",
      "range": {
        "startLine": 19,
        "startChar": 34,
        "endLine": 19,
        "endChar": 37
      },
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "328d3854_6409792b",
        "filename": "test/cpu_used_firstpass_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 25857
      },
      "writtenOn": "2021-06-03T15:32:24Z",
      "side": 1,
      "message": "Yunqing,\n\nAs per our understanding, there should be lesser BD rate loss when  1st pass cpu_used \u003c 2nd pass cpu_used, on average for 1st pass cpu_used !\u003d 2nd pass cpu_used. However, we see that this is not true in the case of the content we have chosen (niklas_640_480_30). Please find the table below with PSNR values for all configurations when second pass cpu_used \u003d 2. We see that test case 1 (first pass cpu_used \u003d 0 and second pass cpu_used \u003d 2) has a higher PSNR loss of around 0.057db than test case 6 (first pass cpu_used \u003d 6 and second pass cpu_used \u003d 2) with PSNR loss of around 0.039db. Though the PSNR loss is not as expected, it seems to be small.\n\n Test case No. First pass  Second pass  PSNR achieved  Difference\n\t       cpu_used   cpu_used\t\t      w r t Ref PSNR\n Ref PSNR\t  2          2          41.87051          NA\n    1\t\t  0          2          41.813452       0.057058\n    2             1          2          41.875526      -0.005016\n    3             3          2          41.807365       0.063145\n    4             4          2          41.807365       0.063145\n    5             5          2          41.831419       0.039091\n    6             6          2          41.831419       0.039091\n\n\nHence we have added some buffer and chosen a uniform PSNR difference threshold of 0.1 db, for all configurations. Please let us know your opinion on this.",
      "parentUuid": "56901bf5_dc008654",
      "range": {
        "startLine": 19,
        "startChar": 34,
        "endLine": 19,
        "endChar": 37
      },
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21ae5124_85724f61",
        "filename": "test/cpu_used_firstpass_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 109,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-02T16:41:53Z",
      "side": 1,
      "message": "Maybe move 4 to CpuUsedFirstpassTest, so we at least run 1 test with (1st pass cpu_used \u003e 2nd pass cpu_used) daily?",
      "range": {
        "startLine": 109,
        "startChar": 48,
        "endLine": 109,
        "endChar": 49
      },
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6ac25fe0_ec1b8279",
        "filename": "test/cpu_used_firstpass_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 109,
      "author": {
        "id": 25857
      },
      "writtenOn": "2021-06-03T15:32:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "21ae5124_85724f61",
      "range": {
        "startLine": 109,
        "startChar": 48,
        "endLine": 109,
        "endChar": 49
      },
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee550a85_153c8231",
        "filename": "test/test.cmake",
        "patchSetId": 4
      },
      "lineNbr": 99,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-06-02T16:41:53Z",
      "side": 1,
      "message": "Add cpu_used_firstpass_test.cc to this list if it isn\u0027t for real time?",
      "range": {
        "startLine": 99,
        "startChar": 7,
        "endLine": 99,
        "endChar": 48
      },
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b5a74ef_a3803f7c",
        "filename": "test/test.cmake",
        "patchSetId": 4
      },
      "lineNbr": 99,
      "author": {
        "id": 25857
      },
      "writtenOn": "2021-06-03T15:32:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ee550a85_153c8231",
      "range": {
        "startLine": 99,
        "startChar": 7,
        "endLine": 99,
        "endChar": 48
      },
      "revId": "49e879d45449d2276e564ffddcd2fb229e019f63",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}