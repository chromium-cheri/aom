{
  "comments": [
    {
      "key": {
        "uuid": "287bd77a_74937232",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-09-25T22:18:48Z",
      "side": 1,
      "message": "PTAL. Thanks!",
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d93b7438_fa88fe0f",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 394,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-09-25T22:18:48Z",
      "side": 1,
      "message": "Fyodor disabled screen content tools for RT mode in\nhttps://aomedia-review.googlesource.com/c/aom/+/86450\n\nHowever, if seq-\u003ereduced_still_picture_hdr is true, the force_screen_content_tools syntax element is omitted in the sequence header OBU and its value is assumed to be 2 (see lines 401-405 below). This CL attempts to disable screen content tools for RT mode when seq-\u003ereduced_still_picture_hdr is true.",
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "81c14ace_3485a2b9",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 403,
      "author": {
        "id": 6585
      },
      "writtenOn": "2020-09-25T22:36:38Z",
      "side": 1,
      "message": "Is this necessary?\nCan it be like:\nseq-\u003eforce_screen_content_tools \u003d (oxcf-\u003emode \u003d\u003d REALTIME) ? 0 : 2;",
      "range": {
        "startLine": 403,
        "startChar": 0,
        "endLine": 403,
        "endChar": 40
      },
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39aad9f4_5dc2ee86",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 403,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-09-25T23:02:28Z",
      "side": 1,
      "message": "Yes, this is required by the AV1 spec. If seq-\u003ereduced_still_picture_hdr is true, several syntax elements in the sequence header OBUs are omitted and are assigned fixed default values.\n\nHere is an excerpt from pages 30-31 of the AV1 spec:\n\n5.5.1. General sequence header OBU syntax\n\nsequence_header_obu( ) {\n    ...\n    if ( reduced_still_picture_header ) {\n        enable_interintra_compound \u003d 0\n        enable_masked_compound \u003d 0\n        enable_warped_motion \u003d 0\n        enable_dual_filter \u003d 0\n        enable_order_hint \u003d 0\n        enable_jnt_comp \u003d 0\n        enable_ref_frame_mvs \u003d 0\n        seq_force_screen_content_tools \u003d SELECT_SCREEN_CONTENT_TOOLS\n        seq_force_integer_mv \u003d SELECT_INTEGER_MV\n        OrderHintBits \u003d 0\n    } else {\n    ...\n}",
      "parentUuid": "81c14ace_3485a2b9",
      "range": {
        "startLine": 403,
        "startChar": 0,
        "endLine": 403,
        "endChar": 40
      },
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c7190751_91a14607",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 403,
      "author": {
        "id": 6585
      },
      "writtenOn": "2020-09-25T23:09:45Z",
      "side": 1,
      "message": "Thanks for the explanation.",
      "parentUuid": "39aad9f4_5dc2ee86",
      "range": {
        "startLine": 403,
        "startChar": 0,
        "endLine": 403,
        "endChar": 40
      },
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a4b39fe5_381ddf45",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 1712,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-09-25T22:18:48Z",
      "side": 1,
      "message": "Note that if cm-\u003eseq_params.force_screen_content_tools is 0, then we set features-\u003eallow_screen_content_tools and features-\u003eallow_intrabc to 0.\n\nMy proposed fix copies this behavior for the RT mode and reduced_still_picture_hdr case below.",
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "21310ec9_b7790cc8",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 1717,
      "author": {
        "id": 10704
      },
      "writtenOn": "2020-09-25T22:47:49Z",
      "side": 1,
      "message": "I am not sure about this assert, but otherwise the change looks OK",
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a3cf69f4_e3480e98",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 1717,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-09-25T23:02:28Z",
      "side": 1,
      "message": "If we reach line 1716, we know cm-\u003eseq_params.force_screen_content_tools \u003d\u003d 2 because of the if statement above.\n\nNow, if cpi-\u003eoxcf.mode \u003d\u003d REALTIME, then seq-\u003eforce_screen_content_tools should be equal to 0 unless cm-\u003eseq_params.reduced_still_picture_hdr is true. That\u0027s why cm-\u003eseq_params.reduced_still_picture_hdr must be true here.",
      "parentUuid": "21310ec9_b7790cc8",
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9300a682_c291816d",
        "filename": "av1/encoder/encoder.c",
        "patchSetId": 2
      },
      "lineNbr": 1717,
      "author": {
        "id": 10704
      },
      "writtenOn": "2020-09-25T23:10:28Z",
      "side": 1,
      "message": "Thanks!",
      "parentUuid": "a3cf69f4_e3480e98",
      "revId": "90be77b735918015f840c93881ee6e949c2a7d47",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    }
  ]
}