{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a143a20e_bd06dfef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-11-15T12:15:06Z",
      "side": 1,
      "message": "Hi, I\u0027m a libavif contributor. This patch fixes some corner cases in libaom\u0027s internal scaler, which is used in progressive AVIF encoding. Please review, thanks.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d1985d0e_c2bac731",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "Yuan: Thank you very much for the CL. Please consider my review as supplemental because I am not familiar with some of the code modified by this CL.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ace26e17_7fab9d59",
        "filename": "av1/common/resize.c",
        "patchSetId": 1
      },
      "lineNbr": 1205,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "Jerome: I don\u0027t understand this function. Please review the changes to this function.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "030dfdb0_2f5627ad",
        "filename": "av1/common/resize.c",
        "patchSetId": 1
      },
      "lineNbr": 1210,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "Nit: There is an extra space after `*`. Please run clang-format on this CL.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3869c65_694744b7",
        "filename": "av1/common/resize.c",
        "patchSetId": 1
      },
      "lineNbr": 1210,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-11-18T04:25:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "030dfdb0_2f5627ad",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6971cda9_b8376700",
        "filename": "av1/common/resize.c",
        "patchSetId": 1
      },
      "lineNbr": 1394,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "Optional: Pass `scaled-\u003ey_crop_width` and `scaled-\u003ey_crop_height` instead of `scaled_width` and `scaled_height` as the last two arguments, because the code below (lines 1403-1418) deals with `unscaled` and `scaled`.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c260714f_5175917f",
        "filename": "av1/common/resize.c",
        "patchSetId": 1
      },
      "lineNbr": 1394,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-24T00:16:58Z",
      "side": 1,
      "message": "This is just nice to have. Marked this resolved to reduce the number of unresolved comments.\n\nBut if you also like this suggested change, I can write a CL to make this change.",
      "parentUuid": "6971cda9_b8376700",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3cbae4a8_80df62be",
        "filename": "av1/common/resize.h",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "Nit: Add \"the\" before \"normative scaler\" and \"non-normative scaler\" if there is only one normative scaler and one non-normative scaler.\n\nAlso change \"scale ratio\" to \"scaling ratios\".",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "34508e40_8d5b5a10",
        "filename": "av1/common/resize.h",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-11-18T04:25:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3cbae4a8_80df62be",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1cf21e4_532cae8e",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 822,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "Note: My comments in this file also apply to av1/common/arm/resize_neon.c.\n\nNit/optional: If we use the exact same expressions as lines 860, 892, 927, 956 (except for the different variable names), then we will be able to verify the correctness of this function slightly more easily.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c76a0690_b6a78bfc",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 822,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-11-18T04:25:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e1cf21e4_532cae8e",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7cb5ec7a_afd19ca5",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 842,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "Could you explain why we can\u0027t rely on the following code at lines 973-974?\n\n```\n  if (!scaled) {\n    av1_resize_and_extend_frame_c(src, dst, filter, phase, num_planes);\n  } else {\n```\n\nIt seems that the way we set the `scaled` boolean flag is incorrect. For example, we set `scaled` to 1 when we have scaled any plane, but it seems that we should only set `scaled` to 1 when we have scaled all planes. One way to fix this error is to initialize `scaled` to 1 and then set `scaled` to 0 if we fail to scale any plane.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "130cab65_0f812d5d",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 842,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-11-18T04:25:41Z",
      "side": 1,
      "message": "By checking the condition early we can avoid doing extra work. Even if the logic setting `scaled` is right, by the time we reach lines 973-974 we already paid some time to scale the Y plane (and for those fail cases scaling Y takes most processing time). Now `scaled` is mainly used to \n\nOr we can select different scaler for each plane, among the three options: oneshot normative scaler (`av1_has_optimized_scaler_{ssse3,neon}` mentioned), blockwise normative scaler (`av1_resize_and_extend_frame_c`) and non-normative scaler. My old CL is taking this option, but looks like current code is trying to avoid mixing scalers. @jianj@google.com could you give some insights?",
      "parentUuid": "7cb5ec7a_afd19ca5",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e720da1_663ad17c",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 842,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-12-07T21:24:27Z",
      "side": 1,
      "message": "Yuan: I answered your question for Jerome in https://aomedia-review.googlesource.com/c/aom/+/161961.\n\nI guess it is okay to mix oneshot normative scaler and blockwise normative scaler for different planes, but your solution in this CL is fine.",
      "parentUuid": "130cab65_0f812d5d",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cf3c3a97_64ff9a89",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 842,
      "author": {
        "id": 5960
      },
      "writtenOn": "2022-12-08T00:14:19Z",
      "side": 1,
      "message": "IMO We should avoid using different scalers for planes.",
      "parentUuid": "130cab65_0f812d5d",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61c2ebba_e09dec50",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 971,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "It seems that we should add an else branch here to set `scaled` to 0:\n\n```\n    } else if (dst_w \u003d\u003d src_w * 2 \u0026\u0026 dst_h \u003d\u003d src_h * 2) {\n      // 1 to 2\n      ...\n    } else {\n      scaled \u003d 0;\n    }\n```",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4f01a778_de3ad57c",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 971,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-11-18T04:25:41Z",
      "side": 1,
      "message": "We should also break the for loop wherever `scaled` is reverted to 0. But let\u0027s first figure out whether mixing scaler is fine.",
      "parentUuid": "61c2ebba_e09dec50",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64d359f5_5a944cd4",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 971,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-23T01:28:14Z",
      "side": 1,
      "message": "I took a closer look at this. With the new if statement you added at line 842, it is not possible to have an else branch here. We can probably change the last \"else if\" (at line 956) to an \"else\".\n\nCould you add the break statements you mentioned?\n\nAlso, the only reason `scaled` is 0 is out-of-memory error, right? If so, we probably should use an `oom_error` boolean variable instead.",
      "parentUuid": "4f01a778_de3ad57c",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "866aaa0d_8aca88c8",
        "filename": "av1/common/x86/resize_ssse3.c",
        "patchSetId": 1
      },
      "lineNbr": 971,
      "author": {
        "id": 26549
      },
      "writtenOn": "2022-11-23T15:59:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "64d359f5_5a944cd4",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4f68ce0_fde10eac",
        "filename": "av1/encoder/encoder_utils.c",
        "patchSetId": 1
      },
      "lineNbr": 736,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-17T18:47:56Z",
      "side": 1,
      "message": "IMPORTANT: Should we pass `ref-\u003ey_crop_width` and `ref-\u003ey_crop_height` instead of `cm-\u003ewidth` and `cm-\u003eheight` as the first two arguments?\n\nNote that the code (lines 745-760) below deals with `ref` and `\u0026new_fb-\u003ebuf`.\n\nI am not sure if `cm-\u003ewidth \u003d\u003d ref-\u003ey_crop_width` and `cm-\u003eheight \u003d\u003d ref-\u003ey_crop_height` are true.",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3d0a0357_85656e41",
        "filename": "av1/encoder/encoder_utils.c",
        "patchSetId": 1
      },
      "lineNbr": 736,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-11-24T00:16:58Z",
      "side": 1,
      "message": "I wrote https://aomedia-review.googlesource.com/c/aom/+/167081 to fix this.",
      "parentUuid": "e4f68ce0_fde10eac",
      "revId": "147797237aa9a98991b1d25cc101a61f7faf3be4",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}