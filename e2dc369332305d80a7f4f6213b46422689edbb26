{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "eb2e7540_ed07ebe3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 14993
      },
      "writtenOn": "2021-02-23T12:58:22Z",
      "side": 1,
      "message": "Hi Wan-Teh, Jingning,\n\nIt was observed that firstpass_inter_prediction() was being called from first-pass/LAP stages even though kf-max-dist was set to 0. This CL sets the kf_requested flag appropriately when kf-max-dist\u003d\u003d0.\n\nThis issue could be solved by either of following approaches:\n1) By using fixed_kf_cntr logic to populate frame_flags\n2) Populating kf_requested flag based on kf-max-dist\u003d0\n\nWe did not pursue approach (1) as that piece of code is under the check \"kf_mode \u003d\u003d AOM_KF_AUTO\". The value of kf_mode is set to AOM_KF_DISABLED for the newly added --allintra mode. Hence, we thought that approach (2) would be better as it would handle kf-max-dist\u003d0 for all kf_mode values (AOM_KF_DISABLED/AOM_KF_AUTO). \n\nWith the current patch in all-intra frame encoding (with first-pass/LAP enabled), we observed better bit-rate adherence as active_worst_quality is populated appropriately after the modification (coded_error -\u003e section_error -\u003e active_worst_quality). As a specific example, for \"rush_hour_1080p25\" content with target-bitrate\u003d5700kbps, the achieved bit-rate reduced from 29.2Mbps (parent version) to 8.55Mbps (with the current patch) for single-pass encoding with LAP enabled. A similar trend is seen with two-pass all-intra frame encoding with kf_mode set to AOM_KF_DISABLED.\n\nPlease review the patch.\n\nRegards,\nJayasanker.",
      "revId": "e2dc369332305d80a7f4f6213b46422689edbb26",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4ca08456_1b968974",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-23T23:28:26Z",
      "side": 1,
      "message": "Jingning: PTAL. Thanks!",
      "revId": "e2dc369332305d80a7f4f6213b46422689edbb26",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c44ff801_e2a01fb5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-02-23T23:35:34Z",
      "side": 1,
      "message": "Hi Jayasanker,\n\nI also think approach (2) is better.\n\nNote that the default value of kf_mode \u003d\u003d AOM_KF_DISABLED in the all intra mode is a somewhat arbitrary decision. I suggested AOM_KF_DISABLED to Jingning mainly to make it clear we want to disable scene cut detection in all intra mode. It is very likely that scene cut detection is disabled as long as key_freq_max \u003d\u003d 0, regardless of the value of kf_mode.",
      "parentUuid": "eb2e7540_ed07ebe3",
      "revId": "e2dc369332305d80a7f4f6213b46422689edbb26",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}