{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9ce712b7_7e29e7e7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9611
      },
      "writtenOn": "2022-08-23T12:54:44Z",
      "side": 1,
      "message": "Hi Yunqing and Marco,\n\nAs per our understanding, setting the variable force_zeromv_skip to 1 enables pruning at different levels in the inter mode loop. Currently, source sad equal to kZeroSad is considered as one of the conditions to set this flag. This CL introduces a speed feature ‘set_zeromv_skip_based_on_source_sad’ to change the source sad condition for enabling force_zeromv_skip. \nThe speed feature is facilitated to take different levels, so that it can be extended to lower presets based on different conditions. Currently, this optimization is enabled only for speed 10 for rtc-screen. \n\nThe following is the borg result for rtc-screen.\n```\n               Instruction Count        BD-Rate Loss(%)\ncpu-used          Reduction(%)    avg.psnr   ovr.psnr    ssim\n    10              2.000         0.0524     0.0132     -0.0922\n```\n\nPlease check the worst and best BD-Rate drops for rtc-screen testset:\n              \t\t\t\t\t\t                 BD-Rate Loss(%)       \ncpu  Impact     Test-set\t\t     Content   \t\t    avg.psnr   ovr.psnr    ssim        \n 10   worst     rtc-screen  \tscreenshare_colorslides.1820_1320   0.5411     0.6012      0.1323\n 10   worst     rtc-screen  \tscreen_recording_crd.1920_1080      0.3082     1.0206      0.2355\n 10   best      rtc-screen  \tscreenshare_buganizer.1900_1306    -0.7033    -0.9515     -0.8948\n\nThis change does not have any impact for –tune-content\u003ddefault.\nPlease review the patch.\n\nThanks \u0026 Regards,\nVenkata.",
      "revId": "383052209809deddaade97b83f9903a67f63295a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5ebb881b_28125d4d",
        "filename": "av1/encoder/var_based_part.c",
        "patchSetId": 1
      },
      "lineNbr": 1214,
      "author": {
        "id": 5185
      },
      "writtenOn": "2022-08-23T20:36:14Z",
      "side": 1,
      "message": "Screen content encoding use 128x128 SB. kLowSad probably is ok.",
      "range": {
        "startLine": 1214,
        "startChar": 31,
        "endLine": 1214,
        "endChar": 38
      },
      "revId": "383052209809deddaade97b83f9903a67f63295a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c56b1d0d_f767245a",
        "filename": "av1/encoder/var_based_part.c",
        "patchSetId": 1
      },
      "lineNbr": 1214,
      "author": {
        "id": 5190
      },
      "writtenOn": "2022-08-24T16:26:25Z",
      "side": 1,
      "message": "force_zeromv_skip is aggressive exit so to be safe/conservative we kept it only for kZeroSad. Concerned setting it kLowSad can lead to some visual regression, that vp9 does not show. Without testing all the screen clips I can\u0027t be sure.\n\nWhy not set it to kVeryLowSad?",
      "parentUuid": "5ebb881b_28125d4d",
      "range": {
        "startLine": 1214,
        "startChar": 31,
        "endLine": 1214,
        "endChar": 38
      },
      "revId": "383052209809deddaade97b83f9903a67f63295a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0658806_e9dc5399",
        "filename": "av1/encoder/var_based_part.c",
        "patchSetId": 1
      },
      "lineNbr": 1214,
      "author": {
        "id": 9611
      },
      "writtenOn": "2022-08-25T12:15:18Z",
      "side": 1,
      "message": "Hi Marco,\n\nThe feature kVeryLowSad was added recently. Hence, we did not try any experiments using this setting. However, as per your suggestion we have enabled the setting of force_zeromv_skip flag for source sad \u003c\u003d kVeryLowSad cases. The suggested change has improved the quality (avg.psnr) and also reduced the worst cases quality loss to below 0.1%.\nIn this patch the speed feature is not enabled for speed 9 since worst case quality loss is high (\u003e 1%).\n\nThe following is the rtc-screen borg result for speed 9 and 10.\n```\n                Instruction Count        BD-Rate Loss(%)\ncpu-used          Reduction(%)    avg.psnr   ovr.psnr    ssim\n     9              1.834         0.0041    -0.0273     -0.0102\n    10              1.932        -0.0361     0.1555      0.0140\n```\nPlease check the worst and best BD-Rate drops for rtc-screen testset:\n```             \t\t\t\t\t\t                                BD-Rate Loss(%)       \ncpu    Impact     \t     Content   \t\t                           avg.psnr   ovr.psnr    ssim        \n  9    worst       \tScreenshare_youtube.1680_1178                      1.1856     1.3000      1.0209\n  9    best        \tSc_web_browsing720p                               -0.6820    -1.1078     -0.7614\n 10    worst     \tscreenshare_colorslides.1820_1320                  0.0624     0.0371      0.0262 \n 10    best     \tScreen_recording_crd.1920_1080                    -0.4148     0.8417     -0.0841\n```\nOnce this patch gets merged, we shall plan to extend the same for speed 9 with different logic.\n\nThanks \u0026 Regards,\nVenkata.",
      "parentUuid": "c56b1d0d_f767245a",
      "range": {
        "startLine": 1214,
        "startChar": 31,
        "endLine": 1214,
        "endChar": 38
      },
      "revId": "383052209809deddaade97b83f9903a67f63295a",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}