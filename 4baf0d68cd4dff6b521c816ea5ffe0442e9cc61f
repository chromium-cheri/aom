{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "7e0fa716_836a5312",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 26549
      },
      "writtenOn": "2023-03-08T09:03:30Z",
      "side": 1,
      "message": "This is a bit weird since they are not fields in `extra_cfg`, but `update_extra_cfg()` do depends on these values.\n\nAlternatively we may move the init logic in `update_extra_cfg()` to somewhere early in `encoder_encode()`, but that will be a much larger change.",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e6500dd_ec637b14",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-08T23:58:30Z",
      "side": 1,
      "message": "The change to `ctrl_set_scale_mode()` needs to be reviewed carefully because it will modify `ctx-\u003eoxcf` and the `oxcf` of all the `ctx-\u003eppi-\u003eparallel_cpi[i]`, not just `ctx-\u003eppi-\u003ecpi`. If we are not confident about the change, it is best to not change it.\n\nThe change to `ctrl_set_number_spatial_layers()` is safe.",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "063d17e2_f91f3913",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-09T00:12:08Z",
      "side": 1,
      "message": "\u003e Alternatively we may move the init logic in `update_extra_cfg()` to somewhere early in `encoder_encode()`, but that will be a much larger change.\n\nI have been considering this.\n\n`update_extra_cfg()` is an expensive call. So we waste a lot of cycles in calling `update_extra_cfg()` in almost every `aom_codec_control()` call. I filed an issue about this before: https://crbug.com/aomedia/2732. (At that time I didn\u0027t know how to improve this.)",
      "parentUuid": "7e0fa716_836a5312",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cbb1eedc_df2d4249",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3456,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-09T00:12:08Z",
      "side": 1,
      "message": "Could you explain why the values set in this `av1_set_internal_size()` call requires calling `update_extra_cfg()`?",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "248e4dfd_13babb62",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3456,
      "author": {
        "id": 26549
      },
      "writtenOn": "2023-03-15T12:49:28Z",
      "side": 1,
      "message": "`av1_set_internal_size()` set `oxcf-\u003eresize_cfg.resize_mode` which `av1_select_sb_size()` uses.",
      "parentUuid": "cbb1eedc_df2d4249",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf37e352_bbb20f03",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3457,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-08T23:58:30Z",
      "side": 1,
      "message": "I found that `update_extra_cfg()` calls `av1_check_fpmt_config()`, so we should be able to delete this `av1_check_fpmt_config()` call.\n\nBut we need to proceed carefully here. I think we need to pass `\u0026ctx-\u003eoxcf` as the first argument to `av1_set_internal_size()`, The reason is that `update_extra_cfg()` calls\n\n```\n      av1_change_config(ctx-\u003eppi-\u003eparallel_cpi[i], \u0026ctx-\u003eoxcf,\n                        is_sb_size_changed);\n```\n\nAnd that function does:\n\n```\n  cpi-\u003eoxcf \u003d *oxcf;\n```\n\nWe need to single-step in the debugger to verify this.",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d3f60c74_014c2dc6",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3457,
      "author": {
        "id": 26549
      },
      "writtenOn": "2023-03-15T12:49:28Z",
      "side": 1,
      "message": "Suggested changes done. Sorry I\u0027m not familiar with the internal codec fields.",
      "parentUuid": "cf37e352_bbb20f03",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dc9a18bd_4b620695",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3457,
      "author": {
        "id": 26549
      },
      "writtenOn": "2024-05-15T13:16:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d3f60c74_014c2dc6",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "86852065_7093b410",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3459,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-08T23:58:30Z",
      "side": 1,
      "message": "Nit: I suggest we write this as follows:\n\n```\n  if (av1_set_internal_size(...) !\u003d 0) {\n    return AOM_CODEC_INVALID_PARAM;\n  }\n  return update_extra_cfg(ctx, \u0026ctx-\u003eextra_cfg);\n```",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "443f900c_460fbedc",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3459,
      "author": {
        "id": 26549
      },
      "writtenOn": "2023-03-15T12:49:28Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "86852065_7093b410",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b08b7c8_dc300957",
        "filename": "av1/av1_cx_iface.c",
        "patchSetId": 1
      },
      "lineNbr": 3480,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-08T23:58:30Z",
      "side": 1,
      "message": "I verified that `update_extra_cfg()` calls `av1_change_config_seq()`, which uses `ctx-\u003eppi-\u003enumber_spatial_layers`.",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "db3a717d_86ea7d13",
        "filename": "test/avif_progressive_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 233,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-08T23:58:30Z",
      "side": 1,
      "message": "Is this change necessary?",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e5ee7f3b_4907bcc0",
        "filename": "test/avif_progressive_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 233,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-03-09T00:12:08Z",
      "side": 1,
      "message": "I found that you explained this in the following comment in https://aomedia-review.googlesource.com/c/aom/+/171641:\n\nI just found that while `update_extra_cfg()` calls `set_sb_size()`, `ctrl_set_scale_mode()` and `ctrl_set_number_spatial_layers()` does not call `update_extra_cfg()` despite `set_sb_size()` depends on the value they set. If I changes the order of `ctrl*`s there would be errors again.",
      "parentUuid": "db3a717d_86ea7d13",
      "revId": "4baf0d68cd4dff6b521c816ea5ffe0442e9cc61f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}