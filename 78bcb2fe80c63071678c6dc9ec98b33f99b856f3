{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a5dfeebb_b5d824ca",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 22433
      },
      "writtenOn": "2021-04-09T12:55:59Z",
      "side": 1,
      "message": "Hi Wan-Teh,\n\nIn this CL, we have taken care of the review comments given in the following patch.\nhttps://aomedia-review.googlesource.com/c/aom/+/134861\n\nPlease review the CL.\n\nThanks \u0026 regards,\nAniket",
      "revId": "78bcb2fe80c63071678c6dc9ec98b33f99b856f3",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b06b4005_a84fe390",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-04-09T13:42:19Z",
      "side": 1,
      "message": "LGTM. Thanks!",
      "revId": "78bcb2fe80c63071678c6dc9ec98b33f99b856f3",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a616ee19_9c47bc8b",
        "filename": "av1/encoder/intra_mode_search_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 410,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-04-09T13:42:19Z",
      "side": 1,
      "message": "The is_cur_buf_hbd() function is defined as:\n\n  static INLINE int is_cur_buf_hbd(const MACROBLOCKD *xd) {\n    return xd-\u003ecur_buf-\u003eflags \u0026 YV12_FLAG_HIGHBITDEPTH ? 1 : 0;\n  }\n\nDo you think it should test CONFIG_AV1_HIGHBITDEPTH as follows?\n\n  static INLINE int is_cur_buf_hbd(const MACROBLOCKD *xd) {\n  #CONFIG_AV1_HIGHBITDEPTH\n    return xd-\u003ecur_buf-\u003eflags \u0026 YV12_FLAG_HIGHBITDEPTH ? 1 : 0;\n  #else\n    return 0;\n  #endif\n  }",
      "revId": "78bcb2fe80c63071678c6dc9ec98b33f99b856f3",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c9403eef_51f4ebb8",
        "filename": "av1/encoder/intra_mode_search_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 410,
      "author": {
        "id": 22433
      },
      "writtenOn": "2021-04-14T17:11:17Z",
      "side": 1,
      "message": "Hi Wan-Teh,\n\nThe changes we have done are consistent with some of the modules like av1_setup_obmc_dst_bufs(). As per our understanding, introducing macro as per your suggestion in is_cur_buf_hbd() should be similar to the changes we have done. We validated our understanding with the assembly code generated using gcc compiler (when CONFIG_AV1_HIGHBITDEPTH is off). Overall we feel that modifying is_cur_buf_hbd() can result in simpler code as caller module does not need to address different cases of CONFIG_AV1_HIGHBITDEPTH.\n\nWe also see that there are some modules like cfl_store_dc_pred() which do not have changes specific to CONFIG_AV1_HIGHBITDEPTH. By modifying is_cur_buf_hbd(), we can address the cases where CONFIG_AV1_HIGHBITDEPTH related changes are not taken care.\n\nPlease let us know your opinion on pursuing above change.",
      "parentUuid": "a616ee19_9c47bc8b",
      "revId": "78bcb2fe80c63071678c6dc9ec98b33f99b856f3",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cae298de_97409e6a",
        "filename": "av1/encoder/intra_mode_search_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 410,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-04-14T18:01:04Z",
      "side": 1,
      "message": "Hi Aniket,\n\nThank you for considering my suggestion! Are you saying that with my suggested change, we will be able to rewrite av1_setup_obmc_dst_bufs() as follows and the compiler will optimize away the if (is_cur_buf_hbd(xd)) branch when CONFIG_AV1_HIGHBITDEPTH is defined as 0?\n\n  void av1_setup_obmc_dst_bufs(MACROBLOCKD *xd, uint8_t **dst_buf1,\n                               uint8_t **dst_buf2) {\n    if (is_cur_buf_hbd(xd)) {\n      int len \u003d sizeof(uint16_t);\n      dst_buf1[0] \u003d CONVERT_TO_BYTEPTR(xd-\u003etmp_obmc_bufs[0]);\n      dst_buf1[1] \u003d\n          CONVERT_TO_BYTEPTR(xd-\u003etmp_obmc_bufs[0] + MAX_SB_SQUARE * len);\n      dst_buf1[2] \u003d\n          CONVERT_TO_BYTEPTR(xd-\u003etmp_obmc_bufs[0] + MAX_SB_SQUARE * 2 * len);\n      dst_buf2[0] \u003d CONVERT_TO_BYTEPTR(xd-\u003etmp_obmc_bufs[1]);\n      dst_buf2[1] \u003d\n          CONVERT_TO_BYTEPTR(xd-\u003etmp_obmc_bufs[1] + MAX_SB_SQUARE * len);\n      dst_buf2[2] \u003d\n          CONVERT_TO_BYTEPTR(xd-\u003etmp_obmc_bufs[1] + MAX_SB_SQUARE * 2 * len);\n    } else {\n      dst_buf1[0] \u003d xd-\u003etmp_obmc_bufs[0];\n      dst_buf1[1] \u003d xd-\u003etmp_obmc_bufs[0] + MAX_SB_SQUARE;\n      dst_buf1[2] \u003d xd-\u003etmp_obmc_bufs[0] + MAX_SB_SQUARE * 2;\n      dst_buf2[0] \u003d xd-\u003etmp_obmc_bufs[1];\n      dst_buf2[1] \u003d xd-\u003etmp_obmc_bufs[1] + MAX_SB_SQUARE;\n      dst_buf2[2] \u003d xd-\u003etmp_obmc_bufs[1] + MAX_SB_SQUARE * 2;\n    }\n  }\n\nIf so, that will be great!\n\nIn any case, I certainly support testing the CONFIG_AV1_HIGHBITDEPTH macro inside is_cur_buf_hbd(). If you agree, please go ahead and make that change. Thanks!",
      "parentUuid": "c9403eef_51f4ebb8",
      "revId": "78bcb2fe80c63071678c6dc9ec98b33f99b856f3",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}