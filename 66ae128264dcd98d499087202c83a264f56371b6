{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "abce70b2_f7d1557b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 31322
      },
      "writtenOn": "2022-12-19T11:13:28Z",
      "side": 1,
      "message": "Hi Wan-Teh, Frank, \n\nThe function av1_build_quantizer() initializes different quantizer settings for the entire QINDEX_RANGE. These quantizer tables need to be re-initialized only when any of the plane\u0027s dc/ac deltaq parameters change. In the parent commit, the tables were getting re-initialized based on either \u0027q_cfg-\u003edeltaq_mode\u0027 or \u0027q_cfg-\u003eenable_chroma_deltaq\u0027. But as per the function av1_set_quantizer(), dc/ac deltaq parameters are only dependent on \u0027q_cfg-\u003eenable_chroma_deltaq\u0027 and \u0027q_cfg-\u003eenable_hdr_deltaq\u0027. This CL corrects these conditions to re-initialize the quantizer tables by checking if the dc/ac deltaq parameters have changed.This is a bit-exact change.\n\nIn this CL, a structure called DeltaQuantParams is introduced, which holds the different deltaq parameters. An instance of this structure is added to \u0027EncQuantDequantParams\u0027 to track the state of the dc/ac deltaq parameters in cm-\u003equant_params. The newly added function have_deltaq_params_changed() in av1_init_quantizer() checks if the quantizer tables need to be re-initialized. Since q_cfg-\u003edeltaq_mode \u003d DELTA_Q_OBJECTIVE by default, this CL avoids some redundant calls to av1_build_quantizer, and hence an encode time reduction is observed. Currently, we haven\u0027t modified the â€˜CommonQuantParams\u0027 structure to make use of the newly added DeltaQuantParams structure, as it would involve code changes at multiple places (both on the encoder and decoder sides).\n\nFor libaom AV1 video encode, bit-match is verified (w.r.t. parent commit) for \u0027GOOD\u0027, \u0027RT\u0027 and \u0027ALLINTRA\u0027 encoding modes for a few contents with different encoding configurations. \n\nPlease review.\n\nRegards,\nApurve",
      "revId": "66ae128264dcd98d499087202c83a264f56371b6",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}