{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "9681079b_58cbbd84",
        "filename": "av1/decoder/accounting.c",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-04T22:47:59Z",
      "side": 1,
      "message": "Why do we set dictionary-\u003enum_strs to 0 on malloc failure? Although we cannot add a new string to the dictionary at index dictionary-\u003enum_strs, the existing strings in the dictionary are still there.",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a351e228_d27fabc7",
        "filename": "av1/decoder/accounting.c",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 5020
      },
      "writtenOn": "2022-05-04T23:43:39Z",
      "side": 1,
      "message": "\u003e Why do we set dictionary-\u003enum_strs to 0 on malloc failure? Although we cannot add a new string to the dictionary at index dictionary-\u003enum_strs, the existing strings in the dictionary are still there.\n\nGood point, I missed what specifically was being allocated.",
      "parentUuid": "9681079b_58cbbd84",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0c59395_3384cf82",
        "filename": "av1/decoder/accounting.c",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-04T22:47:59Z",
      "side": 1,
      "message": "We probably should return -1 instead, because 0 is a valid array index.\n\nNote the use of -1 at line 38 and line 68.",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "718ca3b7_3ddf87b9",
        "filename": "av1/decoder/accounting.c",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 5020
      },
      "writtenOn": "2022-05-04T23:43:39Z",
      "side": 1,
      "message": "I was concerned about -1 given the use of id as an index in aom_accounting_dump(). I can add a check in that location.",
      "parentUuid": "f0c59395_3384cf82",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9af2d82b_48cb1b55",
        "filename": "av1/decoder/accounting.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-04T22:47:59Z",
      "side": 1,
      "message": "We should also reset accounting-\u003enum_syms_allocated to 0 before returning false.",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4b9bcc6d_fbe29767",
        "filename": "av1/decoder/accounting.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 5020
      },
      "writtenOn": "2022-05-04T23:43:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9af2d82b_48cb1b55",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "67879b9d_83755c3c",
        "filename": "av1/decoder/decoder.c",
        "patchSetId": 1
      },
      "lineNbr": 143,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-04T22:47:59Z",
      "side": 1,
      "message": "We need to reset pbi-\u003eerror.setjmp to 0 here. Note that we set pbi-\u003eerror.setjmp to 1 at line 107.\n\nOur action here should be the same as lines 102-104, if setjmp() returns from a long jump.",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aec3e409_3fb4706a",
        "filename": "av1/decoder/decoder.c",
        "patchSetId": 1
      },
      "lineNbr": 143,
      "author": {
        "id": 5020
      },
      "writtenOn": "2022-05-04T23:49:33Z",
      "side": 1,
      "message": "\u003e We need to reset pbi-\u003eerror.setjmp to 0 here. Note that we set pbi-\u003eerror.setjmp to 1 at line 107.\n\u003e \n\u003e Our action here should be the same as lines 102-104, if setjmp() returns from a long jump.\n\nWe\u0027ve freed the decoder at this point and are returning NULL. I would hope the remove wouldn\u0027t itself longjmp, but for consistency I added this.",
      "parentUuid": "67879b9d_83755c3c",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "649f4db3_ded25d99",
        "filename": "av1/decoder/decoder.c",
        "patchSetId": 1
      },
      "lineNbr": 143,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-05T02:05:40Z",
      "side": 1,
      "message": "The reason we need to reset pbi-\u003eerror.setjmp to 0 here is not for this av1_decoder_remove() call. It is to make sure that after this function returns, if the caller calls aom_internal_error(), it won\u0027t do a long jump to the jump buffer, which becomes invalid after this function returns.\n\nSo, the rule is that after we set pbi-\u003eerror.setjmp to 1 at line 107, we must reset pbi-\u003eerror.setjmp to 0 before returning from this function.",
      "parentUuid": "aec3e409_3fb4706a",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "038a74b8_4aea3809",
        "filename": "av1/decoder/decoder.c",
        "patchSetId": 1
      },
      "lineNbr": 143,
      "author": {
        "id": 5020
      },
      "writtenOn": "2022-05-05T02:20:43Z",
      "side": 1,
      "message": "\u003e The reason we need to reset pbi-\u003eerror.setjmp to 0 here is not for this av1_decoder_remove() call. It is to make sure that after this function returns, if the caller calls aom_internal_error(), it won\u0027t do a long jump to the jump buffer, which becomes invalid after this function returns.\n\u003e \n\u003e So, the rule is that after we set pbi-\u003eerror.setjmp to 1 at line 107, we must reset pbi-\u003eerror.setjmp to 0 before returning from this function.\n\nI don\u0027t think the caller will have a pointer to call aom_internal_error on since the handle is destroyed and not returned to the caller in this case.",
      "parentUuid": "649f4db3_ded25d99",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5e9bcbd8_2bc3ddc0",
        "filename": "av1/decoder/decoder.c",
        "patchSetId": 1
      },
      "lineNbr": 143,
      "author": {
        "id": 9545
      },
      "writtenOn": "2022-05-05T02:35:00Z",
      "side": 1,
      "message": "You are right. The rule I mentioned does not apply in this function. So resetting pbi-\u003eerror.setjmp to 0 here only serves to prevent av1_decoder_remove(pbi) from performing a long jump if it calls aom_internal_error(). Since av1_decoder_remove() doesn\u0027t call aom_internal_error(), we don\u0027t need to reset pbi-\u003eerror.setjmp to 0 here.",
      "parentUuid": "038a74b8_4aea3809",
      "revId": "0ab6bf9b50fb0df18959eb4c7008da5225383a72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}