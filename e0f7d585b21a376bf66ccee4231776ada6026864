{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b79ec42b_a1b5ac4f",
        "filename": "av1/encoder/pass2_strategy.c",
        "patchSetId": 1
      },
      "lineNbr": 3177,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-03-23T01:02:22Z",
      "side": 1,
      "message": "If has_no_stats_stage(cpi) is false, do we need to set rc-\u003eframes_to_key to any value? The original code sets rc-\u003eframes_to_key to 1 in that case. The new code leaves rc-\u003eframes_to_key unchanged.",
      "revId": "e0f7d585b21a376bf66ccee4231776ada6026864",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "907ec19a_27b96d22",
        "filename": "av1/encoder/pass2_strategy.c",
        "patchSetId": 1
      },
      "lineNbr": 3177,
      "author": {
        "id": 5186
      },
      "writtenOn": "2021-03-23T03:28:26Z",
      "side": 1,
      "message": "I believe it is set using the result of define_kf_interval() on line 3215",
      "parentUuid": "b79ec42b_a1b5ac4f",
      "revId": "e0f7d585b21a376bf66ccee4231776ada6026864",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "391f3524_07f75ab8",
        "filename": "av1/encoder/pass2_strategy.c",
        "patchSetId": 1
      },
      "lineNbr": 3177,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-03-23T16:02:44Z",
      "side": 1,
      "message": "You are right. Thank you!\n\nMy next question is whether the rc-\u003eframes_to_key \u003d\u003d 0 test on line 3180 is correct. Is it intended to test the previous value of rc-\u003eframes_to_key before we update rc-\u003eframes_to_key?",
      "parentUuid": "907ec19a_27b96d22",
      "revId": "e0f7d585b21a376bf66ccee4231776ada6026864",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "100714e3_9d806046",
        "filename": "av1/encoder/pass2_strategy.c",
        "patchSetId": 1
      },
      "lineNbr": 3177,
      "author": {
        "id": 5186
      },
      "writtenOn": "2021-03-23T20:14:53Z",
      "side": 1,
      "message": "Currently, rc-\u003enext_key_frame_forced is only computed in 2 pass, so we need to initialize rc-\u003ethis_key_frame_forced differently for 1 pass. \n\nI think the logic here is that 1 pass will not place a keyframe other than at frame 0 without someone setting max_kf_interval. This means that any key frame (detected by frames_to_key \u003d\u003d 0) that isn\u0027t at frame 0 is forced by the encoding parameters.",
      "parentUuid": "391f3524_07f75ab8",
      "revId": "e0f7d585b21a376bf66ccee4231776ada6026864",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c72b08b4_0d39932c",
        "filename": "av1/encoder/pass2_strategy.c",
        "patchSetId": 1
      },
      "lineNbr": 3177,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-03-24T18:57:25Z",
      "side": 1,
      "message": "Thanks for the explanation! I have to admit that I don\u0027t understand this code. So please make sure that we are setting rc-\u003ethis_key_frame_forced and rc-\u003eframes_to_key in the correct order here. I.e., the value of rc-\u003ethis_key_frame_forced should depend on the previous value of rc-\u003eframes_to_key, not the new value.\n\nIf the order of these two assignments is correct, please go ahead and submit this CL.",
      "parentUuid": "100714e3_9d806046",
      "revId": "e0f7d585b21a376bf66ccee4231776ada6026864",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "451eb86b_c08dd05d",
        "filename": "av1/encoder/pass2_strategy.c",
        "patchSetId": 1
      },
      "lineNbr": 3177,
      "author": {
        "id": 5186
      },
      "writtenOn": "2021-03-24T19:15:48Z",
      "side": 1,
      "message": "Yes,I think they are correct. It needs the current value of frames_to_key to detect that we have reached a new keyframe placement. I will go ahead and submit, thanks for catching this issue!",
      "parentUuid": "c72b08b4_0d39932c",
      "revId": "e0f7d585b21a376bf66ccee4231776ada6026864",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}