{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b1dcdba3_258caf4d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 33002
      },
      "writtenOn": "2023-10-16T13:44:25Z",
      "side": 1,
      "message": "In the parent version, `sb_org_stats` is allocated locally in `encode_rd_sb()` and freed at the end of the function. In case of an early termination between this allocation and free calls, this will show up as leaks. In order to fix this issue, the allocation of `SB_FIRST_PASS_STATS` buffer is done using a pointer introduced in the MACROBLOCK structure so that it can be freed in `encoder_destroy()`.\n\nThis change is bit-exact and has been verified using bitstream-match tests for a combination of various configuration values for --threads, --tile-rows, --tile-columns, --cpu-used, --end-usage, --row-mt, --fp-mt, etc. Validated all unit-tests with sanitizers (address and thread) and valgrind.",
      "revId": "fcd197d4cedf7ecf7cb8bb477e795187d0fdb740",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7710e40a_12cfa3b1",
        "filename": "av1/encoder/encodeframe.c",
        "patchSetId": 5
      },
      "lineNbr": 813,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-10-16T21:09:54Z",
      "side": 1,
      "message": "can this be moved to the block at 846? Are there any aom_internal_error calls in that scope?",
      "revId": "fcd197d4cedf7ecf7cb8bb477e795187d0fdb740",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "865814ca_81e43cb9",
        "filename": "av1/encoder/encodeframe.c",
        "patchSetId": 5
      },
      "lineNbr": 813,
      "author": {
        "id": 33002
      },
      "writtenOn": "2023-10-17T13:38:53Z",
      "side": 1,
      "message": "\u003d\u003e can this be moved to the block at 846? \nAs per our code study, moving the allocation of `sb_org_stats` to the block at 846 seems to be feasible. But this change needs to be validated by running some tests.\nIn case the above change can be done, do you recommend using a stack allocation for this structure (similar to line 889) and thus avoiding the heap memory allocation ?\n\n\u003d\u003e Are there any aom_internal_error calls in that scope?\nYes, there are multiple `aom_internal_error()` calls within this scope. For e.g., \n`av1_alloc_pc_tree_node()` calls in `sb_qp_sweep() -\u003e av1_rd_pick_partition()`.",
      "parentUuid": "7710e40a_12cfa3b1",
      "revId": "fcd197d4cedf7ecf7cb8bb477e795187d0fdb740",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}