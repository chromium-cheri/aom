/*
 * Copyright (c) 2016, Alliance for Open Media. All rights reserved
 *
 * This source code is subject to the terms of the BSD 2 Clause License and
 * the Alliance for Open Media Patent License 1.0. If the BSD 2 Clause License
 * was not distributed with this source code in the LICENSE file, you can
 * obtain it at www.aomedia.org/license/software. If the Alliance for Open
 * Media Patent License 1.0 was not distributed with this source code in the
 * PATENTS file, you can obtain it at www.aomedia.org/license/patent.
 */

#include "aom_mem/aom_mem.h"

#include "av1/common/reconinter.h"
#include "av1/common/scan.h"
#include "av1/common/onyxc_int.h"
#include "av1/common/seg_common.h"
#include "av1/common/txb_common.h"

#if CONFIG_INTRA_ENTROPY
// Applies the ReLu activation to one fc layer
// output[i] = Max(input[i],0.0f)
static float *nn_relu(const float *input, FC_LAYER_EM *layer) {
  for (int i = 0; i < layer->num_outputs; ++i) {
    layer->output[i] = AOMMAX(input[i], 0.0f);
  }

  return layer->output;
}

// Applies the Sigmoid activation to one fc layer
// output[i] = 1/(1+exp(input[i]))
static float *nn_sigmoid(const float *input, FC_LAYER_EM *layer) {
  for (int i = 0; i < layer->num_outputs; ++i) {
    const float tmp = AOMMIN(AOMMAX(input[i], -10.0f), 10.0f);
    layer->output[i] = 1.0f / (1.0f + expf(-tmp));
  }

  return layer->output;
}

// Forward prediction in one fc layer, used in function av1_nn_predict_V2
static float *nn_fc_forward(const float *input, FC_LAYER_EM *layer) {
  const float *weights = layer->weights;
  const float *bias = layer->bias;
  assert(layer->num_outputs < EM_MAX_NODES);
  // fc
  for (int node = 0; node < layer->num_outputs; ++node) {
    float val = bias[node];
    for (int i = 0; i < layer->num_inputs; ++i) val += weights[i] * input[i];
    layer->output[node] = val;
    weights += layer->num_inputs;
  }

  // activation
  switch (layer->activation) {
    case ACTN_NONE: return layer->output;
    case ACTN_RELU: return nn_relu(layer->output, layer);
    case ACTN_SIGMOID: return nn_sigmoid(layer->output, layer);
    default:
      assert(0 && "Unknown activation");  // Unknown activation
      return NULL;
  }
}

void av1_nn_predict_em(const float *feature, NN_CONFIG_EM *nn_config,
                       float *output) {
  const float *input_nodes = feature;
  const int num_layers = nn_config->num_hidden_layers;
  assert(num_layers <= EM_MAX_HLAYERS);
  // Copy the input feature to the buffer
  av1_copy_array(nn_config->feature, feature, nn_config->layer[0].num_inputs);

  // Propagate the layers.
  int num_inputs = nn_config->layer[0].num_inputs;
  for (int i = 0; i <= num_layers; ++i) {
    assert(num_inputs == nn_config->layer[i].num_inputs);
    input_nodes = nn_fc_forward(input_nodes, nn_config->layer + i);
    num_inputs = nn_config->layer[i].num_outputs;
  }
  (void)num_inputs;

  // Final layer
  assert(nn_config->layer[num_layers].num_outputs == nn_config->num_logits);
  FC_LAYER_EM *layer = nn_config->layer + num_layers;
  switch (nn_config->loss) {
    case SOFTMAX_CROSS_ENTROPY_LOSS:
      if (nn_config->num_logits == 1) {
        // sigmoid
        const float tmp = AOMMIN(AOMMAX(layer->output[0], -10.0f), 10.0f);
        nn_config->output[0] = 1.0f / (1.0f + expf(-tmp));
      } else {
        // softmax
        av1_nn_softmax_em(layer->output, nn_config->output, layer->num_outputs);
      }
      break;
    default:
      av1_copy_array(nn_config->output, input_nodes, nn_config->num_logits);
  }
  // Copy the final layer output
  av1_copy_array(output, nn_config->output, nn_config->num_logits);
}

/***************************Backprop for gradient******************************/
// Backprop for ReLU activation
static void nn_relu_back(float *dX_out, FC_LAYER_EM *layer) {
  const float *dY = layer->dY;
  for (int i = 0; i < layer->num_outputs; ++i)
    dX_out[i] = layer->output[i] > 0.0f ? dY[i] : 0.0f;
}

// Backprop for sigmoid activation
static void nn_sigmoid_back(float *dX_out, FC_LAYER_EM *layer) {
  const float *dY = layer->dY;
  for (int i = 0; i < layer->num_outputs; ++i)
    dX_out[i] =
        dY[i] * layer->output[i] * (1 - layer->output[i]);  // dX=dY*sigmoid(X)
}

// Backprop for softmax cross entropy loss
static void nn_softmax_cross_entropy_loss_back(float *dX_out,
                                               const float *output,
                                               const int num_outputs,
                                               const int label) {
  if (num_outputs == 1) {
    // sigmoid
    assert(label < 2);  // label [0,1]
    dX_out[0] = output[0] - (float)label;
  } else {
    // softmax
    assert(num_outputs > label);  // label [0,1,... num_logits-1]
    av1_copy_array(dX_out, output, num_outputs);
    dX_out[label] -= 1;
  }
}

// Backprop in one fc layer, used in function av1_nn_backprop
static void nn_fc_backward(const float *X, float *dX_out, FC_LAYER_EM *layer) {
  // backprop on activation
  float dY_fc[EM_MAX_NODES] = { 0.0f };  // dY for fc
  switch (layer->activation) {
    case ACTN_NONE:  // no activation, dY_fc <-- dY
      av1_copy_array(dY_fc, layer->dY, layer->num_outputs);
      break;
    case ACTN_RELU: nn_relu_back(dY_fc, layer); break;
    case ACTN_SIGMOID: nn_sigmoid_back(dY_fc, layer); break;
    default: assert(0 && "Unknown activation");  // Unknown activation
  }

  // backprop on fc
  // gradient of W, b
  float *dW = layer->dW;
  float *db = layer->db;
  for (int j = 0; j < layer->num_outputs; ++j) {
    for (int i = 0; i < layer->num_inputs; ++i) dW[i] += dY_fc[j] * X[i];
    db[j] += dY_fc[j];
    dW += layer->num_inputs;
  }

  // gradient of the input, i.e., the output of last layer
  if (dX_out) {
    for (int i = 0; i < layer->num_inputs; ++i) {
      float *w = layer->weights + i;
      float val = 0.0f;
      for (int j = 0; j < layer->num_outputs; ++j) {
        val += dY_fc[j] * w[j * layer->num_inputs];
      }
      dX_out[i] = val;
    }
  }
}

void av1_nn_backprop_em(NN_CONFIG_EM *nn_config, const int label) {
  const int num_layers = nn_config->num_hidden_layers;

  // loss layer
  switch (nn_config->loss) {
    case SOFTMAX_CROSS_ENTROPY_LOSS:
      nn_softmax_cross_entropy_loss_back(nn_config->layer[num_layers].dY,
                                         nn_config->output,
                                         nn_config->num_logits, label);
      break;
    default: assert(0 && "Unknown loss");  // Unknown loss
  }

  // hidden fc layer
  FC_LAYER_EM *layer_ptr = nn_config->layer + num_layers;
  for (int i = 0; i < num_layers; ++i) {
    nn_fc_backward(layer_ptr[-1].output, layer_ptr[-1].dY, layer_ptr);
    layer_ptr -= 1;
  }

  nn_fc_backward(nn_config->feature, NULL,
                 layer_ptr);  // first layer (no dX for feature)
}

void av1_nn_update_em(NN_CONFIG_EM *nn_config, float mu) {
  const int num_layers = nn_config->num_hidden_layers;

  // Update the weights
  for (int i = 0; i <= num_layers; ++i) {
    FC_LAYER_EM *layer = nn_config->layer + i;
    for (int j = 0; j < layer->num_inputs * layer->num_outputs; ++j) {
      layer->weights[j] -= mu * layer->dW[j];
      layer->dW[j] = 0.f;
    }
    for (int j = 0; j < layer->num_outputs; ++j) {
      layer->bias[j] -= mu * layer->db[j];
      layer->db[j] = 0.f;
    }
  }
}

void av1_nn_softmax_em(const float *input, float *output, int n) {
  // Softmax function is invariant to adding the same constant
  // to all input values, so we subtract the maximum input to avoid
  // possible overflow.
  float max_inp = input[0];
  for (int i = 1; i < n; i++) max_inp = AOMMAX(max_inp, input[i]);
  float sum_out = 0.0f;
  for (int i = 0; i < n; i++) {
    // Clamp to range [-10.0, 0.0] to prevent FE_UNDERFLOW errors.
    const float normalized_input = AOMMAX(input[i] - max_inp, -10.0f);
    output[i] = (float)exp(normalized_input);
    sum_out += output[i];
  }
  for (int i = 0; i < n; i++) output[i] /= sum_out;
}
#endif  // CONFIG_INTRA_ENTROPY

static const aom_cdf_prob
    default_kf_y_mode_cdf[KF_MODE_CONTEXTS][KF_MODE_CONTEXTS][CDF_SIZE(
        INTRA_MODES)] = {
      { { AOM_CDF13(15588, 17027, 19338, 20218, 20682, 21110, 21825, 23244,
                    24189, 28165, 29093, 30466) },
        { AOM_CDF13(12016, 18066, 19516, 20303, 20719, 21444, 21888, 23032,
                    24434, 28658, 30172, 31409) },
        { AOM_CDF13(10052, 10771, 22296, 22788, 23055, 23239, 24133, 25620,
                    26160, 29336, 29929, 31567) },
        { AOM_CDF13(14091, 15406, 16442, 18808, 19136, 19546, 19998, 22096,
                    24746, 29585, 30958, 32462) },
        { AOM_CDF13(12122, 13265, 15603, 16501, 18609, 20033, 22391, 25583,
                    26437, 30261, 31073, 32475) } },
      { { AOM_CDF13(10023, 19585, 20848, 21440, 21832, 22760, 23089, 24023,
                    25381, 29014, 30482, 31436) },
        { AOM_CDF13(5983, 24099, 24560, 24886, 25066, 25795, 25913, 26423,
                    27610, 29905, 31276, 31794) },
        { AOM_CDF13(7444, 12781, 20177, 20728, 21077, 21607, 22170, 23405,
                    24469, 27915, 29090, 30492) },
        { AOM_CDF13(8537, 14689, 15432, 17087, 17408, 18172, 18408, 19825,
                    24649, 29153, 31096, 32210) },
        { AOM_CDF13(7543, 14231, 15496, 16195, 17905, 20717, 21984, 24516,
                    26001, 29675, 30981, 31994) } },
      { { AOM_CDF13(12613, 13591, 21383, 22004, 22312, 22577, 23401, 25055,
                    25729, 29538, 30305, 32077) },
        { AOM_CDF13(9687, 13470, 18506, 19230, 19604, 20147, 20695, 22062,
                    23219, 27743, 29211, 30907) },
        { AOM_CDF13(6183, 6505, 26024, 26252, 26366, 26434, 27082, 28354, 28555,
                    30467, 30794, 32086) },
        { AOM_CDF13(10718, 11734, 14954, 17224, 17565, 17924, 18561, 21523,
                    23878, 28975, 30287, 32252) },
        { AOM_CDF13(9194, 9858, 16501, 17263, 18424, 19171, 21563, 25961, 26561,
                    30072, 30737, 32463) } },
      { { AOM_CDF13(12602, 14399, 15488, 18381, 18778, 19315, 19724, 21419,
                    25060, 29696, 30917, 32409) },
        { AOM_CDF13(8203, 13821, 14524, 17105, 17439, 18131, 18404, 19468,
                    25225, 29485, 31158, 32342) },
        { AOM_CDF13(8451, 9731, 15004, 17643, 18012, 18425, 19070, 21538, 24605,
                    29118, 30078, 32018) },
        { AOM_CDF13(7714, 9048, 9516, 16667, 16817, 16994, 17153, 18767, 26743,
                    30389, 31536, 32528) },
        { AOM_CDF13(8843, 10280, 11496, 15317, 16652, 17943, 19108, 22718,
                    25769, 29953, 30983, 32485) } },
      { { AOM_CDF13(12578, 13671, 15979, 16834, 19075, 20913, 22989, 25449,
                    26219, 30214, 31150, 32477) },
        { AOM_CDF13(9563, 13626, 15080, 15892, 17756, 20863, 22207, 24236,
                    25380, 29653, 31143, 32277) },
        { AOM_CDF13(8356, 8901, 17616, 18256, 19350, 20106, 22598, 25947, 26466,
                    29900, 30523, 32261) },
        { AOM_CDF13(10835, 11815, 13124, 16042, 17018, 18039, 18947, 22753,
                    24615, 29489, 30883, 32482) },
        { AOM_CDF13(7618, 8288, 9859, 10509, 15386, 18657, 22903, 28776, 29180,
                    31355, 31802, 32593) } }
    };

#if CONFIG_INTRA_ENTROPY
const float intra_y_mode_lr = USE_SMALL_MODEL ? 0.1f : 0.0001f;
const float intra_uv_mode_lr = 0.2f;

#if USE_SMALL_MODEL
static const float intra_y_mode_layer0_weights[EM_MAX_NODES * EM_MAX_NODES] = {
  0.137246f,  -0.325971f, 0.048399f,  -0.430759f, -0.348252f, -0.380960f,
  -0.314998f, -0.180890f, -0.437649f, -0.227810f, -0.141855f, -0.121158f,
  -0.406899f, 0.131244f,  0.026780f,  -0.405696f, -0.221275f, -0.207408f,
  -0.207727f, -0.093193f, -0.178046f, 0.011383f,  -0.097682f, -0.111344f,
  -0.057743f, -0.285227f, -0.681920f, 0.742491f,  -1.327275f, -1.506279f,
  -1.641402f, -0.434495f, -1.721539f, -1.454707f, -0.680268f, -0.855182f,
  -0.537906f, -1.218242f, -0.110261f, -0.444973f, 0.324141f,  -1.583565f,
  -1.101000f, -0.828844f, -0.359300f, -1.141470f, -1.228410f, -0.489265f,
  -0.465241f, -0.687377f, -0.761950f, -0.175399f, -0.449793f, -1.577678f,
  0.409363f,  -1.315071f, -1.413799f, -1.463698f, -0.523842f, -0.640187f,
  -1.533183f, -0.570893f, -0.731369f, -0.455927f, -0.272158f, -0.337025f,
  -1.084225f, 1.052646f,  -1.256514f, -1.407361f, -1.286780f, -0.329729f,
  -0.347587f, -1.122096f, -0.542619f, -0.768571f, -0.135534f, 0.142178f,
  -0.753694f, -1.364718f, -1.490153f, 0.485384f,  -1.724442f, -1.376230f,
  -1.482171f, -0.027500f, -0.131497f, -0.565895f, -0.822225f, -0.694698f,
  -1.286608f, -0.867933f, -1.462219f, -1.853595f, 0.198775f,  -1.177041f,
  -1.123993f, -1.347752f, -0.409463f, -0.305579f, -0.703123f, -1.071038f,
  -0.822606f, -1.289266f, -0.766231f, -1.188326f, -1.315845f, -1.307871f,
  1.059568f,  0.171549f,  -0.280575f, -1.104447f, -1.075610f, -0.817844f,
  -1.120068f, -1.101539f, -1.486353f, -0.937149f, -1.504717f, -1.870650f,
  -1.590010f, 0.792062f,  -0.397716f, -0.009984f, -1.385864f, -1.110911f,
  -1.081214f, -1.171732f, -1.324705f, -1.491758f, -0.747245f, -0.476676f,
  -1.608056f, -1.291626f, -0.013322f, 0.893986f,  -0.955947f, -0.961503f,
  -0.831982f, -0.803137f, -0.636214f, -1.091110f, -1.186606f, -0.722192f,
  -0.722098f, -2.006352f, -1.363469f, 0.049370f,  0.703334f,  -0.855214f,
  -1.160053f, -0.802949f, -0.758759f, -0.754636f, -1.064078f, -0.989101f,
  -0.645688f, -1.807612f, -0.545012f, -1.331205f, -0.083676f, -1.036923f,
  0.549903f,  -0.675787f, -1.475937f, -0.867268f, -1.131715f, -0.824071f,
  -1.347047f, -0.727418f, -1.701789f, -0.956762f, -1.323609f, -0.240598f,
  -0.922242f, 0.877591f,  -0.749161f, -1.186678f, -0.903677f, -1.250380f,
  -0.781940f, -1.448516f, -0.556105f, -1.329216f, -0.454561f, -0.221682f,
  -0.955923f, -0.989849f, -0.681085f, 0.452446f,  -0.758885f, -0.379268f,
  -0.557966f, -0.292303f, -1.011894f, -0.436252f, -1.241779f, -0.698274f,
  -0.069754f, -1.301413f, -1.316663f, -0.784076f, 0.635121f,  -0.710623f,
  -0.311573f, -0.911045f, -0.395862f, -0.925204f, -0.599176f, -0.345656f,
  -1.371244f, -0.112816f, -1.478377f, -0.854843f, -1.263040f, -0.626612f,
  0.756776f,  -0.433796f, -0.446843f, -0.768001f, -0.891160f, -0.783500f,
  -0.672173f, -1.768856f, -0.438966f, -0.884043f, -0.624908f, -1.012489f,
  -0.984732f, 0.354585f,  -0.617676f, -0.778023f, -0.910187f, -0.878481f,
  -0.322966f, -0.706906f, -0.521266f, -0.425926f, -0.971938f, -0.736449f,
  -0.753293f, -0.275946f, -0.390186f, -0.016458f, -0.438417f, -0.335891f,
  -0.750328f, -0.356551f, -0.640758f, -0.913570f, -0.379441f, -0.723704f,
  -0.580959f, -0.660211f, -0.352338f, -0.264055f, 0.029494f,  -0.508076f,
  -0.295955f, -0.666946f, -0.486145f, -0.149576f, -0.924556f, -0.770425f,
  -1.155238f, -0.605564f, -1.275464f, -0.774834f, -0.432915f, -0.370261f,
  -0.283601f, -0.710280f, -0.638965f, -0.682492f, -0.575179f, -1.506205f,
  -0.814756f, -0.957809f, -0.849181f, -1.272253f, -1.037923f, -0.484788f,
  -0.550892f, -0.388334f, -0.842958f, -0.619417f, -0.347526f, -1.394987f,
  -0.465445f, -0.812377f, -1.072362f, -1.215255f, -0.731523f, -0.323021f,
  -0.956475f, -0.310656f, -0.888653f, -0.405180f, -0.829860f, -0.482595f,
  -1.417869f, -0.597492f, -0.704217f, -1.423163f, -1.334560f, -0.795443f,
  -0.539009f, -0.721450f, -0.492647f, -1.198759f, -0.473995f, -0.967644f,
  -0.737309f, -0.045029f, -0.557146f, -1.749586f, -1.957214f, -1.397086f,
  -1.936478f, -1.706445f, -1.373394f, -0.844661f, -0.932307f, -0.931110f,
  0.439974f,  -0.699017f, -0.353974f, -0.406335f, -1.610939f, -1.576760f,
  -1.691544f, -1.381189f, -1.523903f, -1.223436f, -0.825470f, -0.692516f,
  -1.126621f, 0.651129f,
};

static const float intra_y_mode_layer0_bias[EM_MAX_NODES] = {
  0.727235f,  -0.124064f, -0.226174f, -0.369686f, -0.723211f,
  -0.621841f, -0.690408f, -0.453834f, -0.506766f, 0.095593f,
  -0.590127f, -0.270232f, -1.008363f,
};
#else
static const float intra_y_mode_layer0_weights[EM_MAX_NODES * EM_MAX_NODES] = {
  0.049660f,  0.142786f,  -0.004678f, 0.134224f,  0.058202f,  -0.010564f,
  -0.069801f, 0.044887f,  0.142680f,  -0.004624f, 0.033854f,  0.142982f,
  0.197994f,  -0.047308f, 0.025474f,  0.092573f,  0.119723f,  0.272275f,
  0.153641f,  0.611267f,  0.675167f,  0.724309f,  0.357242f,  0.459819f,
  0.191545f,  0.230659f,  0.160584f,  0.106318f,  0.265396f,  0.052899f,
  0.029089f,  0.159393f,  0.154847f,  0.258274f,  0.103043f,  0.155835f,
  0.192988f,  -0.000126f, 0.027201f,  0.076033f,  0.265769f,  0.431170f,
  0.356862f,  0.585814f,  0.499349f,  0.676303f,  0.182778f,  0.461210f,
  -0.109539f, 0.026441f,  0.022635f,  0.032858f,  -0.101196f, -0.354005f,
  -0.209535f, -0.111841f, -0.034884f, -0.123497f, -0.070193f, -0.012161f,
  0.007015f,  -0.071403f, 0.062284f,  0.079869f,  0.394670f,  0.466291f,
  0.302191f,  0.363605f,  0.360095f,  0.489215f,  0.297412f,  0.482090f,
  0.205743f,  -0.068991f, 0.517725f,  -0.006257f, -0.171232f, -0.559598f,
  -0.233743f, -0.392528f, -0.149567f, -0.111502f, -0.209995f, 0.048649f,
  -0.230658f, 0.044018f,  0.170561f,  0.013875f,  -0.726654f, 0.332156f,
  1.517396f,  0.405863f,  -0.900619f, -1.420806f, -0.968384f, -1.419882f,
  0.008585f,  -0.024607f, 0.144461f,  -0.320240f, -0.229916f, -0.221994f,
  -0.209796f, -0.304041f, -0.062165f, -0.211440f, -0.092158f, -0.146797f,
  -0.269401f, 0.084031f,  0.044014f,  0.095622f,  -0.197001f, 0.352196f,
  1.212891f,  0.857339f,  0.025120f,  -0.883889f, -1.070539f, -0.821443f,
  -0.127028f, -0.129651f, -0.220950f, 0.249360f,  -0.268799f, -0.367281f,
  -0.272550f, -0.181379f, -0.064097f, -0.262344f, -0.207563f, -0.239414f,
  -0.092767f, -0.056816f, 0.069713f,  0.035035f,  0.192706f,  0.047971f,
  0.213678f,  0.430564f,  -0.069973f, -0.381193f, 0.312239f,  -0.064827f,
  -0.226319f, -0.094217f, -0.272296f, 0.153501f,  -0.352102f, -0.555517f,
  -0.403558f, -0.289666f, -0.311251f, -0.392626f, -0.136820f, -0.146313f,
  -0.128355f, 0.005812f,  -0.024325f, 0.128613f,  -0.398652f, -0.886468f,
  -0.952848f, -0.839160f, -0.152422f, 0.723564f,  1.074703f,  0.153897f,
  0.279606f,  0.005218f,  -0.097104f, 0.637224f,  -0.144649f, -0.604809f,
  -0.353103f, -0.149670f, 0.080755f,  -0.162062f, -0.075633f, -0.152160f,
  0.129778f,  0.118422f,  0.116762f,  0.037845f,  -0.745763f, -0.928273f,
  -0.698849f, -1.057116f, -1.057109f, -0.127244f, 1.462124f,  -0.134539f,
  -0.232858f, -0.143835f, 0.209998f,  -0.080389f, -0.175758f, -0.585471f,
  -0.274928f, -0.280907f, -0.273137f, -0.073505f, -0.210966f, 0.001316f,
  -0.143989f, 0.064993f,  0.120875f,  0.035231f,  0.143145f,  0.092058f,
  0.351673f,  -0.278807f, -0.339373f, 0.254404f,  0.265899f,  0.043099f,
  0.393326f,  0.101095f,  0.015195f,  -0.076545f, 0.446067f,  -0.243100f,
  -0.083523f, -0.256656f, 0.075819f,  0.292427f,  0.205285f,  0.167406f,
  0.232246f,  -0.171207f, 0.111335f,  0.050237f,  1.679853f,  0.406432f,
  -1.406579f, -1.969444f, -2.126589f, -1.850679f, -1.303879f, 1.054393f,
  -0.474468f, -0.240933f, -0.294443f, -0.371815f, 0.104297f,  -0.220134f,
  -0.316479f, -0.376429f, -0.259840f, -0.170570f, -0.079693f, -0.178509f,
  -0.188283f, -0.262617f, 0.086995f,  0.102999f,  1.187274f,  0.522106f,
  -0.806148f, -0.833173f, -0.709481f, -0.953746f, -1.285358f, 0.285016f,
  0.278096f,  0.124818f,  0.163748f,  0.162124f,  -0.007265f, -0.098871f,
  0.072759f,  -0.072074f, 0.124944f,  -0.024829f, 0.102811f,  0.023228f,
  0.146625f,  0.182478f,  -0.028206f, 0.080828f,  -0.208756f, -0.323181f,
  -0.206568f, -0.383950f, -0.390778f, -0.538341f, -0.348925f, -0.129977f,
  0.227470f,  -0.086785f, -0.351658f, -0.380919f, -0.111618f, 1.036530f,
  0.445590f,  0.377118f,  -0.009796f, -0.129295f, -0.195076f, -0.246043f,
  -0.245131f, -0.334228f, 0.004555f,  0.038105f,  -0.738845f, -0.652971f,
  -0.627552f, 0.733840f,  1.239622f,  0.620689f,  -0.694646f, -1.164160f,
  0.043088f,  -0.100113f, -0.268193f, -0.557951f, -0.306883f, 0.989839f,
  0.248173f,  0.521246f,  -0.115040f, -0.280831f, -0.244435f, -0.191424f,
  -0.377725f, -0.546122f, 0.066304f,  0.049083f,  -0.662545f, -0.652138f,
  -0.578238f, 0.051879f,  1.152715f,  1.091766f,  -0.754960f, -0.815882f,
  0.530927f,  0.097425f,  0.040465f,  -0.074201f, 0.128492f,  0.863531f,
  0.316509f,  0.516579f,  0.248138f,  0.137322f,  -0.082366f, -0.069227f,
  -0.136988f, 0.014702f,  0.141653f,  0.047931f,  -0.372670f, -0.109910f,
  -0.450930f, 0.100929f,  0.431826f,  0.263629f,  -0.529284f, -0.566138f,
  -0.020838f, -0.147415f, -0.025617f, -0.297902f, -0.051517f, 0.320145f,
  0.764300f,  -0.030500f, 0.169791f,  -0.092855f, -0.130052f, -0.074605f,
  -0.146200f, -0.326624f, 0.149420f,  -0.016553f, -0.866074f, -0.412905f,
  0.065311f,  1.621385f,  0.697307f,  -0.543428f, -0.812255f, -1.184932f,
  0.198178f,  -0.005435f, -0.149055f, -0.423156f, -0.151902f, 0.386925f,
  0.686412f,  0.030753f,  0.120826f,  -0.000350f, -0.051030f, -0.018974f,
  -0.287549f, -0.191716f, -0.001033f, 0.074794f,  -0.595430f, -0.222999f,
  -0.103303f, 1.241877f,  1.437467f,  -0.061344f, -1.265876f, -1.232849f,
  0.437245f,  0.088420f,  0.024546f,  0.145778f,  0.095337f,  0.269236f,
  0.575351f,  0.207654f,  0.332718f,  0.148132f,  0.027909f,  0.068634f,
  0.060142f,  0.070797f,  0.108747f,  0.057409f,  -0.255563f, -0.042280f,
  -0.229848f, 0.637369f,  0.404043f,  -0.516529f, -0.550570f, -0.672994f,
  0.125899f,  -0.055070f, -0.306667f, -0.175576f, -0.254946f, 0.387511f,
  -0.084208f, 0.724572f,  0.043883f,  -0.201603f, -0.184356f, -0.298600f,
  -0.068762f, -0.344306f, -0.015211f, 0.094913f,  -0.670309f, -1.302545f,
  -1.210474f, -0.696739f, 0.826621f,  1.712139f,  0.036635f,  -0.289428f,
  -0.136242f, -0.145283f, -0.306571f, -0.245688f, -0.230807f, 0.154209f,
  -0.113051f, 0.696596f,  -0.084854f, -0.273326f, -0.272158f, -0.369800f,
  -0.219487f, -0.504060f, 0.085947f,  0.059731f,  -0.742379f, -0.795820f,
  -0.860816f, -0.871319f, 0.118657f,  1.577701f,  0.054237f,  -0.354653f,
  0.191244f,  -0.044441f, 0.017169f,  -0.139851f, -0.046166f, 0.085279f,
  -0.037798f, 0.577405f,  0.007546f,  0.137830f,  -0.198877f, -0.162689f,
  -0.070646f, -0.221147f, 0.101791f,  0.065451f,  -0.315433f, -0.423350f,
  -0.586537f, -0.734971f, -0.189350f, 0.762708f,  -0.087508f, -0.196121f,
  -0.487058f, -0.184812f, -0.276446f, -0.214372f, -0.428919f, -0.234832f,
  -0.214491f, -0.194949f, 0.039145f,  -0.320336f, -0.098930f, -0.119578f,
  -0.080009f, -0.246949f, 0.080498f,  0.108403f,  0.355724f,  -0.737416f,
  -1.154065f, -0.930956f, -0.591217f, -0.485986f, -0.149913f, 1.415765f,
  0.441066f,  0.173153f,  0.174390f,  0.215108f,  0.115941f,  -0.070819f,
  0.182846f,  0.029849f,  0.581264f,  0.088840f,  0.267916f,  0.195155f,
  0.287085f,  0.021049f,  0.140925f,  0.017466f,  0.763483f,  -0.591215f,
  -1.069135f, -1.596326f, -1.806185f, -1.313579f, -0.279576f, 1.932106f,
  0.136550f,  0.065190f,  0.207955f,  -0.015783f, 0.114555f,  -0.100269f,
  0.029467f,  0.045531f,  0.073877f,  0.170323f,  0.047058f,  0.061573f,
  0.059300f,  0.058915f,  0.031465f,  0.064269f,  -0.125848f, -0.458425f,
  -0.003867f, -0.599760f, -0.367709f, -0.403792f, -0.133114f, 0.176069f,
  0.482757f,  0.124613f,  0.249314f,  0.033182f,  0.210524f,  -0.147388f,
  0.080020f,  -0.029364f, 0.111947f,  0.519599f,  0.262428f,  0.326010f,
  0.177949f,  0.014852f,  0.224281f,  -0.033733f, 0.909222f,  1.990240f,
  -0.343764f, -1.363328f, -1.688738f, -1.647148f, -1.347836f, -0.765935f,
  -0.331029f, -0.155846f, -0.066498f, -0.368260f, -0.152498f, -0.287524f,
  0.029627f,  -0.172123f, -0.198702f, 0.172487f,  -0.050933f, -0.093994f,
  -0.192741f, -0.191230f, 0.100004f,  0.066914f,  0.475491f,  1.168132f,
  -0.120350f, -0.106380f, -0.269643f, -0.859525f, -1.283074f, -0.775568f,
  0.397343f,  0.198370f,  0.138501f,  0.221219f,  0.157756f,  0.076851f,
  0.242244f,  0.172206f,  0.292298f,  0.112471f,  0.183792f,  0.149265f,
  0.207444f,  0.170895f,  -0.002324f, 0.062940f,  -0.091032f, -0.091778f,
  -0.110987f, -0.262904f, -0.328377f, -0.496691f, -0.110160f, -0.354372f,
  0.178700f,  0.120829f,  -0.038974f, 0.034229f,  0.157607f,  -0.295649f,
  -0.183355f, -0.175027f, 0.120546f,  0.101038f,  0.344038f,  0.102203f,
  0.199156f,  -0.074120f, 0.033352f,  0.063641f,  0.040677f,  0.165038f,
  -0.244456f, 0.152012f,  0.284913f,  0.189482f,  -0.000482f, 0.233412f,
  0.077767f,  0.087900f,  -0.034471f, -0.117235f, 0.203990f,  -0.361618f,
  -0.138147f, -0.226014f, 0.008826f,  0.149351f,  0.293689f,  0.065580f,
  0.004904f,  -0.150751f, 0.026138f,  0.073536f,  0.127600f,  0.219736f,
  -0.064003f, 0.170668f,  0.346150f,  0.210638f,  -0.192229f, 0.306155f,
  0.178450f,  0.151241f,  0.065534f,  0.084944f,  0.087841f,  -0.348577f,
  -0.074863f, -0.106990f, 0.105447f,  0.084874f,  0.287286f,  0.128779f,
  0.164190f,  0.049853f,  0.061443f,  0.077535f,  -0.016368f, 0.074669f,
  -0.002479f, 0.122399f,  0.249084f,  0.133972f,  -0.037150f, 0.161502f,
  -0.082292f, 0.012521f,  0.054693f,  -0.142222f, -0.178189f, -0.464736f,
  -0.242903f, -0.430408f, -0.174641f, -0.158475f, -0.002931f, 0.093298f,
  -0.170268f, -0.082234f, 0.120454f,  0.044243f,  0.079839f,  0.413193f,
  0.315539f,  0.000644f,  -0.344496f, -0.723777f, -0.312210f, -0.526289f,
  0.006957f,  0.120839f,  -0.066017f, -0.242252f, 0.036611f,  -0.339880f,
  -0.255470f, -0.302869f, -0.050931f, 0.043986f,  0.149838f,  0.276965f,
  -0.130643f, -0.008625f, 0.071336f,  0.063666f,  0.185376f,  0.526826f,
  0.168239f,  0.183330f,  -0.094586f, -0.472802f, -0.532069f, -0.543257f,
  0.081177f,  0.027188f,  0.011658f,  0.140311f,  -0.101814f, -0.332901f,
  -0.141115f, -0.166876f, -0.007094f, -0.085822f, 0.088226f,  0.147281f,
  0.107361f,  0.080092f,  0.067725f,  0.071273f,  0.057040f,  0.064972f,
  0.103215f,  0.016703f,  -0.119816f, -0.434601f, -0.198447f, -0.392944f,
  -0.001456f, 0.087138f,  -0.321563f, 0.003846f,  -0.207387f, -0.484777f,
  -0.349446f, -0.258899f, -0.088622f, -0.193563f, 0.141655f,  -0.104437f,
  0.269378f,  -0.074531f, 0.040217f,  0.098127f,  -0.082863f, -0.533736f,
  -0.815104f, -0.567957f, -0.315266f, 0.181755f,  0.053005f,  0.649585f,
  -0.117664f, 0.022613f,  -0.155621f, 0.056202f,  -0.079148f, -0.465817f,
  -0.208122f, -0.227124f, -0.138529f, -0.060783f, 0.021117f,  -0.136845f,
  0.127099f,  -0.192445f, 0.075326f,  0.084135f,  -0.053343f, -0.470214f,
  -0.665771f, -0.737004f, -0.583433f, -0.134130f, 0.202714f,  0.514613f,
  0.009335f,  0.040189f,  -0.010968f, 0.002114f,  -0.146824f, -0.501031f,
  -0.250585f, -0.168778f, -0.077594f, -0.057846f, 0.029672f,  -0.066808f,
  0.156647f,  -0.045807f, 0.083933f,  0.075743f,  -0.173608f, -0.296816f,
  -0.325823f, -0.341098f, -0.353745f, 0.035926f,  -0.024484f, 0.204774f,
  0.094283f,  0.066495f,  0.090238f,  0.112852f,  -0.381019f, -0.702150f,
  -0.593049f, -0.660785f, -0.547299f, -0.230760f, 0.058931f,  -0.047210f,
  0.063740f,  0.765911f,  0.189107f,  -0.050683f, -0.524195f, -0.821673f,
  1.333656f,  -0.686424f, -0.780920f, -1.436110f, 0.358378f,  -1.282101f,
  -0.207176f, -0.045816f, 0.165468f,  -0.088309f, -0.397622f, -0.845797f,
  -0.823530f, -0.778826f, -0.650956f, -0.297606f, -0.098250f, 0.104483f,
  -0.389836f, 0.733417f,  0.238711f,  -0.076981f, -0.691276f, -0.979101f,
  0.649889f,  -0.982323f, -0.789317f, -0.950209f, 1.083194f,  -1.435849f,
  -0.158885f, -0.125529f, 0.062196f,  0.106598f,  -0.228854f, -0.427222f,
  -0.270075f, -0.363222f, -0.245462f, -0.106370f, -0.077772f, -0.032590f,
  -0.048948f, 0.163287f,  0.045204f,  0.055506f,  0.316608f,  -0.183046f,
  0.229959f,  -0.410276f, -0.169249f, -0.593926f, 0.351192f,  -0.214626f,
};
static const float intra_y_mode_layer0_bias[EM_MAX_NODES] = {
  0.402680f,  0.299231f,  0.291603f,  -0.383439f, -0.325819f,
  -0.284812f, -0.232927f, -0.195319f, -0.268998f, 0.052971f,
  -0.109909f, -0.130525f, 0.105389f,
};
#endif

static const float intra_uv_mode_layer0_weights[EM_MAX_NODES * EM_MAX_NODES] = {
  -0.022437f, -1.244586f, -1.522855f, -0.296993f, -0.476821f, -1.283499f,
  -0.547331f, -0.686833f, -1.067342f, -0.543531f, -0.454716f, -0.668778f,
  -1.135282f, 0.250092f,  -1.476337f, 1.053453f,  -2.979386f, -1.606389f,
  -1.811687f, -1.705516f, -2.429685f, -2.616098f, -1.335020f, -2.108663f,
  -0.922157f, -2.271251f, -1.354549f, -0.707907f, -1.079305f, -2.231605f,
  1.035370f,  -1.785203f, -1.924051f, -2.466647f, -0.806005f, -1.888103f,
  -2.457748f, -1.409976f, -1.646065f, -0.860099f, -1.368669f, -0.507987f,
  -1.369786f, -1.792577f, -2.700009f, 0.583574f,  -1.527432f, -1.952012f,
  -2.151966f, -0.380716f, -0.414513f, -1.417643f, -0.890648f, -1.297723f,
  -1.746081f, -0.885675f, -0.990266f, -1.937105f, -2.502903f, -1.282405f,
  1.299456f,  -1.014175f, -0.321742f, -2.298821f, -1.951028f, -1.947594f,
  -1.496112f, -2.008492f, -1.989560f, -0.753767f, -1.856212f, -1.490042f,
  -3.039665f, -1.574128f, -0.720041f, 0.764158f,  -2.321216f, -2.398352f,
  -1.902283f, -2.389101f, -1.016747f, -2.030200f, -2.239832f, -0.743063f,
  -0.650349f, -2.499374f, -1.885906f, -1.548484f, -0.321427f, -2.122888f,
  0.854339f,  -2.238494f, -2.292281f, -2.165919f, -2.123072f, -1.671698f,
  -2.126522f, -0.908853f, -0.903463f, -2.266386f, -0.593148f, -0.698310f,
  -1.306700f, -1.841792f, -1.986742f, 0.611406f,  -1.709290f, -0.726104f,
  -0.589859f, -0.777974f, -1.669555f, -0.815155f, -1.999366f, -0.834529f,
  -2.988349f, -0.422616f, -1.817323f, -1.577423f, -2.315450f, -1.972716f,
  1.090255f,  -1.799072f, -0.963129f, -1.510594f, -1.703222f, -0.855914f,
  0.018220f,  -0.890560f, -1.028047f, -0.342823f, -0.713401f, -0.757386f,
  -0.782386f, -1.085011f, -0.574987f, -0.074554f, -0.103883f, -0.131523f,
  -1.391617f, -0.225903f, -0.175065f, -1.410221f, -0.293516f, -0.869744f,
  -1.277511f, -1.645721f, -1.251938f, -0.995794f, -0.937238f, -0.762278f,
  0.172081f,  -1.117636f, -1.087187f, -0.901401f, -0.512718f, -0.466116f,
  -2.365741f, -0.731755f, -1.025905f, -1.315458f, -1.033313f, -1.746689f,
  -1.251462f, -0.790384f, -0.804588f, -0.169876f, -0.656258f, -1.016057f,
  -0.704489f, -1.411492f, -1.370096f, -1.189903f, -1.946825f, -1.925307f,
  -1.550866f, -1.444439f, -1.506008f, -1.471953f, -0.798625f, -1.067253f,
  1.368177f,  -0.646555f, -0.326674f, -0.764442f, -0.564302f, -0.215678f,
  -0.522943f, -1.049327f, -0.334038f, -0.448605f, -0.686173f, -0.637084f,
  -0.730016f, -0.563132f, -1.295342f, -0.155239f,
};
static const float intra_uv_mode_layer0_bias[EM_MAX_NODES] = {
  0.400602f,  -0.710274f, -0.529749f, -0.923791f, -0.788781f,
  -0.761325f, -0.931022f, -0.852190f, -0.878639f, -0.238912f,
  -0.947551f, -0.974834f, -0.667166f, -0.214130f,
};
#endif  // CONFIG_INTRA_ENTROPY

static const aom_cdf_prob default_angle_delta_cdf[DIRECTIONAL_MODES][CDF_SIZE(
    2 * MAX_ANGLE_DELTA + 1)] = {
  { AOM_CDF7(2180, 5032, 7567, 22776, 26989, 30217) },
  { AOM_CDF7(2301, 5608, 8801, 23487, 26974, 30330) },
  { AOM_CDF7(3780, 11018, 13699, 19354, 23083, 31286) },
  { AOM_CDF7(4581, 11226, 15147, 17138, 21834, 28397) },
  { AOM_CDF7(1737, 10927, 14509, 19588, 22745, 28823) },
  { AOM_CDF7(2664, 10176, 12485, 17650, 21600, 30495) },
  { AOM_CDF7(2240, 11096, 15453, 20341, 22561, 28917) },
  { AOM_CDF7(3605, 10428, 12459, 17676, 21244, 30655) }
};

static const aom_cdf_prob default_if_y_mode_cdf[BLOCK_SIZE_GROUPS][CDF_SIZE(
    INTRA_MODES)] = { { AOM_CDF13(22801, 23489, 24293, 24756, 25601, 26123,
                                  26606, 27418, 27945, 29228, 29685, 30349) },
                      { AOM_CDF13(18673, 19845, 22631, 23318, 23950, 24649,
                                  25527, 27364, 28152, 29701, 29984, 30852) },
                      { AOM_CDF13(19770, 20979, 23396, 23939, 24241, 24654,
                                  25136, 27073, 27830, 29360, 29730, 30659) },
                      { AOM_CDF13(20155, 21301, 22838, 23178, 23261, 23533,
                                  23703, 24804, 25352, 26575, 27016, 28049) } };

static const aom_cdf_prob
    default_uv_mode_cdf[CFL_ALLOWED_TYPES][INTRA_MODES][CDF_SIZE(
        UV_INTRA_MODES)] = {
      { { AOM_CDF13(22631, 24152, 25378, 25661, 25986, 26520, 27055, 27923,
                    28244, 30059, 30941, 31961) },
        { AOM_CDF13(9513, 26881, 26973, 27046, 27118, 27664, 27739, 27824,
                    28359, 29505, 29800, 31796) },
        { AOM_CDF13(9845, 9915, 28663, 28704, 28757, 28780, 29198, 29822, 29854,
                    30764, 31777, 32029) },
        { AOM_CDF13(13639, 13897, 14171, 25331, 25606, 25727, 25953, 27148,
                    28577, 30612, 31355, 32493) },
        { AOM_CDF13(9764, 9835, 9930, 9954, 25386, 27053, 27958, 28148, 28243,
                    31101, 31744, 32363) },
        { AOM_CDF13(11825, 13589, 13677, 13720, 15048, 29213, 29301, 29458,
                    29711, 31161, 31441, 32550) },
        { AOM_CDF13(14175, 14399, 16608, 16821, 17718, 17775, 28551, 30200,
                    30245, 31837, 32342, 32667) },
        { AOM_CDF13(12885, 13038, 14978, 15590, 15673, 15748, 16176, 29128,
                    29267, 30643, 31961, 32461) },
        { AOM_CDF13(12026, 13661, 13874, 15305, 15490, 15726, 15995, 16273,
                    28443, 30388, 30767, 32416) },
        { AOM_CDF13(19052, 19840, 20579, 20916, 21150, 21467, 21885, 22719,
                    23174, 28861, 30379, 32175) },
        { AOM_CDF13(18627, 19649, 20974, 21219, 21492, 21816, 22199, 23119,
                    23527, 27053, 31397, 32148) },
        { AOM_CDF13(17026, 19004, 19997, 20339, 20586, 21103, 21349, 21907,
                    22482, 25896, 26541, 31819) },
        { AOM_CDF13(12124, 13759, 14959, 14992, 15007, 15051, 15078, 15166,
                    15255, 15753, 16039, 16606) } },
      { { AOM_CDF14(10407, 11208, 12900, 13181, 13823, 14175, 14899, 15656,
                    15986, 20086, 20995, 22455, 24212) },
        { AOM_CDF14(4532, 19780, 20057, 20215, 20428, 21071, 21199, 21451,
                    22099, 24228, 24693, 27032, 29472) },
        { AOM_CDF14(5273, 5379, 20177, 20270, 20385, 20439, 20949, 21695, 21774,
                    23138, 24256, 24703, 26679) },
        { AOM_CDF14(6740, 7167, 7662, 14152, 14536, 14785, 15034, 16741, 18371,
                    21520, 22206, 23389, 24182) },
        { AOM_CDF14(4987, 5368, 5928, 6068, 19114, 20315, 21857, 22253, 22411,
                    24911, 25380, 26027, 26376) },
        { AOM_CDF14(5370, 6889, 7247, 7393, 9498, 21114, 21402, 21753, 21981,
                    24780, 25386, 26517, 27176) },
        { AOM_CDF14(4816, 4961, 7204, 7326, 8765, 8930, 20169, 20682, 20803,
                    23188, 23763, 24455, 24940) },
        { AOM_CDF14(6608, 6740, 8529, 9049, 9257, 9356, 9735, 18827, 19059,
                    22336, 23204, 23964, 24793) },
        { AOM_CDF14(5998, 7419, 7781, 8933, 9255, 9549, 9753, 10417, 18898,
                    22494, 23139, 24764, 25989) },
        { AOM_CDF14(10660, 11298, 12550, 12957, 13322, 13624, 14040, 15004,
                    15534, 20714, 21789, 23443, 24861) },
        { AOM_CDF14(10522, 11530, 12552, 12963, 13378, 13779, 14245, 15235,
                    15902, 20102, 22696, 23774, 25838) },
        { AOM_CDF14(10099, 10691, 12639, 13049, 13386, 13665, 14125, 15163,
                    15636, 19676, 20474, 23519, 25208) },
        { AOM_CDF14(3144, 5087, 7382, 7504, 7593, 7690, 7801, 8064, 8232, 9248,
                    9875, 10521, 29048) } }
    };

static const aom_cdf_prob default_partition_cdf[PARTITION_CONTEXTS][CDF_SIZE(
    EXT_PARTITION_TYPES)] = {
  { AOM_CDF4(19132, 25510, 30392) },
  { AOM_CDF4(13928, 19855, 28540) },
  { AOM_CDF4(12522, 23679, 28629) },
  { AOM_CDF4(9896, 18783, 25853) },
  { AOM_CDF10(15597, 20929, 24571, 26706, 27664, 28821, 29601, 30571, 31902) },
  { AOM_CDF10(7925, 11043, 16785, 22470, 23971, 25043, 26651, 28701, 29834) },
  { AOM_CDF10(5414, 13269, 15111, 20488, 22360, 24500, 25537, 26336, 32117) },
  { AOM_CDF10(2662, 6362, 8614, 20860, 23053, 24778, 26436, 27829, 31171) },
  { AOM_CDF10(18462, 20920, 23124, 27647, 28227, 29049, 29519, 30178, 31544) },
  { AOM_CDF10(7689, 9060, 12056, 24992, 25660, 26182, 26951, 28041, 29052) },
  { AOM_CDF10(6015, 9009, 10062, 24544, 25409, 26545, 27071, 27526, 32047) },
  { AOM_CDF10(1394, 2208, 2796, 28614, 29061, 29466, 29840, 30185, 31899) },
  { AOM_CDF10(20137, 21547, 23078, 29566, 29837, 30261, 30524, 30892, 31724) },
  { AOM_CDF10(6732, 7490, 9497, 27944, 28250, 28515, 28969, 29630, 30104) },
  { AOM_CDF10(5945, 7663, 8348, 28683, 29117, 29749, 30064, 30298, 32238) },
  { AOM_CDF10(870, 1212, 1487, 31198, 31394, 31574, 31743, 31881, 32332) },
  { AOM_CDF8(27899, 28219, 28529, 32484, 32539, 32619, 32639) },
  { AOM_CDF8(6607, 6990, 8268, 32060, 32219, 32338, 32371) },
  { AOM_CDF8(5429, 6676, 7122, 32027, 32227, 32531, 32582) },
  { AOM_CDF8(711, 966, 1172, 32448, 32538, 32617, 32664) },
};

#if CONFIG_MODE_DEP_TX
static const aom_cdf_prob default_intra_ext_tx_cdf
    [EXT_TX_SETS_INTRA][EXT_TX_SIZES][INTRA_MODES]
    [CDF_SIZE(TX_TYPES_NOMDTX)] = {
#else
static const aom_cdf_prob default_intra_ext_tx_cdf
    [EXT_TX_SETS_INTRA][EXT_TX_SIZES][INTRA_MODES][CDF_SIZE(TX_TYPES)] = {
#endif
      {
          {
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
          },
          {
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
          },
          {
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
          },
          {
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
              { 0 },
          },
      },
      {
          {
              { AOM_CDF7(1535, 8035, 9461, 12751, 23467, 27825) },
              { AOM_CDF7(564, 3335, 9709, 10870, 18143, 28094) },
              { AOM_CDF7(672, 3247, 3676, 11982, 19415, 23127) },
              { AOM_CDF7(5279, 13885, 15487, 18044, 23527, 30252) },
              { AOM_CDF7(4423, 6074, 7985, 10416, 25693, 29298) },
              { AOM_CDF7(1486, 4241, 9460, 10662, 16456, 27694) },
              { AOM_CDF7(439, 2838, 3522, 6737, 18058, 23754) },
              { AOM_CDF7(1190, 4233, 4855, 11670, 20281, 24377) },
              { AOM_CDF7(1045, 4312, 8647, 10159, 18644, 29335) },
              { AOM_CDF7(202, 3734, 4747, 7298, 17127, 24016) },
              { AOM_CDF7(447, 4312, 6819, 8884, 16010, 23858) },
              { AOM_CDF7(277, 4369, 5255, 8905, 16465, 22271) },
              { AOM_CDF7(3409, 5436, 10599, 15599, 19687, 24040) },
          },
          {
              { AOM_CDF7(1870, 13742, 14530, 16498, 23770, 27698) },
              { AOM_CDF7(326, 8796, 14632, 15079, 19272, 27486) },
              { AOM_CDF7(484, 7576, 7712, 14443, 19159, 22591) },
              { AOM_CDF7(1126, 15340, 15895, 17023, 20896, 30279) },
              { AOM_CDF7(655, 4854, 5249, 5913, 22099, 27138) },
              { AOM_CDF7(1299, 6458, 8885, 9290, 14851, 25497) },
              { AOM_CDF7(311, 5295, 5552, 6885, 16107, 22672) },
              { AOM_CDF7(883, 8059, 8270, 11258, 17289, 21549) },
              { AOM_CDF7(741, 7580, 9318, 10345, 16688, 29046) },
              { AOM_CDF7(110, 7406, 7915, 9195, 16041, 23329) },
              { AOM_CDF7(363, 7974, 9357, 10673, 15629, 24474) },
              { AOM_CDF7(153, 7647, 8112, 9936, 15307, 19996) },
              { AOM_CDF7(3511, 6332, 11165, 15335, 19323, 23594) },
          },
          {
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
          },
          {
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
              { AOM_CDF7(4681, 9362, 14043, 18725, 23406, 28087) },
          },
      },
      {
          {
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
          },
          {
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
          },
          {
              { AOM_CDF5(1127, 12814, 22772, 27483) },
              { AOM_CDF5(145, 6761, 11980, 26667) },
              { AOM_CDF5(362, 5887, 11678, 16725) },
              { AOM_CDF5(385, 15213, 18587, 30693) },
              { AOM_CDF5(25, 2914, 23134, 27903) },
              { AOM_CDF5(60, 4470, 11749, 23991) },
              { AOM_CDF5(37, 3332, 14511, 21448) },
              { AOM_CDF5(157, 6320, 13036, 17439) },
              { AOM_CDF5(119, 6719, 12906, 29396) },
              { AOM_CDF5(47, 5537, 12576, 21499) },
              { AOM_CDF5(269, 6076, 11258, 23115) },
              { AOM_CDF5(83, 5615, 12001, 17228) },
              { AOM_CDF5(1968, 5556, 12023, 18547) },
          },
          {
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
              { AOM_CDF5(6554, 13107, 19661, 26214) },
          },
      },
    };

#if CONFIG_MODE_DEP_TX
static const aom_cdf_prob
    default_inter_ext_tx_cdf[EXT_TX_SETS_INTER][EXT_TX_SIZES][CDF_SIZE(
        TX_TYPES_NOMDTX)] = {
#else
static const aom_cdf_prob
    default_inter_ext_tx_cdf[EXT_TX_SETS_INTER][EXT_TX_SIZES][CDF_SIZE(
        TX_TYPES)] = {
#endif
      {
          { 0 },
          { 0 },
          { 0 },
          { 0 },
      },
      {
          { AOM_CDF16(4458, 5560, 7695, 9709, 13330, 14789, 17537, 20266, 21504,
                      22848, 23934, 25474, 27727, 28915, 30631) },
          { AOM_CDF16(1645, 2573, 4778, 5711, 7807, 8622, 10522, 15357, 17674,
                      20408, 22517, 25010, 27116, 28856, 30749) },
          { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                      20480, 22528, 24576, 26624, 28672, 30720) },
          { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                      20480, 22528, 24576, 26624, 28672, 30720) },
      },
      {
          { AOM_CDF12(2731, 5461, 8192, 10923, 13653, 16384, 19115, 21845,
                      24576, 27307, 30037) },
          { AOM_CDF12(2731, 5461, 8192, 10923, 13653, 16384, 19115, 21845,
                      24576, 27307, 30037) },
          { AOM_CDF12(770, 2421, 5225, 12907, 15819, 18927, 21561, 24089, 26595,
                      28526, 30529) },
          { AOM_CDF12(2731, 5461, 8192, 10923, 13653, 16384, 19115, 21845,
                      24576, 27307, 30037) },
      },
      {
          { AOM_CDF2(16384) },
          { AOM_CDF2(4167) },
          { AOM_CDF2(1998) },
          { AOM_CDF2(748) },
      },
    };

#if CONFIG_MODE_DEP_TX
#if USE_MDTX_INTER
static const aom_cdf_prob
    default_mdtx_type_inter_cdf[EXT_TX_SIZES][CDF_SIZE(MDTX_TYPES_INTER)] = {
      { AOM_CDF8(4096, 8192, 12288, 16384, 20480, 24576, 28672) },
      { AOM_CDF8(4096, 8192, 12288, 16384, 20480, 24576, 28672) },
      { AOM_CDF8(4096, 8192, 12288, 16384, 20480, 24576, 28672) },
      { AOM_CDF8(4096, 8192, 12288, 16384, 20480, 24576, 28672) },
    };

static const aom_cdf_prob default_use_mdtx_inter_cdf[EXT_TX_SIZES]
                                                    [CDF_SIZE(2)] = {
                                                      { AOM_CDF2(16384) },
                                                      { AOM_CDF2(16384) },
                                                      { AOM_CDF2(16384) },
                                                      { AOM_CDF2(16384) },
                                                    };
#endif  // USE_MDTX_INTER
#if USE_MDTX_INTRA
static const aom_cdf_prob
    default_mdtx_type_intra_cdf[EXT_TX_SIZES][INTRA_MODES]
                               [CDF_SIZE(MDTX_TYPES_INTRA)] = {
                                 {
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                 },
                                 {
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                 },
                                 {
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                 },
                                 {
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                     { AOM_CDF3(10923, 21845) },
                                 },
                               };

static const aom_cdf_prob default_use_mdtx_intra_cdf[EXT_TX_SIZES][INTRA_MODES]
                                                    [CDF_SIZE(2)] = {
                                                      {
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                      },
                                                      {
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                      },
                                                      {
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                      },
                                                      {
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                          { AOM_CDF2(16384) },
                                                      }
                                                    };
#endif  // USE_MDTX_INTRA
#endif

static const aom_cdf_prob default_cfl_sign_cdf[CDF_SIZE(CFL_JOINT_SIGNS)] = {
  AOM_CDF8(1418, 2123, 13340, 18405, 26972, 28343, 32294)
};

static const aom_cdf_prob
    default_cfl_alpha_cdf[CFL_ALPHA_CONTEXTS][CDF_SIZE(CFL_ALPHABET_SIZE)] = {
      { AOM_CDF16(7637, 20719, 31401, 32481, 32657, 32688, 32692, 32696, 32700,
                  32704, 32708, 32712, 32716, 32720, 32724) },
      { AOM_CDF16(14365, 23603, 28135, 31168, 32167, 32395, 32487, 32573, 32620,
                  32647, 32668, 32672, 32676, 32680, 32684) },
      { AOM_CDF16(11532, 22380, 28445, 31360, 32349, 32523, 32584, 32649, 32673,
                  32677, 32681, 32685, 32689, 32693, 32697) },
      { AOM_CDF16(26990, 31402, 32282, 32571, 32692, 32696, 32700, 32704, 32708,
                  32712, 32716, 32720, 32724, 32728, 32732) },
      { AOM_CDF16(17248, 26058, 28904, 30608, 31305, 31877, 32126, 32321, 32394,
                  32464, 32516, 32560, 32576, 32593, 32622) },
      { AOM_CDF16(14738, 21678, 25779, 27901, 29024, 30302, 30980, 31843, 32144,
                  32413, 32520, 32594, 32622, 32656, 32660) }
    };

static const aom_cdf_prob
    default_switchable_interp_cdf[SWITCHABLE_FILTER_CONTEXTS][CDF_SIZE(
        SWITCHABLE_FILTERS)] = {
      { AOM_CDF3(31935, 32720) }, { AOM_CDF3(5568, 32719) },
      { AOM_CDF3(422, 2938) },    { AOM_CDF3(28244, 32608) },
      { AOM_CDF3(31206, 31953) }, { AOM_CDF3(4862, 32121) },
      { AOM_CDF3(770, 1152) },    { AOM_CDF3(20889, 25637) },
      { AOM_CDF3(31910, 32724) }, { AOM_CDF3(4120, 32712) },
      { AOM_CDF3(305, 2247) },    { AOM_CDF3(27403, 32636) },
      { AOM_CDF3(31022, 32009) }, { AOM_CDF3(2963, 32093) },
      { AOM_CDF3(601, 943) },     { AOM_CDF3(14969, 21398) }
    };

static const aom_cdf_prob default_newmv_cdf[NEWMV_MODE_CONTEXTS][CDF_SIZE(
    2)] = { { AOM_CDF2(24035) }, { AOM_CDF2(16630) }, { AOM_CDF2(15339) },
            { AOM_CDF2(8386) },  { AOM_CDF2(12222) }, { AOM_CDF2(4676) } };

static const aom_cdf_prob default_zeromv_cdf[GLOBALMV_MODE_CONTEXTS][CDF_SIZE(
    2)] = { { AOM_CDF2(2175) }, { AOM_CDF2(1054) } };

static const aom_cdf_prob default_refmv_cdf[REFMV_MODE_CONTEXTS][CDF_SIZE(
    2)] = { { AOM_CDF2(23974) }, { AOM_CDF2(24188) }, { AOM_CDF2(17848) },
            { AOM_CDF2(28622) }, { AOM_CDF2(24312) }, { AOM_CDF2(19923) } };

static const aom_cdf_prob default_drl_cdf[DRL_MODE_CONTEXTS][CDF_SIZE(2)] = {
  { AOM_CDF2(13104) }, { AOM_CDF2(24560) }, { AOM_CDF2(18945) }
};

static const aom_cdf_prob
    default_inter_compound_mode_cdf[INTER_MODE_CONTEXTS][CDF_SIZE(
        INTER_COMPOUND_MODES)] = {
      { AOM_CDF8(7760, 13823, 15808, 17641, 19156, 20666, 26891) },
      { AOM_CDF8(10730, 19452, 21145, 22749, 24039, 25131, 28724) },
      { AOM_CDF8(10664, 20221, 21588, 22906, 24295, 25387, 28436) },
      { AOM_CDF8(13298, 16984, 20471, 24182, 25067, 25736, 26422) },
      { AOM_CDF8(18904, 23325, 25242, 27432, 27898, 28258, 30758) },
      { AOM_CDF8(10725, 17454, 20124, 22820, 24195, 25168, 26046) },
      { AOM_CDF8(17125, 24273, 25814, 27492, 28214, 28704, 30592) },
      { AOM_CDF8(13046, 23214, 24505, 25942, 27435, 28442, 29330) }
    };

static const aom_cdf_prob default_interintra_cdf[BLOCK_SIZE_GROUPS][CDF_SIZE(
    2)] = { { AOM_CDF2(16384) },
            { AOM_CDF2(26887) },
            { AOM_CDF2(27597) },
            { AOM_CDF2(30237) } };

static const aom_cdf_prob
    default_interintra_mode_cdf[BLOCK_SIZE_GROUPS][CDF_SIZE(
        INTERINTRA_MODES)] = { { AOM_CDF4(8192, 16384, 24576) },
                               { AOM_CDF4(1875, 11082, 27332) },
                               { AOM_CDF4(2473, 9996, 26388) },
                               { AOM_CDF4(4238, 11537, 25926) } };

static const aom_cdf_prob
    default_wedge_interintra_cdf[BLOCK_SIZES_ALL][CDF_SIZE(2)] = {
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(20036) }, { AOM_CDF2(24957) }, { AOM_CDF2(26704) },
      { AOM_CDF2(27530) }, { AOM_CDF2(29564) }, { AOM_CDF2(29444) },
      { AOM_CDF2(26872) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) },
#if CONFIG_FLEX_PARTITION
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
#endif  // CONFIG_FLEX_PARTITION
    };

static const aom_cdf_prob default_compound_type_cdf[BLOCK_SIZES_ALL][CDF_SIZE(
    MASKED_COMPOUND_TYPES)] = {
  { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
  { AOM_CDF2(23431) }, { AOM_CDF2(13171) }, { AOM_CDF2(11470) },
  { AOM_CDF2(9770) },  { AOM_CDF2(9100) },  { AOM_CDF2(8233) },
  { AOM_CDF2(6172) },  { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
  { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
  { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
  { AOM_CDF2(11820) }, { AOM_CDF2(7701) },  { AOM_CDF2(16384) },
  { AOM_CDF2(16384) },
#if CONFIG_FLEX_PARTITION
  { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
  { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
#endif  // CONFIG_FLEX_PARTITION
};

static const aom_cdf_prob
    default_wedge_idx_cdf[BLOCK_SIZES_ALL][CDF_SIZE(16)] = {
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2438, 4440, 6599, 8663, 11005, 12874, 15751, 18094, 20359,
                  22362, 24127, 25702, 27752, 29450, 31171) },
      { AOM_CDF16(806, 3266, 6005, 6738, 7218, 7367, 7771, 14588, 16323, 17367,
                  18452, 19422, 22839, 26127, 29629) },
      { AOM_CDF16(2779, 3738, 4683, 7213, 7775, 8017, 8655, 14357, 17939, 21332,
                  24520, 27470, 29456, 30529, 31656) },
      { AOM_CDF16(1684, 3625, 5675, 7108, 9302, 11274, 14429, 17144, 19163,
                  20961, 22884, 24471, 26719, 28714, 30877) },
      { AOM_CDF16(1142, 3491, 6277, 7314, 8089, 8355, 9023, 13624, 15369, 16730,
                  18114, 19313, 22521, 26012, 29550) },
      { AOM_CDF16(2742, 4195, 5727, 8035, 8980, 9336, 10146, 14124, 17270,
                  20533, 23434, 25972, 27944, 29570, 31416) },
      { AOM_CDF16(1727, 3948, 6101, 7796, 9841, 12344, 15766, 18944, 20638,
                  22038, 23963, 25311, 26988, 28766, 31012) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(154, 987, 1925, 2051, 2088, 2111, 2151, 23033, 23703, 24284,
                  24985, 25684, 27259, 28883, 30911) },
      { AOM_CDF16(1135, 1322, 1493, 2635, 2696, 2737, 2770, 21016, 22935, 25057,
                  27251, 29173, 30089, 30960, 31933) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
#if CONFIG_FLEX_PARTITION
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
      { AOM_CDF16(2048, 4096, 6144, 8192, 10240, 12288, 14336, 16384, 18432,
                  20480, 22528, 24576, 26624, 28672, 30720) },
#endif  // CONFIG_FLEX_PARTITION
    };

static const aom_cdf_prob
    default_motion_mode_cdf[BLOCK_SIZES_ALL][CDF_SIZE(MOTION_MODES)] = {
      { AOM_CDF3(10923, 21845) }, { AOM_CDF3(10923, 21845) },
      { AOM_CDF3(10923, 21845) }, { AOM_CDF3(7651, 24760) },
      { AOM_CDF3(4738, 24765) },  { AOM_CDF3(5391, 25528) },
      { AOM_CDF3(19419, 26810) }, { AOM_CDF3(5123, 23606) },
      { AOM_CDF3(11606, 24308) }, { AOM_CDF3(26260, 29116) },
      { AOM_CDF3(20360, 28062) }, { AOM_CDF3(21679, 26830) },
      { AOM_CDF3(29516, 30701) }, { AOM_CDF3(28898, 30397) },
      { AOM_CDF3(30878, 31335) }, { AOM_CDF3(32507, 32558) },
      { AOM_CDF3(10923, 21845) }, { AOM_CDF3(10923, 21845) },
      { AOM_CDF3(28799, 31390) }, { AOM_CDF3(26431, 30774) },
      { AOM_CDF3(28973, 31594) }, { AOM_CDF3(29742, 31203) },
#if CONFIG_FLEX_PARTITION
      { AOM_CDF3(16384, 24576) }, { AOM_CDF3(16384, 24576) },
      { AOM_CDF3(16384, 27000) }, { AOM_CDF3(16384, 27000) },
      { AOM_CDF3(16384, 27000) }, { AOM_CDF3(16384, 27000) },
#endif  // CONFIG_FLEX_PARTITION
    };

static const aom_cdf_prob default_obmc_cdf[BLOCK_SIZES_ALL][CDF_SIZE(2)] = {
  { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
  { AOM_CDF2(10437) }, { AOM_CDF2(9371) },  { AOM_CDF2(9301) },
  { AOM_CDF2(17432) }, { AOM_CDF2(14423) }, { AOM_CDF2(15142) },
  { AOM_CDF2(25817) }, { AOM_CDF2(22823) }, { AOM_CDF2(22083) },
  { AOM_CDF2(30128) }, { AOM_CDF2(31014) }, { AOM_CDF2(31560) },
  { AOM_CDF2(32638) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
  { AOM_CDF2(23664) }, { AOM_CDF2(20901) }, { AOM_CDF2(24008) },
  { AOM_CDF2(26879) },
#if CONFIG_FLEX_PARTITION
  { AOM_CDF2(24000) }, { AOM_CDF2(24000) }, { AOM_CDF2(24000) },
  { AOM_CDF2(24000) }, { AOM_CDF2(24000) }, { AOM_CDF2(24000) },
#endif  // CONFIG_FLEX_PARTITION
};

static const aom_cdf_prob default_intra_inter_cdf[INTRA_INTER_CONTEXTS]
                                                 [CDF_SIZE(2)] = {
                                                   { AOM_CDF2(806) },
                                                   { AOM_CDF2(16662) },
                                                   { AOM_CDF2(20186) },
                                                   { AOM_CDF2(26538) }
                                                 };

static const aom_cdf_prob default_comp_inter_cdf[COMP_INTER_CONTEXTS][CDF_SIZE(
    2)] = { { AOM_CDF2(26828) },
            { AOM_CDF2(24035) },
            { AOM_CDF2(12031) },
            { AOM_CDF2(10640) },
            { AOM_CDF2(2901) } };

static const aom_cdf_prob default_comp_ref_type_cdf[COMP_REF_TYPE_CONTEXTS]
                                                   [CDF_SIZE(2)] = {
                                                     { AOM_CDF2(1198) },
                                                     { AOM_CDF2(2070) },
                                                     { AOM_CDF2(9166) },
                                                     { AOM_CDF2(7499) },
                                                     { AOM_CDF2(22475) }
                                                   };

static const aom_cdf_prob
    default_uni_comp_ref_cdf[UNI_COMP_REF_CONTEXTS][UNIDIR_COMP_REFS -
                                                    1][CDF_SIZE(2)] = {
      { { AOM_CDF2(5284) }, { AOM_CDF2(3865) }, { AOM_CDF2(3128) } },
      { { AOM_CDF2(23152) }, { AOM_CDF2(14173) }, { AOM_CDF2(15270) } },
      { { AOM_CDF2(31774) }, { AOM_CDF2(25120) }, { AOM_CDF2(26710) } }
    };

static const aom_cdf_prob default_single_ref_cdf[REF_CONTEXTS][SINGLE_REFS - 1]
                                                [CDF_SIZE(2)] = {
                                                  { { AOM_CDF2(4897) },
                                                    { AOM_CDF2(1555) },
                                                    { AOM_CDF2(4236) },
                                                    { AOM_CDF2(8650) },
                                                    { AOM_CDF2(904) },
                                                    { AOM_CDF2(1444) } },
                                                  { { AOM_CDF2(16973) },
                                                    { AOM_CDF2(16751) },
                                                    { AOM_CDF2(19647) },
                                                    { AOM_CDF2(24773) },
                                                    { AOM_CDF2(11014) },
                                                    { AOM_CDF2(15087) } },
                                                  { { AOM_CDF2(29744) },
                                                    { AOM_CDF2(30279) },
                                                    { AOM_CDF2(31194) },
                                                    { AOM_CDF2(31895) },
                                                    { AOM_CDF2(26875) },
                                                    { AOM_CDF2(30304) } }
                                                };

static const aom_cdf_prob
    default_comp_ref_cdf[REF_CONTEXTS][FWD_REFS - 1][CDF_SIZE(2)] = {
      { { AOM_CDF2(4946) }, { AOM_CDF2(9468) }, { AOM_CDF2(1503) } },
      { { AOM_CDF2(19891) }, { AOM_CDF2(22441) }, { AOM_CDF2(15160) } },
      { { AOM_CDF2(30731) }, { AOM_CDF2(31059) }, { AOM_CDF2(27544) } }
    };

static const aom_cdf_prob
    default_comp_bwdref_cdf[REF_CONTEXTS][BWD_REFS - 1][CDF_SIZE(2)] = {
      { { AOM_CDF2(2235) }, { AOM_CDF2(1423) } },
      { { AOM_CDF2(17182) }, { AOM_CDF2(15175) } },
      { { AOM_CDF2(30606) }, { AOM_CDF2(30489) } }
    };

static const aom_cdf_prob
    default_palette_y_size_cdf[PALATTE_BSIZE_CTXS][CDF_SIZE(PALETTE_SIZES)] = {
      { AOM_CDF7(7952, 13000, 18149, 21478, 25527, 29241) },
      { AOM_CDF7(7139, 11421, 16195, 19544, 23666, 28073) },
      { AOM_CDF7(7788, 12741, 17325, 20500, 24315, 28530) },
      { AOM_CDF7(8271, 14064, 18246, 21564, 25071, 28533) },
      { AOM_CDF7(12725, 19180, 21863, 24839, 27535, 30120) },
      { AOM_CDF7(9711, 14888, 16923, 21052, 25661, 27875) },
      { AOM_CDF7(14940, 20797, 21678, 24186, 27033, 28999) }
    };

static const aom_cdf_prob
    default_palette_uv_size_cdf[PALATTE_BSIZE_CTXS][CDF_SIZE(PALETTE_SIZES)] = {
      { AOM_CDF7(8713, 19979, 27128, 29609, 31331, 32272) },
      { AOM_CDF7(5839, 15573, 23581, 26947, 29848, 31700) },
      { AOM_CDF7(4426, 11260, 17999, 21483, 25863, 29430) },
      { AOM_CDF7(3228, 9464, 14993, 18089, 22523, 27420) },
      { AOM_CDF7(3768, 8886, 13091, 17852, 22495, 27207) },
      { AOM_CDF7(2464, 8451, 12861, 21632, 25525, 28555) },
      { AOM_CDF7(1269, 5435, 10433, 18963, 21700, 25865) }
    };

static const aom_cdf_prob default_palette_y_mode_cdf
    [PALATTE_BSIZE_CTXS][PALETTE_Y_MODE_CONTEXTS][CDF_SIZE(2)] = {
      { { AOM_CDF2(31676) }, { AOM_CDF2(3419) }, { AOM_CDF2(1261) } },
      { { AOM_CDF2(31912) }, { AOM_CDF2(2859) }, { AOM_CDF2(980) } },
      { { AOM_CDF2(31823) }, { AOM_CDF2(3400) }, { AOM_CDF2(781) } },
      { { AOM_CDF2(32030) }, { AOM_CDF2(3561) }, { AOM_CDF2(904) } },
      { { AOM_CDF2(32309) }, { AOM_CDF2(7337) }, { AOM_CDF2(1462) } },
      { { AOM_CDF2(32265) }, { AOM_CDF2(4015) }, { AOM_CDF2(1521) } },
      { { AOM_CDF2(32450) }, { AOM_CDF2(7946) }, { AOM_CDF2(129) } }
    };

static const aom_cdf_prob
    default_palette_uv_mode_cdf[PALETTE_UV_MODE_CONTEXTS][CDF_SIZE(2)] = {
      { AOM_CDF2(32461) }, { AOM_CDF2(21488) }
    };

static const aom_cdf_prob default_palette_y_color_index_cdf
    [PALETTE_SIZES][PALETTE_COLOR_INDEX_CONTEXTS][CDF_SIZE(PALETTE_COLORS)] = {
      {
          { AOM_CDF2(28710) },
          { AOM_CDF2(16384) },
          { AOM_CDF2(10553) },
          { AOM_CDF2(27036) },
          { AOM_CDF2(31603) },
      },
      {
          { AOM_CDF3(27877, 30490) },
          { AOM_CDF3(11532, 25697) },
          { AOM_CDF3(6544, 30234) },
          { AOM_CDF3(23018, 28072) },
          { AOM_CDF3(31915, 32385) },
      },
      {
          { AOM_CDF4(25572, 28046, 30045) },
          { AOM_CDF4(9478, 21590, 27256) },
          { AOM_CDF4(7248, 26837, 29824) },
          { AOM_CDF4(19167, 24486, 28349) },
          { AOM_CDF4(31400, 31825, 32250) },
      },
      {
          { AOM_CDF5(24779, 26955, 28576, 30282) },
          { AOM_CDF5(8669, 20364, 24073, 28093) },
          { AOM_CDF5(4255, 27565, 29377, 31067) },
          { AOM_CDF5(19864, 23674, 26716, 29530) },
          { AOM_CDF5(31646, 31893, 32147, 32426) },
      },
      {
          { AOM_CDF6(23132, 25407, 26970, 28435, 30073) },
          { AOM_CDF6(7443, 17242, 20717, 24762, 27982) },
          { AOM_CDF6(6300, 24862, 26944, 28784, 30671) },
          { AOM_CDF6(18916, 22895, 25267, 27435, 29652) },
          { AOM_CDF6(31270, 31550, 31808, 32059, 32353) },
      },
      {
          { AOM_CDF7(23105, 25199, 26464, 27684, 28931, 30318) },
          { AOM_CDF7(6950, 15447, 18952, 22681, 25567, 28563) },
          { AOM_CDF7(7560, 23474, 25490, 27203, 28921, 30708) },
          { AOM_CDF7(18544, 22373, 24457, 26195, 28119, 30045) },
          { AOM_CDF7(31198, 31451, 31670, 31882, 32123, 32391) },
      },
      {
          { AOM_CDF8(21689, 23883, 25163, 26352, 27506, 28827, 30195) },
          { AOM_CDF8(6892, 15385, 17840, 21606, 24287, 26753, 29204) },
          { AOM_CDF8(5651, 23182, 25042, 26518, 27982, 29392, 30900) },
          { AOM_CDF8(19349, 22578, 24418, 25994, 27524, 29031, 30448) },
          { AOM_CDF8(31028, 31270, 31504, 31705, 31927, 32153, 32392) },
      },
    };

static const aom_cdf_prob default_palette_uv_color_index_cdf
    [PALETTE_SIZES][PALETTE_COLOR_INDEX_CONTEXTS][CDF_SIZE(PALETTE_COLORS)] = {
      {
          { AOM_CDF2(29089) },
          { AOM_CDF2(16384) },
          { AOM_CDF2(8713) },
          { AOM_CDF2(29257) },
          { AOM_CDF2(31610) },
      },
      {
          { AOM_CDF3(25257, 29145) },
          { AOM_CDF3(12287, 27293) },
          { AOM_CDF3(7033, 27960) },
          { AOM_CDF3(20145, 25405) },
          { AOM_CDF3(30608, 31639) },
      },
      {
          { AOM_CDF4(24210, 27175, 29903) },
          { AOM_CDF4(9888, 22386, 27214) },
          { AOM_CDF4(5901, 26053, 29293) },
          { AOM_CDF4(18318, 22152, 28333) },
          { AOM_CDF4(30459, 31136, 31926) },
      },
      {
          { AOM_CDF5(22980, 25479, 27781, 29986) },
          { AOM_CDF5(8413, 21408, 24859, 28874) },
          { AOM_CDF5(2257, 29449, 30594, 31598) },
          { AOM_CDF5(19189, 21202, 25915, 28620) },
          { AOM_CDF5(31844, 32044, 32281, 32518) },
      },
      {
          { AOM_CDF6(22217, 24567, 26637, 28683, 30548) },
          { AOM_CDF6(7307, 16406, 19636, 24632, 28424) },
          { AOM_CDF6(4441, 25064, 26879, 28942, 30919) },
          { AOM_CDF6(17210, 20528, 23319, 26750, 29582) },
          { AOM_CDF6(30674, 30953, 31396, 31735, 32207) },
      },
      {
          { AOM_CDF7(21239, 23168, 25044, 26962, 28705, 30506) },
          { AOM_CDF7(6545, 15012, 18004, 21817, 25503, 28701) },
          { AOM_CDF7(3448, 26295, 27437, 28704, 30126, 31442) },
          { AOM_CDF7(15889, 18323, 21704, 24698, 26976, 29690) },
          { AOM_CDF7(30988, 31204, 31479, 31734, 31983, 32325) },
      },
      {
          { AOM_CDF8(21442, 23288, 24758, 26246, 27649, 28980, 30563) },
          { AOM_CDF8(5863, 14933, 17552, 20668, 23683, 26411, 29273) },
          { AOM_CDF8(3415, 25810, 26877, 27990, 29223, 30394, 31618) },
          { AOM_CDF8(17965, 20084, 22232, 23974, 26274, 28402, 30390) },
          { AOM_CDF8(31190, 31329, 31516, 31679, 31825, 32026, 32322) },
      },
    };

#if CONFIG_NEW_TX_PARTITION
static const aom_cdf_prob
    default_txfm_partition_cdf[TXFM_PARTITION_CONTEXTS][CDF_SIZE(
        TX_PARTITION_TYPES)] = {
      { AOM_CDF2(28581) }, { AOM_CDF2(23846) }, { AOM_CDF2(20847) },
      { AOM_CDF2(24315) }, { AOM_CDF2(18196) }, { AOM_CDF2(12133) },
      { AOM_CDF2(18791) }, { AOM_CDF2(10887) }, { AOM_CDF2(11005) },
      { AOM_CDF2(27179) }, { AOM_CDF2(20004) }, { AOM_CDF2(11281) },
      { AOM_CDF2(26549) }, { AOM_CDF2(19308) }, { AOM_CDF2(14224) },
      { AOM_CDF2(28015) }, { AOM_CDF2(21546) }, { AOM_CDF2(14400) },
      { AOM_CDF2(28165) }, { AOM_CDF2(22401) }, { AOM_CDF2(16088) }
    };
#else
static const aom_cdf_prob
    default_txfm_partition_cdf[TXFM_PARTITION_CONTEXTS][CDF_SIZE(2)] = {
      { AOM_CDF2(28581) }, { AOM_CDF2(23846) }, { AOM_CDF2(20847) },
      { AOM_CDF2(24315) }, { AOM_CDF2(18196) }, { AOM_CDF2(12133) },
      { AOM_CDF2(18791) }, { AOM_CDF2(10887) }, { AOM_CDF2(11005) },
      { AOM_CDF2(27179) }, { AOM_CDF2(20004) }, { AOM_CDF2(11281) },
      { AOM_CDF2(26549) }, { AOM_CDF2(19308) }, { AOM_CDF2(14224) },
      { AOM_CDF2(28015) }, { AOM_CDF2(21546) }, { AOM_CDF2(14400) },
      { AOM_CDF2(28165) }, { AOM_CDF2(22401) }, { AOM_CDF2(16088) }
    };
#endif  // CONFIG_NEW_TX_PARTITION

static const aom_cdf_prob default_skip_cdfs[SKIP_CONTEXTS][CDF_SIZE(2)] = {
  { AOM_CDF2(31671) }, { AOM_CDF2(16515) }, { AOM_CDF2(4576) }
};

static const aom_cdf_prob default_skip_mode_cdfs[SKIP_MODE_CONTEXTS][CDF_SIZE(
    2)] = { { AOM_CDF2(32621) }, { AOM_CDF2(20708) }, { AOM_CDF2(8127) } };

static const aom_cdf_prob
    default_compound_idx_cdfs[COMP_INDEX_CONTEXTS][CDF_SIZE(2)] = {
      { AOM_CDF2(18244) }, { AOM_CDF2(12865) }, { AOM_CDF2(7053) },
      { AOM_CDF2(13259) }, { AOM_CDF2(9334) },  { AOM_CDF2(4644) }
    };

static const aom_cdf_prob
    default_comp_group_idx_cdfs[COMP_GROUP_IDX_CONTEXTS][CDF_SIZE(2)] = {
      { AOM_CDF2(26607) }, { AOM_CDF2(22891) }, { AOM_CDF2(18840) },
      { AOM_CDF2(24594) }, { AOM_CDF2(19934) }, { AOM_CDF2(22674) }
    };

static const aom_cdf_prob default_intrabc_cdf[CDF_SIZE(2)] = { AOM_CDF2(
    30531) };

static const aom_cdf_prob default_filter_intra_mode_cdf[CDF_SIZE(
    FILTER_INTRA_MODES)] = { AOM_CDF5(8949, 12776, 17211, 29558) };

static const aom_cdf_prob
    default_filter_intra_cdfs[BLOCK_SIZES_ALL][CDF_SIZE(2)] = {
      { AOM_CDF2(4621) },  { AOM_CDF2(6743) },  { AOM_CDF2(5893) },
      { AOM_CDF2(7866) },  { AOM_CDF2(12551) }, { AOM_CDF2(9394) },
      { AOM_CDF2(12408) }, { AOM_CDF2(14301) }, { AOM_CDF2(12756) },
      { AOM_CDF2(22343) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(12770) }, { AOM_CDF2(10368) },
      { AOM_CDF2(20229) }, { AOM_CDF2(18101) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) },
#if CONFIG_FLEX_PARTITION
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
#endif  // CONFIG_FLEX_PARTITION
    };

#if CONFIG_ADAPT_FILTER_INTRA
static const aom_cdf_prob default_adapt_filter_intra_mode_cdf[CDF_SIZE(
    USED_ADAPT_FILTER_INTRA_MODES)] =
#if USED_ADAPT_FILTER_INTRA_MODES == 3
    { AOM_CDF3(10922, 10922) };
#elif USED_ADAPT_FILTER_INTRA_MODES == 5
    { AOM_CDF5(6553, 13106, 19659, 26212) };
#elif USED_ADAPT_FILTER_INTRA_MODES == 7
    { AOM_CDF7(4681, 9362, 14043, 18724, 23405, 28086) };
#endif

static const aom_cdf_prob
    default_adapt_filter_intra_cdfs[BLOCK_SIZES_ALL][CDF_SIZE(2)] = {
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) },
#if CONFIG_FLEX_PARTITION
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
      { AOM_CDF2(16384) }, { AOM_CDF2(16384) }, { AOM_CDF2(16384) },
#endif  // CONFIG_FLEX_PARTITION
    };
#endif  // CONFIG_ADAPT_FILTER_INTRA

#if CONFIG_LOOP_RESTORE_CNN
static const aom_cdf_prob default_switchable_restore_cdf[CDF_SIZE(
    RESTORE_SWITCHABLE_TYPES)] = { AOM_CDF4(6000, 14000, 22500) };
#else
static const aom_cdf_prob default_switchable_restore_cdf[CDF_SIZE(
    RESTORE_SWITCHABLE_TYPES)] = { AOM_CDF3(9413, 22581) };
#endif  // CONFIG_LOOP_RESTORE_CNN

static const aom_cdf_prob default_wiener_restore_cdf[CDF_SIZE(2)] = { AOM_CDF2(
    11570) };

static const aom_cdf_prob default_sgrproj_restore_cdf[CDF_SIZE(2)] = { AOM_CDF2(
    16855) };

#if CONFIG_LOOP_RESTORE_CNN
static const aom_cdf_prob default_cnn_restore_cdf[CDF_SIZE(2)] = { AOM_CDF2(
    20000) };
#endif  // CONFIG_LOOP_RESTORE_CNN

static const aom_cdf_prob default_delta_q_cdf[CDF_SIZE(DELTA_Q_PROBS + 1)] = {
  AOM_CDF4(28160, 32120, 32677)
};

static const aom_cdf_prob default_delta_lf_multi_cdf[FRAME_LF_COUNT][CDF_SIZE(
    DELTA_LF_PROBS + 1)] = { { AOM_CDF4(28160, 32120, 32677) },
                             { AOM_CDF4(28160, 32120, 32677) },
                             { AOM_CDF4(28160, 32120, 32677) },
                             { AOM_CDF4(28160, 32120, 32677) } };
static const aom_cdf_prob default_delta_lf_cdf[CDF_SIZE(DELTA_LF_PROBS + 1)] = {
  AOM_CDF4(28160, 32120, 32677)
};

// FIXME(someone) need real defaults here
static const aom_cdf_prob default_seg_tree_cdf[CDF_SIZE(MAX_SEGMENTS)] = {
  AOM_CDF8(4096, 8192, 12288, 16384, 20480, 24576, 28672)
};

static const aom_cdf_prob
    default_segment_pred_cdf[SEG_TEMPORAL_PRED_CTXS][CDF_SIZE(2)] = {
      { AOM_CDF2(128 * 128) }, { AOM_CDF2(128 * 128) }, { AOM_CDF2(128 * 128) }
    };

static const aom_cdf_prob
    default_spatial_pred_seg_tree_cdf[SPATIAL_PREDICTION_PROBS][CDF_SIZE(
        MAX_SEGMENTS)] = {
      {
          AOM_CDF8(5622, 7893, 16093, 18233, 27809, 28373, 32533),
      },
      {
          AOM_CDF8(14274, 18230, 22557, 24935, 29980, 30851, 32344),
      },
      {
          AOM_CDF8(27527, 28487, 28723, 28890, 32397, 32647, 32679),
      },
    };

static const aom_cdf_prob default_tx_size_cdf[MAX_TX_CATS][TX_SIZE_CONTEXTS]
                                             [CDF_SIZE(MAX_TX_DEPTH + 1)] = {
                                               { { AOM_CDF2(19968) },
                                                 { AOM_CDF2(19968) },
                                                 { AOM_CDF2(24320) } },
                                               { { AOM_CDF3(12272, 30172) },
                                                 { AOM_CDF3(12272, 30172) },
                                                 { AOM_CDF3(18677, 30848) } },
                                               { { AOM_CDF3(12986, 15180) },
                                                 { AOM_CDF3(12986, 15180) },
                                                 { AOM_CDF3(24302, 25602) } },
                                               { { AOM_CDF3(5782, 11475) },
                                                 { AOM_CDF3(5782, 11475) },
                                                 { AOM_CDF3(16803, 22759) } },
                                             };

#define MAX_COLOR_CONTEXT_HASH 8
// Negative values are invalid
static const int palette_color_index_context_lookup[MAX_COLOR_CONTEXT_HASH +
                                                    1] = { -1, -1, 0, -1, -1,
                                                           4,  3,  2, 1 };

#define NUM_PALETTE_NEIGHBORS 3  // left, top-left and top.
int av1_get_palette_color_index_context(const uint8_t *color_map, int stride,
                                        int r, int c, int palette_size,
                                        uint8_t *color_order, int *color_idx) {
  assert(palette_size <= PALETTE_MAX_SIZE);
  assert(r > 0 || c > 0);

  // Get color indices of neighbors.
  int color_neighbors[NUM_PALETTE_NEIGHBORS];
  color_neighbors[0] = (c - 1 >= 0) ? color_map[r * stride + c - 1] : -1;
  color_neighbors[1] =
      (c - 1 >= 0 && r - 1 >= 0) ? color_map[(r - 1) * stride + c - 1] : -1;
  color_neighbors[2] = (r - 1 >= 0) ? color_map[(r - 1) * stride + c] : -1;

  // The +10 below should not be needed. But we get a warning "array subscript
  // is above array bounds [-Werror=array-bounds]" without it, possibly due to
  // this (or similar) bug: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=59124
  int scores[PALETTE_MAX_SIZE + 10] = { 0 };
  int i;
  static const int weights[NUM_PALETTE_NEIGHBORS] = { 2, 1, 2 };
  for (i = 0; i < NUM_PALETTE_NEIGHBORS; ++i) {
    if (color_neighbors[i] >= 0) {
      scores[color_neighbors[i]] += weights[i];
    }
  }

  int inverse_color_order[PALETTE_MAX_SIZE];
  for (i = 0; i < PALETTE_MAX_SIZE; ++i) {
    color_order[i] = i;
    inverse_color_order[i] = i;
  }

  // Get the top NUM_PALETTE_NEIGHBORS scores (sorted from large to small).
  for (i = 0; i < NUM_PALETTE_NEIGHBORS; ++i) {
    int max = scores[i];
    int max_idx = i;
    for (int j = i + 1; j < palette_size; ++j) {
      if (scores[j] > max) {
        max = scores[j];
        max_idx = j;
      }
    }
    if (max_idx != i) {
      // Move the score at index 'max_idx' to index 'i', and shift the scores
      // from 'i' to 'max_idx - 1' by 1.
      const int max_score = scores[max_idx];
      const uint8_t max_color_order = color_order[max_idx];
      for (int k = max_idx; k > i; --k) {
        scores[k] = scores[k - 1];
        color_order[k] = color_order[k - 1];
        inverse_color_order[color_order[k]] = k;
      }
      scores[i] = max_score;
      color_order[i] = max_color_order;
      inverse_color_order[color_order[i]] = i;
    }
  }

  if (color_idx != NULL)
    *color_idx = inverse_color_order[color_map[r * stride + c]];

  // Get hash value of context.
  int color_index_ctx_hash = 0;
  static const int hash_multipliers[NUM_PALETTE_NEIGHBORS] = { 1, 2, 2 };
  for (i = 0; i < NUM_PALETTE_NEIGHBORS; ++i) {
    color_index_ctx_hash += scores[i] * hash_multipliers[i];
  }
  assert(color_index_ctx_hash > 0);
  assert(color_index_ctx_hash <= MAX_COLOR_CONTEXT_HASH);

  // Lookup context from hash.
  const int color_index_ctx =
      palette_color_index_context_lookup[color_index_ctx_hash];
  assert(color_index_ctx >= 0);
  assert(color_index_ctx < PALETTE_COLOR_INDEX_CONTEXTS);
  return color_index_ctx;
}
#undef NUM_PALETTE_NEIGHBORS
#undef MAX_COLOR_CONTEXT_HASH

static void init_mode_probs(FRAME_CONTEXT *fc) {
  av1_copy(fc->palette_y_size_cdf, default_palette_y_size_cdf);
  av1_copy(fc->palette_uv_size_cdf, default_palette_uv_size_cdf);
  av1_copy(fc->palette_y_color_index_cdf, default_palette_y_color_index_cdf);
  av1_copy(fc->palette_uv_color_index_cdf, default_palette_uv_color_index_cdf);
  av1_copy(fc->kf_y_cdf, default_kf_y_mode_cdf);
#if CONFIG_INTRA_ENTROPY
  av1_zero(fc->av1_intra_y_mode);
  fc->av1_intra_y_mode.lr = intra_y_mode_lr;
  fc->av1_intra_y_mode.num_hidden_layers = 0;
  fc->av1_intra_y_mode.layer[0].num_inputs = KF_Y_MODE_FEATURES;
  fc->av1_intra_y_mode.layer[0].num_outputs = INTRA_MODES;
  fc->av1_intra_y_mode.layer[0].activation = ACTN_NONE;
  fc->av1_intra_y_mode.num_logits = INTRA_MODES;
  fc->av1_intra_y_mode.loss = SOFTMAX_CROSS_ENTROPY_LOSS;
  av1_copy(fc->av1_intra_y_mode.layer[0].weights, intra_y_mode_layer0_weights);
  av1_copy(fc->av1_intra_y_mode.layer[0].bias, intra_y_mode_layer0_bias);

  av1_zero(fc->av1_intra_uv_mode);
  fc->av1_intra_uv_mode.lr = intra_uv_mode_lr;
  fc->av1_intra_uv_mode.num_hidden_layers = 0;
  fc->av1_intra_uv_mode.layer[0].num_inputs = UV_INTRA_MODE_FEATURES;
  fc->av1_intra_uv_mode.layer[0].num_outputs = UV_INTRA_MODES;
  fc->av1_intra_uv_mode.layer[0].activation = ACTN_NONE;
  fc->av1_intra_uv_mode.num_logits = UV_INTRA_MODES;
  fc->av1_intra_uv_mode.loss = SOFTMAX_CROSS_ENTROPY_LOSS;
  av1_copy(fc->av1_intra_uv_mode.layer[0].weights,
           intra_uv_mode_layer0_weights);
  av1_copy(fc->av1_intra_uv_mode.layer[0].bias, intra_uv_mode_layer0_bias);
#endif  // CONFIG_INTRA_ENTROPY
  av1_copy(fc->angle_delta_cdf, default_angle_delta_cdf);
  av1_copy(fc->comp_inter_cdf, default_comp_inter_cdf);
  av1_copy(fc->comp_ref_type_cdf, default_comp_ref_type_cdf);
  av1_copy(fc->uni_comp_ref_cdf, default_uni_comp_ref_cdf);
  av1_copy(fc->palette_y_mode_cdf, default_palette_y_mode_cdf);
  av1_copy(fc->palette_uv_mode_cdf, default_palette_uv_mode_cdf);
  av1_copy(fc->comp_ref_cdf, default_comp_ref_cdf);
  av1_copy(fc->comp_bwdref_cdf, default_comp_bwdref_cdf);
  av1_copy(fc->single_ref_cdf, default_single_ref_cdf);
  av1_copy(fc->txfm_partition_cdf, default_txfm_partition_cdf);
  av1_copy(fc->compound_index_cdf, default_compound_idx_cdfs);
  av1_copy(fc->comp_group_idx_cdf, default_comp_group_idx_cdfs);
  av1_copy(fc->newmv_cdf, default_newmv_cdf);
  av1_copy(fc->zeromv_cdf, default_zeromv_cdf);
  av1_copy(fc->refmv_cdf, default_refmv_cdf);
  av1_copy(fc->drl_cdf, default_drl_cdf);
  av1_copy(fc->motion_mode_cdf, default_motion_mode_cdf);
  av1_copy(fc->obmc_cdf, default_obmc_cdf);
  av1_copy(fc->inter_compound_mode_cdf, default_inter_compound_mode_cdf);
  av1_copy(fc->compound_type_cdf, default_compound_type_cdf);
  av1_copy(fc->wedge_idx_cdf, default_wedge_idx_cdf);
  av1_copy(fc->interintra_cdf, default_interintra_cdf);
  av1_copy(fc->wedge_interintra_cdf, default_wedge_interintra_cdf);
  av1_copy(fc->interintra_mode_cdf, default_interintra_mode_cdf);
  av1_copy(fc->seg.pred_cdf, default_segment_pred_cdf);
  av1_copy(fc->seg.tree_cdf, default_seg_tree_cdf);
  av1_copy(fc->filter_intra_cdfs, default_filter_intra_cdfs);
  av1_copy(fc->filter_intra_mode_cdf, default_filter_intra_mode_cdf);
#if CONFIG_ADAPT_FILTER_INTRA
  av1_copy(fc->adapt_filter_intra_cdfs, default_adapt_filter_intra_cdfs);
  av1_copy(fc->adapt_filter_intra_mode_cdf,
           default_adapt_filter_intra_mode_cdf);
#endif
  av1_copy(fc->switchable_restore_cdf, default_switchable_restore_cdf);
  av1_copy(fc->wiener_restore_cdf, default_wiener_restore_cdf);
  av1_copy(fc->sgrproj_restore_cdf, default_sgrproj_restore_cdf);
#if CONFIG_LOOP_RESTORE_CNN
  av1_copy(fc->cnn_restore_cdf, default_cnn_restore_cdf);
#endif  // CONFIG_LOOP_RESTORE_CNN
  av1_copy(fc->y_mode_cdf, default_if_y_mode_cdf);
  av1_copy(fc->uv_mode_cdf, default_uv_mode_cdf);
  av1_copy(fc->switchable_interp_cdf, default_switchable_interp_cdf);
  av1_copy(fc->partition_cdf, default_partition_cdf);
  av1_copy(fc->intra_ext_tx_cdf, default_intra_ext_tx_cdf);
  av1_copy(fc->inter_ext_tx_cdf, default_inter_ext_tx_cdf);
#if CONFIG_MODE_DEP_TX
#if USE_MDTX_INTER
  av1_copy(fc->mdtx_type_inter_cdf, default_mdtx_type_inter_cdf);
  av1_copy(fc->use_mdtx_inter_cdf, default_use_mdtx_inter_cdf);
#endif
#if USE_MDTX_INTRA
  av1_copy(fc->mdtx_type_intra_cdf, default_mdtx_type_intra_cdf);
  av1_copy(fc->use_mdtx_intra_cdf, default_use_mdtx_intra_cdf);
#endif
#endif
  av1_copy(fc->skip_mode_cdfs, default_skip_mode_cdfs);
  av1_copy(fc->skip_cdfs, default_skip_cdfs);
  av1_copy(fc->intra_inter_cdf, default_intra_inter_cdf);
  for (int i = 0; i < SPATIAL_PREDICTION_PROBS; i++)
    av1_copy(fc->seg.spatial_pred_seg_cdf[i],
             default_spatial_pred_seg_tree_cdf[i]);
  av1_copy(fc->tx_size_cdf, default_tx_size_cdf);
  av1_copy(fc->delta_q_cdf, default_delta_q_cdf);
  av1_copy(fc->delta_lf_cdf, default_delta_lf_cdf);
  av1_copy(fc->delta_lf_multi_cdf, default_delta_lf_multi_cdf);
  av1_copy(fc->cfl_sign_cdf, default_cfl_sign_cdf);
  av1_copy(fc->cfl_alpha_cdf, default_cfl_alpha_cdf);
  av1_copy(fc->intrabc_cdf, default_intrabc_cdf);
}

void av1_set_default_ref_deltas(int8_t *ref_deltas) {
  assert(ref_deltas != NULL);

  ref_deltas[INTRA_FRAME] = 1;
  ref_deltas[LAST_FRAME] = 0;
  ref_deltas[LAST2_FRAME] = ref_deltas[LAST_FRAME];
  ref_deltas[LAST3_FRAME] = ref_deltas[LAST_FRAME];
  ref_deltas[BWDREF_FRAME] = ref_deltas[LAST_FRAME];
  ref_deltas[GOLDEN_FRAME] = -1;
  ref_deltas[ALTREF2_FRAME] = -1;
  ref_deltas[ALTREF_FRAME] = -1;
}

void av1_set_default_mode_deltas(int8_t *mode_deltas) {
  assert(mode_deltas != NULL);

  mode_deltas[0] = 0;
  mode_deltas[1] = 0;
}

static void set_default_lf_deltas(struct loopfilter *lf) {
  lf->mode_ref_delta_enabled = 1;
  lf->mode_ref_delta_update = 1;

  av1_set_default_ref_deltas(lf->ref_deltas);
  av1_set_default_mode_deltas(lf->mode_deltas);
}

void av1_setup_frame_contexts(AV1_COMMON *cm) {
  // Store the frame context into a special slot (not associated with any
  // reference buffer), so that we can set up cm->pre_fc correctly later
  // This function must ONLY be called when cm->fc has been initialized with
  // default probs, either by av1_setup_past_independence or after manually
  // initializing them
  *cm->default_frame_context = *cm->fc;
  // TODO(jack.haughton@argondesign.com): don't think this should be necessary,
  // but could do with fuller testing
  if (cm->large_scale_tile) {
    for (int i = LAST_FRAME; i <= ALTREF_FRAME; ++i) {
      RefCntBuffer *const buf = get_ref_frame_buf(cm, i);
      if (buf != NULL) buf->frame_context = *cm->fc;
    }
    for (int i = 0; i < FRAME_BUFFERS; ++i)
      cm->buffer_pool->frame_bufs[i].frame_context = *cm->fc;
  }
}

void av1_setup_past_independence(AV1_COMMON *cm) {
  // Reset the segment feature data to the default stats:
  // Features disabled, 0, with delta coding (Default state).
  av1_clearall_segfeatures(&cm->seg);

  if (cm->cur_frame->seg_map)
    memset(cm->cur_frame->seg_map, 0, (cm->mi_rows * cm->mi_cols));

  // reset mode ref deltas
  av1_set_default_ref_deltas(cm->cur_frame->ref_deltas);
  av1_set_default_mode_deltas(cm->cur_frame->mode_deltas);
  set_default_lf_deltas(&cm->lf);

  av1_default_coef_probs(cm);
  init_mode_probs(cm->fc);
  av1_init_mv_probs(cm);
  cm->fc->initialized = 1;
  av1_setup_frame_contexts(cm);

  // prev_mi will only be allocated in encoder.
  if (frame_is_intra_only(cm) && cm->prev_mi)
    memset(cm->prev_mi, 0, cm->mi_stride * cm->mi_rows * sizeof(*cm->prev_mi));
}
