{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c64327a1_da8c10d0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 14993
      },
      "writtenOn": "2021-03-05T17:15:23Z",
      "side": 1,
      "message": "Hi Wan-Teh,\n\nAs per our study, mv cdfs are not updated and mv costs are not consumed during the encode for intra frames. Hence, we added a condition to skip the calculation of mv costs in av1_set_cost_upd_freq()/skip_mv_cost_update().\n\nWe validated the current patch for video and still-image encode. Specifically, we configured libaom in ALLINTRA mode (in libavif) for AVIF encode.\n\nIt was verified that output of AVIF/video encode is bit-exact with parent version.\n\nInstruction count reduction observed for AVIF still image encode is given below:\n\n           Instruction Count\n  speed      Reduction(%)  \n    0           0.231\n    1           0.441\n    2           0.576\n    3           0.956\n    4           1.467\n    5           1.603\n    6           4.443\n\nInstruction count reduction observed for all-intra video encode is given below. The speed-up is relatively higher in this case due to low-res/mid-res contents (as high as ~20%) as superblock size is 64x64 for speed\u003d6. Hence savings per pixel seems to be more for these resolutions.\n\n           Instruction Count\ncpu-used      Reduction(%)  \n    6           10.377\n\nThe instruction count reduction specified has been measured using command:\n\n $ perf stat -e instructions:u ./avifenc ...\n\nPlease review.\n\nRegards,\nJayasanker.",
      "revId": "4731373ad6e32f69492cc3ccbfb2f1e390f3caf6",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "06e74614_e4fd2513",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-03-12T00:51:43Z",
      "side": 1,
      "message": "Chi Yo: Please review. Thanks!\n\nHui: We need to verify that this CL does not affect intrabc, so we may need to consult you during the review.",
      "revId": "4731373ad6e32f69492cc3ccbfb2f1e390f3caf6",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "413e5747_f5e70c55",
        "filename": "av1/encoder/encodeframe_utils.c",
        "patchSetId": 1
      },
      "lineNbr": 1290,
      "author": {
        "id": 14993
      },
      "writtenOn": "2021-03-05T17:15:23Z",
      "side": 1,
      "message": "We used frame_is_intra_only() based condition instead of \u0027frame_type \u003d\u003d KEY_FRAME\u0027 to cover all types of intra frames.",
      "range": {
        "startLine": 1290,
        "startChar": 6,
        "endLine": 1290,
        "endChar": 39
      },
      "revId": "4731373ad6e32f69492cc3ccbfb2f1e390f3caf6",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e766068_6913d9cf",
        "filename": "av1/encoder/encodeframe_utils.c",
        "patchSetId": 1
      },
      "lineNbr": 1290,
      "author": {
        "id": 5022
      },
      "writtenOn": "2021-03-09T07:01:59Z",
      "side": 1,
      "message": "intra frame might also use motion estimation in the intrabc mode.",
      "parentUuid": "413e5747_f5e70c55",
      "range": {
        "startLine": 1290,
        "startChar": 6,
        "endLine": 1290,
        "endChar": 39
      },
      "revId": "4731373ad6e32f69492cc3ccbfb2f1e390f3caf6",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8d8145c_72185438",
        "filename": "av1/encoder/encodeframe_utils.c",
        "patchSetId": 1
      },
      "lineNbr": 1290,
      "author": {
        "id": 14993
      },
      "writtenOn": "2021-03-09T11:52:26Z",
      "side": 1,
      "message": "Hi Jingning,\n\nThe current patch avoids the calculation of mv cost table (x-\u003emv_costs) for intra frames, calculated in av1_fill_mv_costs(). This calculation is based on cm-\u003efc-\u003enmvc.\n\nIn the case of intraBC, following mv cost tables are used:\n\n1. For intraBC ME, x-\u003emv_costs is used which is already calculated at frame level in av1_initialize_rd_consts(). As cm-\u003efc-\u003enmvc is not updated at block level during the encode stage, x-\u003emv_costs need not be recalculated.\n\n2. For rd evaluation of intraBC mode, cpi-\u003edv_costs is used. The same is calculated based on cm-\u003efc-\u003endvc, at frame level in av1_initialize_rd_consts(). As per our understanding, cm-\u003efc-\u003endvc is not currently updated and dv_costs is not calculated at block level during the encode stage.\n\nHence the current change does not have any dependency on intraBC.\n\nPlease let us know your opinion on the above.\n\nRegards,\nJayasanker",
      "parentUuid": "1e766068_6913d9cf",
      "range": {
        "startLine": 1290,
        "startChar": 6,
        "endLine": 1290,
        "endChar": 39
      },
      "revId": "4731373ad6e32f69492cc3ccbfb2f1e390f3caf6",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4411cf88_db09dfce",
        "filename": "av1/encoder/encodeframe_utils.c",
        "patchSetId": 1
      },
      "lineNbr": 1290,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-03-12T00:51:43Z",
      "side": 1,
      "message": "Hi Jayasanker,\n\nI\u0027ve asked Chi Yo to review this CL. I also cc\u0027ed Hui, who on intrabc before.\n\nLast week Chi Yo noticed that intrabc actually uses mv_costs instead of dv_costs for motion search. He thinks it\u0027s important to fix this \"quirk\" first.",
      "parentUuid": "c8d8145c_72185438",
      "range": {
        "startLine": 1290,
        "startChar": 6,
        "endLine": 1290,
        "endChar": 39
      },
      "revId": "4731373ad6e32f69492cc3ccbfb2f1e390f3caf6",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}