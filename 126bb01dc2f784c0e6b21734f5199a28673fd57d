{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "41321c8b_c8ba7019",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 3
      },
      "lineNbr": 1363,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-01-11T18:18:49Z",
      "side": 1,
      "message": "Would this be enough? If we only encoder 1 frame (--limit), then \"cpi-\u003eoxcf.kf_cfg.key_freq_max \u003c 2\" wouldn\u0027t be true. We should have frame_is_intra_only as well.\nAlso, looks like \"cpi-\u003eoxcf.kf_cfg.key_freq_max \u003d1\" doesn\u0027t work correctly. PSNR output is always 100. Can you try?",
      "range": {
        "startLine": 1363,
        "startChar": 6,
        "endLine": 1363,
        "endChar": 35
      },
      "revId": "126bb01dc2f784c0e6b21734f5199a28673fd57d",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "913158a4_b8daf1bc",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 3
      },
      "lineNbr": 1363,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-01-11T18:31:36Z",
      "side": 1,
      "message": "Would frame_is_intra_only alone be enough?",
      "parentUuid": "41321c8b_c8ba7019",
      "range": {
        "startLine": 1363,
        "startChar": 6,
        "endLine": 1363,
        "endChar": 35
      },
      "revId": "126bb01dc2f784c0e6b21734f5199a28673fd57d",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "723d5e50_0825f47b",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 3
      },
      "lineNbr": 1363,
      "author": {
        "id": 15031
      },
      "writtenOn": "2021-01-12T13:47:07Z",
      "side": 1,
      "message": "This speed feature already using frame_is_intra_only. For 1 frame encoding , can we add g_limit condition along with \"cpi-\u003eoxcf.kf_cfg.key_freq_max \u003c 2\" ?.\n\nIn the local tests we performed for --kf-max-dist\u003d1(corresponding to “cpi-\u003eoxcf.kf_cfg.key_freq_max \u003d1”),  we were unable to reproduce the output PSNR 100 issue. In our tests, we were getting the correct PSNR numbers when “cpi-\u003eoxcf.kf_cfg.key_freq_max \u003d1.” We have used the below encoder recipe for the tests:\n\naomenc.exe --codec\u003dav1 --good --ivf --cpu-used\u003d1 --threads\u003d1 --profile\u003d0 --bit-depth\u003d8 --enable-cdef\u003d1 --end-usage\u003dvbr --limit\u003d100 --lag-in-frames\u003d19 --min-q\u003d0 --max-q\u003d63 --auto-alt-ref\u003d1 --passes\u003d2  --kf-max-dist\u003d1 --kf-min-dist\u003d0 --drop-frame\u003d0 --static-thresh\u003d0 --bias-pct\u003d50 --minsection-pct\u003d0 --maxsection-pct\u003d2000 --arnr-maxframes\u003d7 --arnr-strength\u003d5 --sharpness\u003d0 --undershoot-pct\u003d100 --overshoot-pct\u003d100 --frame-parallel\u003d0 --tile-columns\u003d0 --tile-rows\u003d0 --target-bitrate\u003d50 --fpf\u003dfile.stat -o out.ivf input.y4m \n \nCould you please share the test-case for which you observed the PSNR issue?\nRegards\nAkshata",
      "parentUuid": "913158a4_b8daf1bc",
      "range": {
        "startLine": 1363,
        "startChar": 6,
        "endLine": 1363,
        "endChar": 35
      },
      "revId": "126bb01dc2f784c0e6b21734f5199a28673fd57d",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aa0c31b4_ae6b9338",
        "filename": "av1/encoder/speed_features.c",
        "patchSetId": 3
      },
      "lineNbr": 1363,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-01-12T23:35:17Z",
      "side": 1,
      "message": "If input file only has 1 frame (i.e. image encoding), we don\u0027t need to set \"--limit\". I didn\u0027t test, but doubt g_limit would help?\n\nRegarding --kf-max-dist\u003d1, your command is right. I used a very high target bitrate, and saw psnr 100. That doesn\u0027t matter. I should have said I saw different encoder results while using --kf-max-dist\u003d0 or 1. This can be dealt as a separate issue.\n\nNot sure how we can set good conditions for intra only encoding. Maybe for now, using cpi-\u003eoxcf.kf_cfg.key_freq_max \u003d\u003d 0? What do you think? Also, could you add a comment to state this feature is useful for intra only encoding, and may be useful for image encoding (this can be tested \u0026 enabled while working on image encoding later).",
      "parentUuid": "723d5e50_0825f47b",
      "range": {
        "startLine": 1363,
        "startChar": 6,
        "endLine": 1363,
        "endChar": 35
      },
      "revId": "126bb01dc2f784c0e6b21734f5199a28673fd57d",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}