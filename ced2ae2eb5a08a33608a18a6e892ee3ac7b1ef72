{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b0519913_577ccf1c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5022
      },
      "writtenOn": "2022-07-19T20:18:59Z",
      "side": 1,
      "message": "The coding gains look great. Any observations on the rate fluctuation?",
      "revId": "ced2ae2eb5a08a33608a18a6e892ee3ac7b1ef72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dd6111c7_1267cb92",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 6585
      },
      "writtenOn": "2022-07-20T05:06:35Z",
      "side": 1,
      "message": "The rate fluctuation is not significant.\nFor the concern of buffer level, please see Marco\u0027s comments.\nI tried a tighter buffer level threshold and the result still seems promising.",
      "parentUuid": "b0519913_577ccf1c",
      "revId": "ced2ae2eb5a08a33608a18a6e892ee3ac7b1ef72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9384a83b_68a290a1",
        "filename": "av1/encoder/ratectrl.c",
        "patchSetId": 3
      },
      "lineNbr": 984,
      "author": {
        "id": 5190
      },
      "writtenOn": "2022-07-19T20:27:30Z",
      "side": 1,
      "message": "I think the coding gains come from allowing lower qp when buffer_level can go negative (which will happen after first key frame), which can cause frame drops in the application, so we generally avoid this. The condition: p_rc-\u003ebuffer_level \u003e p_rc-\u003eoptimal_buffer_level would be more appropriate (or maybe 1/2 of optimal level is safe enough).\n\nWe do incorporate source_sad into rate control in adjust_q_cbr(), but more conservative based on buffer level.",
      "revId": "ced2ae2eb5a08a33608a18a6e892ee3ac7b1ef72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8f96c256_7b7f9616",
        "filename": "av1/encoder/ratectrl.c",
        "patchSetId": 3
      },
      "lineNbr": 984,
      "author": {
        "id": 5190
      },
      "writtenOn": "2022-07-19T22:27:54Z",
      "side": 1,
      "message": "The threshold below which we force worst_quality (line 974) is ~1/8*optimal_level (this is to avoid getting close to 0 to avoid frame drops) so maybe try threshold of 1/4 * p_rc-\u003eoptimal_buffer_level. Looks like the gains are from allowing lower qp after the key frame (where the buffer level can go down below optimal level).",
      "parentUuid": "9384a83b_68a290a1",
      "revId": "ced2ae2eb5a08a33608a18a6e892ee3ac7b1ef72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dce7b2e6_febcf579",
        "filename": "av1/encoder/ratectrl.c",
        "patchSetId": 3
      },
      "lineNbr": 984,
      "author": {
        "id": 6585
      },
      "writtenOn": "2022-07-20T05:06:35Z",
      "side": 1,
      "message": "I tried threshold of 1/4 * p_rc-\u003eoptimal_buffer_level.\nThe result is still pretty good.\nPlease see the updated commit message for the coding gains.",
      "parentUuid": "8f96c256_7b7f9616",
      "revId": "ced2ae2eb5a08a33608a18a6e892ee3ac7b1ef72",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}