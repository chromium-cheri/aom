{
  "comments": [
    {
      "key": {
        "uuid": "13e223c2_478e5fb0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 15298
      },
      "writtenOn": "2020-09-21T17:11:15Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nWhile analysing the motion search functions in hbd encode, we observed that the sad was not down-converted based on bit-depth when sad_skip functions are used under the speed feature use_downsampled_sad for HD res contents, resulting in incorrect cost computation during motion search.\n\nThis patch fixes the issue by adding relevant wrapper functions for down-converting the sad based on bit-depth.\n\nSince the use_downscaled_sad speed feature is enabled only for hdres and above, lowres and midres encoding are unaffected. Kindly note that the speed and quality numbers in the commit message are averaged over the entire borg suite including lowres, midres and hdres. The speed improvement for hdres alone is more and are as follows.\n\n                      Instruction count             BD-Rate Impact(%)\ncpu-used  Resolution    Reduction(%)      avg.psnr   ovr.psnr    ssim     avg.psnr\n                                           8-bit      8-bit      8-bit     10-bit\n  0          HDRES         9.73           -0.0352    -0.0071    -0.0506   -0.0254\n  1          HDRES        12.24           -0.0431    -0.0389    -0.062    -0.0393\n  2          HDRES        11.40           -0.0076    -0.0249    -0.0238   -0.0105\n  3          HDRES        11.89            0.1174     0.0812     0.2159    0.1273\n  4          HDRES        12.86            0.1394     0.0948     0.2274    0.1460\n  5          HDRES        16.89            0.1821     0.1645     0.3145    0.1852\n  6          HDRES        17.99            0.8602     0.9272     1.0613    0.8584\n\nBorg results for 12 bit encode in speed 6 show 18% speed improvement for HD res.\n\nIn the commit message, BD-Rate Impact column:\n[+] sign is for BD-Rate drop\n[-]  sign is for BD-Rate improvement\nThe instruction count reduction specified has been measured using command:\n$ perf stat -e instructions:u ./aomenc …\n\nThis is a bit-exact change with no impact on speed for 8-bit encode and\nfor 10-bit encode lowres and midres contents – verified locally.\n\nPlease review the patch.\n\nThanks",
      "revId": "5538f33320ddc33d5402b5103162bc9e2f0924c7",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    }
  ]
}