{
  "comments": [
    {
      "key": {
        "uuid": "e63d2a7d_cd10cfd7",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 2
      },
      "lineNbr": 2286,
      "author": {
        "id": 9545
      },
      "writtenOn": "2018-06-01T01:02:05Z",
      "side": 1,
      "message": "See encode_rd_sb_row() in av1/encoder/encodeframe.c and read_intra_frame_mode_info() in av1/decoder/decodemv.c for why I think these three fields are related to tile decoding and should be copied together.\n\nIn encode_rd_sb_row(), search for the comment \"Reset delta for every tile\".\n\nIn read_intra_frame_mode_info(), look at the big if statement that begins with \"if (cm-\u003edelta_q_present_flag)\".",
      "range": {
        "startLine": 2281,
        "startChar": 0,
        "endLine": 2286,
        "endChar": 1
      },
      "revId": "1441ca24507b3df4a23f420fe93ac72cd6337bba",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6def3b10_8ef5db73",
        "filename": "av1/decoder/decodeframe.c",
        "patchSetId": 2
      },
      "lineNbr": 2286,
      "author": {
        "id": 9545
      },
      "writtenOn": "2018-06-01T16:24:05Z",
      "side": 1,
      "message": "Hmm... I found the following code in decodeframe.c:\n\nstatic int read_uncompressed_header(AV1Decoder *pbi,\n                                    struct aom_read_bit_buffer *rb) {\n  AV1_COMMON *const cm \u003d \u0026pbi-\u003ecommon;\n  MACROBLOCKD *const xd \u003d \u0026pbi-\u003emb;\n  ...\n  if (cm-\u003edelta_q_present_flag) {\n    xd-\u003eprev_qindex \u003d cm-\u003ebase_qindex;\n    cm-\u003edelta_q_res \u003d 1 \u003c\u003c aom_rb_read_literal(rb, 2);\n    if (!cm-\u003eallow_intrabc) cm-\u003edelta_lf_present_flag \u003d aom_rb_read_bit(rb);\n    if (cm-\u003edelta_lf_present_flag) {\n      xd-\u003eprev_delta_lf_from_base \u003d 0;\n      cm-\u003edelta_lf_res \u003d 1 \u003c\u003c aom_rb_read_literal(rb, 2);\n      cm-\u003edelta_lf_multi \u003d aom_rb_read_bit(rb);\n      const int frame_lf_count \u003d\n          av1_num_planes(cm) \u003e 1 ? FRAME_LF_COUNT : FRAME_LF_COUNT - 2;\n      for (int lf_id \u003d 0; lf_id \u003c frame_lf_count; ++lf_id)\n        xd-\u003eprev_delta_lf[lf_id] \u003d 0;\n    }\n  }\n\nSo it seems that copying pbi-\u003emb.prev_qindex to td-\u003exd.prev_qindex is equivalent to setting td-\u003exd.prev_qindex to cm-\u003ebase_qindex.\n\nSimilarly, it seems that we can just zero td-\u003exd.prev_delta_lf and td-\u003exd.prev_delta_lf_from_base here.",
      "parentUuid": "e63d2a7d_cd10cfd7",
      "range": {
        "startLine": 2281,
        "startChar": 0,
        "endLine": 2286,
        "endChar": 1
      },
      "revId": "1441ca24507b3df4a23f420fe93ac72cd6337bba",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    }
  ]
}