{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "bcea696d_775e7a53",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 15298
      },
      "writtenOn": "2021-05-28T14:12:18Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThis patch creates temp_frame_probs, which simulates the delayed frame probability update in AV1_PRIMARY (under CONFIG_FRAME_PARALLEL_ENCODE macro). Since all the previous same type frames\u0027 frame probabilities are used in pruning AV1 tools, in order to ensure that all the frames in a parallel encode set start with the same frame probabilities, this patch simulates the combined end-of frame probability update at the last frame in a parallel encode set. This is a temporary CL, the appropriate implementation of this scenario will be taken care when the framework is up at Milestone-7.\n\nThis change is tested with integer, undefined, address and thread sanitizer tests locally. The cumulative quality impact of all the CLs in this dependent chain are given below. Please find the detailed borg result(on patchset-2) with CONFIG_FRAME_PARALLEL_ENCODE 1 (test) vs 0 (ref) below.\n\nWith frame level contexts\u003d2:\n CPU  |   Resolution |   Instruction Count |          BD-Rate Impact %\n      |              |    Reduction %      |  avg.psnr ovr.psnr   ssim    |\n      |              |                     |   8 - bit  8 - bit  8 - bit  |\n------|--------------|---------------------|---------   -------  ---------|\t\n  0   |   AVERAGE    |       2.915         |   0.7269   0.7281   0.8626   |\n  1   |   AVERAGE    |       1.496         |   0.6770   0.6586   0.8072   |\n  2   |   AVERAGE    |       0.805         |   0.7953   0.7925   0.9513   |\n  3   |   AVERAGE    |       0.670         |   0.8548   0.8629   0.9591   |\n  4   |   AVERAGE    |       0.425         |   0.9098   0.9167   1.0035   |\n  5   |   AVERAGE    |       0.345         |   1.0190   1.0326   1.1627   |\n  6   |   AVERAGE    |       0.164         |   1.2277   1.2381   1.2979   |\n--------------------------------------------------------------------------\n\nWith frame level contexts\u003d3:\n CPU  |   Resolution |   Instruction Count |          BD-Rate Impact %\n      |              |    Reduction %      |  avg.psnr ovr.psnr   ssim    |\n      |              |                     |   8 - bit  8 - bit  8 - bit  |\n------|--------------|---------------------|---------   -------  ---------|\t\n  2   |   AVERAGE    |       0.824         |  0.8034   0.7929   0.9521    |\n  3   |   AVERAGE    |       0.666         |  0.8406   0.8486   0.9286    |\n  4   |   AVERAGE    |       0.427         |  0.9063   0.9153   0.9915    |\n  5   |   AVERAGE    |       0.315         |  0.9870   0.9995   1.1310    |\n  6   |   AVERAGE    |       0.104         |  1.2339   1.2443   1.3040    |\n--------------------------------------------------------------------------\n\nWith frame level contexts\u003d4:\n CPU  |   Resolution |   Instruction Count |          BD-Rate Impact %\n      |              |    Reduction %      |  avg.psnr ovr.psnr   ssim    |\n      |              |                     |   8 - bit  8 - bit  8 - bit  |\n------|--------------|---------------------|---------   -------  ---------|\t\n  2   |   AVERAGE    |       0.810         |    0.8066   0.7944   0.9599  |\n  3   |   AVERAGE    |       0.665         |    0.8418   0.8488   0.9304  |\n  4   |   AVERAGE    |       0.409         |    0.9078   0.9145   0.9950  |\n  5   |   AVERAGE    |       0.307         |    0.9895   1.0001   1.1443  |\n  6   |   AVERAGE    |       0.089         |    1.2346   1.2405   1.3085  |\n--------------------------------------------------------------------------  \n\nPlease find the CQP results with CONFIG_FRAME_PARALLEL_ENCODE 1 (test) vs 0 (ref) on a subset of hdres (10 contents) below.\n\nWith frame level contexts\u003d2:\n CPU  |   Resolution |   Instruction Count |          BD-Rate Impact %\n      |              |    Reduction %      |  avg.psnr ovr.psnr   ssim    |\n      |              |                     |   8 - bit  8 - bit  8 - bit  |\n------|--------------|---------------------|---------   -------  ---------|\t  \n  0   |  AVERAGE     |      3.977          |    0.6406   0.6382   0.7178  |\n  1   |  AVERAGE     |      1.632          |    0.6612   0.6705   0.6901  |\n  2   |  AVERAGE     |      0.140          |    0.8235   0.8176   0.8448  |\n  3   |  AVERAGE     |      0.222          |    0.5885   0.6035   0.6808  |\n  4   |  AVERAGE     |      0.404          |    0.6633   0.6769   0.5785  |\n  5   |  AVERAGE     |     -0.169          |    0.7787   0.7580   0.9010  |\n  6   |  AVERAGE     |     -0.092          |    1.2513   1.2369   1.2282  |\n--------------------------------------------------------------------------\n\nWith frame level contexts\u003d3:\n CPU  |   Resolution |   Instruction Count |          BD-Rate Impact %\n      |              |    Reduction %      |  avg.psnr ovr.psnr   ssim    |\n      |              |                     |   8 - bit  8 - bit  8 - bit  |\n------|--------------|---------------------|---------   -------  ---------|\t\n  2   |  AVERAGE     |     0.133           |    0.8108   0.8040   0.8549  |\n  3   |  AVERAGE     |     0.226           |    0.6064   0.6215   0.6345  |\n  4   |  AVERAGE     |     0.274           |    0.6909   0.7094   0.6800  |\n  5   |  AVERAGE     |    -0.214           |    0.7891   0.7735   0.9140  |\n  6   |  AVERAGE     |    -0.226           |    1.2323   1.2148   1.2309  |\n--------------------------------------------------------------------------\n  \nWith frame level contexts\u003d4:\n CPU  |   Resolution |   Instruction Count |          BD-Rate Impact %\n      |              |    Reduction %      |  avg.psnr ovr.psnr   ssim    |\n      |              |                     |   8 - bit  8 - bit  8 - bit  |\n------|--------------|---------------------|---------   -------  ---------|\t\n  2   |  AVERAGE     |     0.108           |    0.8053   0.8012   0.8433  |\n  3   |  AVERAGE     |     0.204           |    0.6040   0.6212   0.6337  |\n  4   |  AVERAGE     |     0.369           |    0.7561   0.7794   0.6859  |\n  5   |  AVERAGE     |    -0.214           |    0.7959   0.7778   0.9195  |\n  6   |  AVERAGE     |    -0.267           |    1.2302   1.2133   1.2375  |\n--------------------------------------------------------------------------\nBD rate impact column:\n[+] sign is for BD-Rate drop\n[-] sign is for BD-Rate improvement\nThe instruction count reduction specified has been measured using command:\n$ perf stat -e instructions:u ./aomenc â€¦\nBit-match is locally verified (for CONFIG_FRAME_PARALLEL_ENCODE \u003d 0) for speed 2 to 6 on a few test cases.\n\nPlease review this patch.\nThanks",
      "revId": "e0f27a4040877833b16cb408234282374cba0bff",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c05540d6_77106e10",
        "filename": "av1/encoder/interp_search.c",
        "patchSetId": 3
      },
      "lineNbr": 485,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-05-28T20:25:08Z",
      "side": 1,
      "message": "Move this unchanged part out of the if-else statement?",
      "range": {
        "startLine": 477,
        "startChar": 0,
        "endLine": 485,
        "endChar": 5
      },
      "revId": "e0f27a4040877833b16cb408234282374cba0bff",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7e193def_1064bdab",
        "filename": "av1/encoder/interp_search.c",
        "patchSetId": 3
      },
      "lineNbr": 485,
      "author": {
        "id": 15298
      },
      "writtenOn": "2021-05-31T05:16:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c05540d6_77106e10",
      "range": {
        "startLine": 477,
        "startChar": 0,
        "endLine": 485,
        "endChar": 5
      },
      "revId": "e0f27a4040877833b16cb408234282374cba0bff",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63935ff6_7bb622a6",
        "filename": "av1/encoder/tx_search.c",
        "patchSetId": 3
      },
      "lineNbr": 2073,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-05-28T20:25:08Z",
      "side": 1,
      "message": "Is it possible not to include this part under the config flag?",
      "range": {
        "startLine": 2055,
        "startChar": 0,
        "endLine": 2073,
        "endChar": 5
      },
      "revId": "e0f27a4040877833b16cb408234282374cba0bff",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "83f1d71c_e590005f",
        "filename": "av1/encoder/tx_search.c",
        "patchSetId": 3
      },
      "lineNbr": 2073,
      "author": {
        "id": 15298
      },
      "writtenOn": "2021-05-31T05:16:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "63935ff6_7bb622a6",
      "range": {
        "startLine": 2055,
        "startChar": 0,
        "endLine": 2073,
        "endChar": 5
      },
      "revId": "e0f27a4040877833b16cb408234282374cba0bff",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}