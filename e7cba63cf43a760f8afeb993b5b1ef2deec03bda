{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "071b9b63_4934ff6f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 14993
      },
      "writtenOn": "2021-10-07T13:49:22Z",
      "side": 1,
      "message": "Hi Wan-Teh, Yunqing,\n\nIn this patch, we have reduced the value of border_in_pixels used during the frame buffer allocation from 160 to 64 for allintra encoding mode. For allintra encoding mode, inter-frame motion search is not applicable and the intraBC motion vectors are restricted within the tile boundaries. This indicates that a region beyond the valid frame region will not be accessed in case of allintra encoding mode. However, the following reasons also seem to limit the possible values for border_in_pixels:\n\n1. A check present in calc_stride_and_planesize() stipulates that the border value must always be a multiple of 32. \nhttps://aomedia.googlesource.com/aom/+/10274b5578ae79c999e07482131c30e7d8d4c6af/aom_scale/generic/yv12config.c#187\n\n2. The minimum value of pixels which will be needed beyond the aligned dimensions is equal to the half-block-size dimension corresponding to the largest block-size (128x128). Hence, a minimum of 64 pixels needs to be allocated beyond the aligned dimensions.\nhttps://aomedia.googlesource.com/aom/+/10274b5578ae79c999e07482131c30e7d8d4c6af/av1/encoder/partition_search.c#2713\n\nTherefore, the value of border_in_pixels needs to be at least 64 to satisfy the above constraints.\n\nFor libaom AV1 video encode, bit-match is verified (w.r.t. parent commit) for \u0027GOOD\u0027, \u0027RT\u0027 and \u0027ALLINTRA\u0027 encoding modes for a few contents with different encoding configurations. It was also verified that the output of AVIF encode is bit-exact w.r.t. parent version for a typical image dataset. The extensive validations have been performed on patch-set 1 whereas the speed-up and HEAP memory reductions mentioned are for patch-set 2 after rebasing the patch to the latest version.\n\nWe validated the heap memory reduction and multi-thread speed-up for speed\u003d6 as well. For AVIF image encode with speed\u003d6 and threads\u003d4,\n\n               HEAP Memory     Encode time \nResolution     reduction(%)    reduction(%)\n360p-720p         4.98            1.80\n\nThe speed-up is seen as this patch reduces the size of memset() operation which is done for all frame buffers, due to the reduction in the size of memory allocated for the same. The speedup was measured across cq-levels 17, 29 and 63.\n\nPlease review this patch.\n\nRegards,\nJayasanker.\n",
      "revId": "e7cba63cf43a760f8afeb993b5b1ef2deec03bda",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e531c61f_97767fa3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2021-10-09T01:44:51Z",
      "side": 1,
      "message": "LGTM. For reference, the original code was added in\nhttps://aomedia-review.googlesource.com/c/aom/+/77504",
      "revId": "e7cba63cf43a760f8afeb993b5b1ef2deec03bda",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}