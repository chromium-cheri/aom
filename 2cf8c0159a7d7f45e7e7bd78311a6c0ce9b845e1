{
  "comments": [
    {
      "key": {
        "uuid": "c94dfa56_d9359843",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-07-14T21:40:16Z",
      "side": 1,
      "message": "Max: This CL should be okay, but I have a question about the dangerous case.",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dbf0b3d1_baff0c89",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 143,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-07-14T21:40:16Z",
      "side": 1,
      "message": "Nit: in \u003d\u003e \"to\" or \"into\"?",
      "range": {
        "startLine": 143,
        "startChar": 19,
        "endLine": 143,
        "endChar": 21
      },
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27438214_1f29c729",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 143,
      "author": {
        "id": 14148
      },
      "writtenOn": "2020-07-14T23:34:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dbf0b3d1_baff0c89",
      "range": {
        "startLine": 143,
        "startChar": 19,
        "endLine": 143,
        "endChar": 21
      },
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "918fa681_8733087a",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 147,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-07-14T21:40:16Z",
      "side": 1,
      "message": "Nit: than \u003d\u003e as",
      "range": {
        "startLine": 147,
        "startChar": 54,
        "endLine": 147,
        "endChar": 58
      },
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3e40ea9a_ba550951",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 147,
      "author": {
        "id": 14148
      },
      "writtenOn": "2020-07-14T23:34:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "918fa681_8733087a",
      "range": {
        "startLine": 147,
        "startChar": 54,
        "endLine": 147,
        "endChar": 58
      },
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "92fbf668_3fe146a7",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-07-14T21:40:16Z",
      "side": 1,
      "message": "It seems that this dangerous case can only happen if someone calls:\n\n  aom_copy_metadata_to_frame_buffer(ybf, ybf-\u003emetadata)\n\nIf so, we can also consider that as a programming error. Is it possible to avoid that?",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "489894b2_1af42af6",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 14148
      },
      "writtenOn": "2020-07-14T23:34:38Z",
      "side": 1,
      "message": "Do you mean we should correct the code doing the call?\nI didn\u0027t want to mess with what the developer on that cl intended, so decided to prevent the issue from the function side. I\u0027ll add a fix and amend it. The dev is added as reviewer.",
      "parentUuid": "92fbf668_3fe146a7",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7ccc573b_8ddb9b35",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-07-14T23:55:03Z",
      "side": 1,
      "message": "Max: Could you point me at that CL? I\u0027d like to take a look. Thanks!",
      "parentUuid": "489894b2_1af42af6",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "36944dc3_2a227684",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 14148
      },
      "writtenOn": "2020-07-15T00:01:13Z",
      "side": 1,
      "message": "I added a fix on this new push (encode_strategy.c) that should prevent the issue as the call is only made when the metadata will surely change.\nThe cl is this one for reference (encode_strategy.c line 911): https://aomedia.googlesource.com/aom/+/0db9c51499838a56198f3ef3035a88abd1c9f1f6\nI just moved the call into the if (code_arf).",
      "parentUuid": "7ccc573b_8ddb9b35",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fe8f1043_3b076518",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 7525
      },
      "writtenOn": "2020-07-15T00:07:03Z",
      "side": 1,
      "message": "Thank you Daniel for catching this! It makes sense to only (remove and) copy the metadata when we do need to filter and use another source.\n(Wan-teh, if you\u0027d like to have a look, the original CL on gerrit was https://aomedia-review.googlesource.com/c/aom/+/113069)",
      "parentUuid": "36944dc3_2a227684",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a0105c0d_4c52ca7a",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-07-15T00:16:52Z",
      "side": 1,
      "message": "Bohan, Max: Thank you both for the link to the CL. I suggest we change:\n\n    if (code_arf) {\n      aom_extend_frame_borders(\u0026cpi-\u003ealt_ref_buffer, av1_num_planes(cm));\n      frame_input-\u003esource \u003d \u0026cpi-\u003ealt_ref_buffer;\n    }\n    if (get_frame_update_type(\u0026cpi-\u003egf_group) \u003d\u003d ARF_UPDATE) {\n      cpi-\u003eshow_existing_alt_ref \u003d show_existing_alt_ref;\n    }\n    aom_copy_metadata_to_frame_buffer(frame_input-\u003esource,\n                                      source_buffer-\u003emetadata);\n\nto:\n\n    if (code_arf) {\n      aom_extend_frame_borders(\u0026cpi-\u003ealt_ref_buffer, av1_num_planes(cm));\n      frame_input-\u003esource \u003d \u0026cpi-\u003ealt_ref_buffer;\n      aom_copy_metadata_to_frame_buffer(frame_input-\u003esource,\n                                        source_buffer-\u003emetadata);\n    }\n    if (get_frame_update_type(\u0026cpi-\u003egf_group) \u003d\u003d ARF_UPDATE) {\n      cpi-\u003eshow_existing_alt_ref \u003d show_existing_alt_ref;\n    }\n\nI.e., we call aom_copy_metadata_to_frame_buffer() only when we change frame_input-\u003esource.\n\nBohan, could you write a CL to do that? Thanks.",
      "parentUuid": "fe8f1043_3b076518",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "84bd4233_d40788f4",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 9545
      },
      "writtenOn": "2020-07-15T00:19:30Z",
      "side": 1,
      "message": "I see Max already took care of that in this CL. Good.",
      "parentUuid": "a0105c0d_4c52ca7a",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c363118a_d710e251",
        "filename": "aom_scale/yv12config.h",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 14148
      },
      "writtenOn": "2020-07-15T00:20:26Z",
      "side": 1,
      "message": "Hi Wan-Teh.\nThat change is already reflected on this cl (changes on encode_strategy.c). Should we keep it here or add it as a different one?",
      "parentUuid": "a0105c0d_4c52ca7a",
      "revId": "2cf8c0159a7d7f45e7e7bd78311a6c0ce9b845e1",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0",
      "unresolved": false
    }
  ]
}