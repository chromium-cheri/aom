{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9e7b02e6_17f018ec",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9823
      },
      "writtenOn": "2022-05-02T20:43:48Z",
      "side": 1,
      "message": "Hi Nithya, could you take a look at this CL?\nIt seems to me that we don\u0027t ened to set up the q_matrix unless av1_use_qmatrix returns true.",
      "revId": "d6ac72ba7406a3787d604db353c47a66670f1570",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "593a73f6_bcdfe7fe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 13265
      },
      "writtenOn": "2022-05-03T10:48:10Z",
      "side": 1,
      "message": "Hi Chi Yo,\n\nThis condition was added to remove any redundant initializations across blocks. Please find my understanding of this part below.\n\nav1_set_qmatrix() sets up seg_qmatrix and seg_iqmatrix for the current segment depending on whether qmatrices are enabled or not. If qmatrix is not enabled, some default levels are used to set up these matrices. When I checked the usage of seg_qmatrix or seg_iqmatrix, they were used irrespective of qmatrix being enabled or not. Hence I concluded that av1_set_qmatrix() is to be called for any new segment (even when qmatrix is not enabled) so as to appropriately initialize seg_qmatrix and seg_iqmatrix.\n\nI added the additional check of av1_use_qmatrix() before calling av1_set_qmatrix() to be conservative in case qmatrix is enabled. However, this check may be redundant since its value does not change within a segment. So av1_set_qmatrix() can be called based only on (segment_id !\u003d x-\u003eprev_segment_id) to save redundant initializations when qmatrix is enabled.\n\nPlease let me know in case something is amiss in the above logic.\n\nThanks,\nNithya",
      "parentUuid": "9e7b02e6_17f018ec",
      "revId": "d6ac72ba7406a3787d604db353c47a66670f1570",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}