{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ba22e252_7721f792",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-17T18:55:48Z",
      "side": 1,
      "message": "LGTM. I suggest a small tweak. I also think we should make a similar change to the other two `mt_exit` flags.",
      "revId": "9139cb489ab0fa1abc58611d6888ec09304b7324",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e6cd460_ec6456fe",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 1
      },
      "lineNbr": 276,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-17T18:55:48Z",
      "side": 1,
      "message": "I think it is safer to move these two lines to `av1_encode_tiles_row_mt()` and `av1_fp_encode_tiles_row_mt()`, respectively.\n\nThe reason is that those two functions call `row_mt_mem_alloc()` only under certain conditions:\n\n```\n  if (alloc_row_mt_mem) {\n    row_mt_mem_alloc(cpi, ...);\n  }\n```\n\nSo they won\u0027t set these two `mt_exit` flags to false when `alloc_row_mt_mem` is false. Suppose these `mt_exit` flags were set to true in an earlier failed `aom_codec_encode()` call. In the next `aom_codec_encode()` call, if `alloc_row_mt_mem` is false, we will launch the workers with the `mt_exit` flags equal to true. That is bad.\n\nIs my analysis correct?",
      "range": {
        "startLine": 275,
        "startChar": 0,
        "endLine": 276,
        "endChar": 40
      },
      "revId": "9139cb489ab0fa1abc58611d6888ec09304b7324",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "943339e4_45bfa569",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 1
      },
      "lineNbr": 276,
      "author": {
        "id": 25857
      },
      "writtenOn": "2023-11-21T10:55:06Z",
      "side": 1,
      "message": "aomenc application treats `AOM_CODEC_MEM_ERROR` as a fatal error and exits from `ctx_exit_on_error()` without calling `aom_codec_encode()` again.\n\nBut as per our code study, `AOM_CODEC_MEM_ERROR` is not a fatal error, so it is possible that `aom_codec_encode()` can be called again even after an error is encountered and the scenario as you mentioned can occur. \n\nAs suggested we shall move these two `mt_exit` flags to ensure that they are initialized unconditionally, similar change might be required for other MT modules and we shall submit a CL addressing all.",
      "parentUuid": "6e6cd460_ec6456fe",
      "range": {
        "startLine": 275,
        "startChar": 0,
        "endLine": 276,
        "endChar": 40
      },
      "revId": "9139cb489ab0fa1abc58611d6888ec09304b7324",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bdf750f4_01695592",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 1
      },
      "lineNbr": 2833,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-17T18:55:48Z",
      "side": 1,
      "message": "Nit: I suggest moving this line either before line 2830 or after line 2838 so that it doesn\u0027t go in the middle of the code that sets up `intra_row_mt_sync`,",
      "revId": "9139cb489ab0fa1abc58611d6888ec09304b7324",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4e153c81_aea1e11d",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 1
      },
      "lineNbr": 2833,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-11-18T00:51:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bdf750f4_01695592",
      "revId": "9139cb489ab0fa1abc58611d6888ec09304b7324",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}