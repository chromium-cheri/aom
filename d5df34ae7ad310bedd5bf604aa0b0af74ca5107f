{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d158d304_d4036a6d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9616
      },
      "writtenOn": "2022-02-23T12:29:04Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThis patch modifies the function get_refresh_idx() so that none of the past 3 closest reference frames is refreshed by the current frame. This change specifically helps in low-delay configuration. This is taken from the CL https://aomedia-review.googlesource.com/c/aom/+/134441.\n\nPlease find below the test results on single pass encode configuration with --lag-in-frames\u003d19 across 30 clips (10 clips each of 4k, 1080p and 720p).\n\nREF: CONFIG_FRAME_PARALLEL_ENCODE 0 and CONFIG_FRAME_PARALLEL_ENCODE_2 0\n\nTEST_1: CONFIG_FRAME_PARALLEL_ENCODE 1 and CONFIG_FRAME_PARALLEL_ENCODE_2 1 on parent commit of patchset 2\n\n               Instruction Count        BD-Rate Loss(%)       \ncpu Resolution   Reduction(%)    avg.psnr   ovr.psnr    ssim  \n0     Average     20.008        -0.0175     0.0191   -0.4673\n1     Average     18.718         0.1404     0.2049   -0.2911\n2     Average     10.499         0.4721     0.5215    0.0881\n3     Average      2.941         0.2319     0.2554   -0.0385\n4     Average      1.812         0.0335     0.0449   -0.1801\n5     Average      0.897         0.6195     0.6950    0.7482\n6     Average     -1.034         0.6144     0.7097    0.7860 \n\nTEST_2: CONFIG_FRAME_PARALLEL_ENCODE 1 and CONFIG_FRAME_PARALLEL_ENCODE_2 1 on patchset 2\n\n               Instruction Count        BD-Rate Loss(%)       \ncpu Resolution   Reduction(%)    avg.psnr   ovr.psnr    ssim  \n0     Average      9.644        -1.1188    -1.1192   -1.4475\n1     Average      6.091        -1.1700    -1.1720   -1.5114\n2     Average      5.762        -0.8320    -0.8276   -1.1121\n3     Average      1.319        -0.6039    -0.6216   -0.8199\n4     Average      0.508        -0.6215    -0.6408   -0.7612\n5     Average     -0.078        -0.1510    -0.1220    0.0210\n6     Average     -0.778         0.2301     0.3047    0.4231\n\nIn the commit message, BD rate Loss column:\n[+] sign is for BD-Rate drop\n[-] sign is for BD-Rate improvement\nThe instruction count reduction specified has been measured using command:\n$ perf stat -e instructions:u ./aomenc â€¦\n\nThis change was seen to have negligible impact on speed and quality when tested for 2-pass encode.\n\nWe have also validated this patch with address, thread, undefined and integer sanitizers.\n\nPlease review.\n\nRegards,\nRemya\n",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0996516e_e184b299",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5022
      },
      "writtenOn": "2022-02-23T15:05:55Z",
      "side": 1,
      "message": "Please note that the baseline test conditions shall use --lage-in-frames\u003d48. We have deprecated 19 case.",
      "parentUuid": "d158d304_d4036a6d",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "509bec21_f2c508ac",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2022-02-23T17:54:54Z",
      "side": 1,
      "message": "Hi Jingning, this CL is to improve the performance of 1-pass encoding with --lag-in-frames\u003d19 in FPMT case. Our focus is the 2 pass case. For 1 pass with delay, we just maintain its performance.\n\nDo you know if --lag-in-frames\u003d48 works for 1 pass encoding or if 1-pass encoding with --lag-in-frames\u003d48 matters? I agree that we should test --lag-in-frames\u003d48 for 2 pass case.",
      "parentUuid": "0996516e_e184b299",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "42288e53_0963f64b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5022
      },
      "writtenOn": "2022-02-23T18:02:05Z",
      "side": 1,
      "message": "Thanks for the clarification. That makes sense.\n\nThe 1-pass with look ahead likely needs 48 as well, since it is largely built on tpl. (although we haven\u0027t used / tested 1-pass with look ahead setting for a long time)\n\nProbably we shall check its performance in comparison with regular 2-pass mode, just to get an understanding on if it still works as expected (?)",
      "parentUuid": "509bec21_f2c508ac",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b4f6e572_8a05e318",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2022-02-23T20:13:43Z",
      "side": 1,
      "message": "With this CL, 1 pass encoding BDRate got improved a lot. Thanks for the investigation.",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c08cfcf3_aee9ada4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2022-02-23T20:13:43Z",
      "side": 1,
      "message": "Discussed this with Jingning. The 1 pass with --lag-in-frames\u003d48 study can be planned separately when needed. For FPMT testing, 1-pass encoding with --lag-in-frames\u003d19 might be enough. Also, as Jingning suggested, we should test FPMT for 2 pass with --lag-in-frames\u003d48 as well. Hope this clarifies our understanding.",
      "parentUuid": "42288e53_0963f64b",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eabba994_5b21dcc8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 9616
      },
      "writtenOn": "2022-02-24T10:38:12Z",
      "side": 1,
      "message": "Hi Yunqing, Jingning,\n\nAs suggested, we shall test this CL for both 1-pass and 2-pass encoding with --lag-in-frames\u003d48 to analyse the speed and quality impact.\n\nRegards,\nRemya",
      "parentUuid": "c08cfcf3_aee9ada4",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c0ee81ad_a87a3440",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2022-02-24T16:57:14Z",
      "side": 1,
      "message": "Sounds good. Thanks.",
      "parentUuid": "eabba994_5b21dcc8",
      "revId": "d5df34ae7ad310bedd5bf604aa0b0af74ca5107f",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}