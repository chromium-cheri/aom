{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a161291c_1200b1f4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 21727
      },
      "writtenOn": "2021-09-17T07:17:47Z",
      "side": 1,
      "message": "Hi Yunqing,\nAfter analyzing the bug, we have identified that the \u0027frame_update_type\u0027 which can get modified as part of \u0027av1_adjust_gf_refresh_qp_one_pass_rt\u0027 function was not considered while updating the reference frame map(av1_update_ref_frame_map).\nThis CL fixes the issue by passing the parameter appropriately.\n\nWe verified the patch locally.\nPlease review the same and let us know your thoughts.\nThank you.",
      "revId": "680dd2c8c378ba12b0909289d58439bedd6d56bb",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "10bf07cd_8a8bef61",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-09-17T16:51:31Z",
      "side": 1,
      "message": "Thanks for fixing the bug!",
      "parentUuid": "a161291c_1200b1f4",
      "revId": "680dd2c8c378ba12b0909289d58439bedd6d56bb",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "87f2bce0_1b0ec238",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-09-17T16:55:50Z",
      "side": 1,
      "message": "Hi Marco, could you look at this? This crash only happens at speed 4. I can see it relates to svc-\u003eset_ref_frame_config value, which is 0 for speed 4, but 1 for speed \u003e\u003d5. What does svc-\u003eset_ref_frame_config mean? Should it be 1 for all rt cases?",
      "revId": "680dd2c8c378ba12b0909289d58439bedd6d56bb",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e177398b_dc85b45f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5190
      },
      "writtenOn": "2021-09-17T17:16:20Z",
      "side": 1,
      "message": "For RTC, the reference structure is set in av1_set_reference_structure_one_pass_rt(), and uses the flag set_ref_frame_config.\n\nFor RTC we only used speed \u003e\u003d 5,so the call to av1_set_reference_structure_one_pass_rt() is only for speed \u003e\u003d 5 in the code (which then sets set_ref_frame_config\u003d1), so perhaps the correct fix is to remove the speed constraint (since in principle speed \u003c 5 can be used for rtc).",
      "parentUuid": "87f2bce0_1b0ec238",
      "revId": "680dd2c8c378ba12b0909289d58439bedd6d56bb",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c543a82c_c26324e1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-09-17T17:47:43Z",
      "side": 1,
      "message": "Yes, I feel the same. Removing \"cpi-\u003eoxcf.speed \u003e\u003d 5\" from the following code makes rt speeds behave consistently, which sounds like a better fix to me.\n\n    if (cpi-\u003eoxcf.speed \u003e\u003d 5 \u0026\u0026 cpi-\u003eppi-\u003enumber_spatial_layers \u003d\u003d 1 \u0026\u0026\n        cpi-\u003eppi-\u003enumber_temporal_layers \u003d\u003d 1)\n      av1_set_reference_structure_one_pass_rt(cpi, cpi-\u003egf_frame_index \u003d\u003d 0);\n      \nVishnu, what do you think?\n\nAlso, Marco, if svc-\u003eset_ref_frame_config is always 1 for rt cases, can we remove it and maybe use \"cpi-\u003eoxcf.mode \u003d\u003d REALTIME\" instead?",
      "parentUuid": "e177398b_dc85b45f",
      "revId": "680dd2c8c378ba12b0909289d58439bedd6d56bb",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4465e729_38b7004b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-09-17T17:51:31Z",
      "side": 1,
      "message": "The above suggestion may cause quality change, and needs to be evaluated. Agree to submit this fix for now, and look at other options later.",
      "parentUuid": "c543a82c_c26324e1",
      "revId": "680dd2c8c378ba12b0909289d58439bedd6d56bb",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21f0bb29_a3a73b88",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5190
      },
      "writtenOn": "2021-09-17T17:55:09Z",
      "side": 1,
      "message": "i prefer not to remove svc-\u003eset_ref_frame_config, as its used in the encoder control for applications that choose to set their own layered reference structure.",
      "parentUuid": "c543a82c_c26324e1",
      "revId": "680dd2c8c378ba12b0909289d58439bedd6d56bb",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}